!function(){function e(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=c(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw a}}}}function t(e,t,r,i){var a=n(T(1&i?e.prototype:e),t,r);return 2&i&&"function"==typeof a?function(e){return a.apply(r,e)}:a}function n(){return n="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=T(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},n.apply(null,arguments)}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach(function(t){a(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function a(e,t,n){return(t=m(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function o(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||c(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,s,o=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(o.push(r.value),o.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw i}}return o}}(e,t)||c(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){if(e){if("string"==typeof e)return l(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function h(e,t,n,r,i,a,s){try{var o=e[a](s),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(r,i)}function f(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function s(e){h(a,r,i,s,o,"next",e)}function o(e){h(a,r,i,s,o,"throw",e)}s(void 0)})}}function d(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function a(n,r,i,a){var u=r&&r.prototype instanceof o?r:o,c=Object.create(u.prototype);return p(c,"_invoke",function(n,r,i){var a,o,u,c=0,l=i||[],h=!1,f={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(t,n){return a=t,o=0,u=e,f.n=n,s}};function d(n,r){for(o=n,u=r,t=0;!h&&c&&!i&&t<l.length;t++){var i,a=l[t],d=f.p,p=a[2];n>3?(i=p===r)&&(u=a[(o=a[4])?5:(o=3,3)],a[4]=a[5]=e):a[0]<=d&&((i=n<2&&d<a[1])?(o=0,f.v=r,f.n=a[1]):d<p&&(i=n<3||a[0]>r||r>p)&&(a[4]=n,a[5]=r,f.n=p,o=0))}if(i||n>1)return s;throw h=!0,r}return function(i,l,p){if(c>1)throw TypeError("Generator is already running");for(h&&1===l&&d(l,p),o=l,u=p;(t=o<2?e:u)||!h;){a||(o?o<3?(o>1&&(f.n=-1),d(o,u)):f.n=u:f.v=u);try{if(c=2,a){if(o||(i="next"),t=a[i]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,o<2&&(o=0)}else 1===o&&(t=a.return)&&t.call(a),o<2&&(u=TypeError("The iterator does not provide a '"+i+"' method"),o=1);a=e}else if((t=(h=f.n<0)?u:n.call(r,f))!==s)break}catch(t){a=e,o=1,u=t}finally{c=1}}return{value:t,done:h}}}(n,i,a),!0),c}var s={};function o(){}function u(){}function c(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(p(t={},r,function(){return this}),t),h=c.prototype=o.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,p(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return u.prototype=c,p(h,"constructor",c),p(c,"constructor",u),u.displayName="GeneratorFunction",p(c,i,"GeneratorFunction"),p(h),p(h,i,"Generator"),p(h,r,function(){return this}),p(h,"toString",function(){return"[object Generator]"}),(d=function(){return{w:a,m:f}})()}function p(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}p=function(e,t,n,r){function a(t,n){p(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},p(e,t,n,r)}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,m(r.key),r)}}function y(e,t,n){return t&&v(e.prototype,t),n&&v(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function m(e){var t=function(e,t){if("object"!=s(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=s(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==s(t)?t:t+""}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t,n){return t=T(t),function(e,t){if(t&&("object"==s(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,_()?Reflect.construct(t,n||[],T(e).constructor):t.apply(e,n))}function w(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&S(e,t)}function k(e){var t="function"==typeof Map?new Map:void 0;return k=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return function(e,t,n){if(_())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var i=new(e.bind.apply(e,r));return n&&S(i,n.prototype),i}(e,arguments,T(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),S(n,e)},k(e)}function _(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_=function(){return!!e})()}function S(e,t){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},S(e,t)}function T(e){return T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},T(e)}System.register([],function(n,r){"use strict";return{execute:function(){function r(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function c(e,t,n,r){return new(n||(n=Promise))(function(i,a){function s(e){try{u(r.next(e))}catch(t){a(t)}}function o(e){try{u(r.throw(e))}catch(t){a(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,o)}u((r=r.apply(e,t||[])).next())})}"function"==typeof SuppressedError&&SuppressedError;var l,h=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"FunctionsError",i=arguments.length>2?arguments[2]:void 0;return g(this,t),(n=b(this,t,[e])).name=r,n.context=i,n}return w(t,e),y(t)}(k(Error)),p=function(e){function t(e){return g(this,t),b(this,t,["Failed to send a request to the Edge Function","FunctionsFetchError",e])}return w(t,e),y(t)}(h),v=function(e){function t(e){return g(this,t),b(this,t,["Relay Error invoking the Edge Function","FunctionsRelayError",e])}return w(t,e),y(t)}(h),m=function(e){function t(e){return g(this,t),b(this,t,["Edge Function returned a non-2xx status code","FunctionsHttpError",e])}return w(t,e),y(t)}(h);!function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"}(l||(l={}));var _=function(){return y(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.headers,i=void 0===r?{}:r,a=n.customFetch,s=n.region,o=void 0===s?l.Any:s;g(this,e),this.url=t,this.headers=i,this.region=o,this.fetch=function(e){return e?function(){return e.apply(void 0,arguments)}:function(){return fetch.apply(void 0,arguments)}}(a)},[{key:"setAuth",value:function(e){this.headers.Authorization="Bearer ".concat(e)}},{key:"invoke",value:function(e){return c(this,arguments,void 0,function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d().m(function r(){var i,a,s,o,u,c,l,h,f,y,g,b,w,k,_,S,T,E;return d().w(function(r){for(;;)switch(r.p=r.n){case 0:return r.p=0,o=n.headers,u=n.method,c=n.body,l=n.signal,h=n.timeout,f={},(y=n.region)||(y=t.region),g=new URL("".concat(t.url,"/").concat(e)),y&&"any"!==y&&(f["x-region"]=y,g.searchParams.set("forceFunctionRegion",y)),c&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)?"undefined"!=typeof Blob&&c instanceof Blob||c instanceof ArrayBuffer?(f["Content-Type"]="application/octet-stream",b=c):"string"==typeof c?(f["Content-Type"]="text/plain",b=c):"undefined"!=typeof FormData&&c instanceof FormData?b=c:(f["Content-Type"]="application/json",b=JSON.stringify(c)):b=!c||"string"==typeof c||"undefined"!=typeof Blob&&c instanceof Blob||c instanceof ArrayBuffer||"undefined"!=typeof FormData&&c instanceof FormData?c:JSON.stringify(c),w=l,h&&(s=new AbortController,a=setTimeout(function(){return s.abort()},h),l?(w=s.signal,l.addEventListener("abort",function(){return s.abort()})):w=s.signal),r.n=1,t.fetch(g.toString(),{method:u||"POST",headers:Object.assign(Object.assign(Object.assign({},f),t.headers),o),body:b,signal:w}).catch(function(e){throw new p(e)});case 1:if(k=r.v,!(_=k.headers.get("x-relay-error"))||"true"!==_){r.n=2;break}throw new v(k);case 2:if(k.ok){r.n=3;break}throw new m(k);case 3:if("application/json"!==(S=(null!==(i=k.headers.get("Content-Type"))&&void 0!==i?i:"text/plain").split(";")[0].trim())){r.n=5;break}return r.n=4,k.json();case 4:T=r.v,r.n=12;break;case 5:if("application/octet-stream"!==S&&"application/pdf"!==S){r.n=7;break}return r.n=6,k.blob();case 6:T=r.v,r.n=12;break;case 7:if("text/event-stream"!==S){r.n=8;break}T=k,r.n=12;break;case 8:if("multipart/form-data"!==S){r.n=10;break}return r.n=9,k.formData();case 9:T=r.v,r.n=12;break;case 10:return r.n=11,k.text();case 11:T=r.v;case 12:return r.a(2,{data:T,error:null,response:k});case 13:return r.p=13,E=r.v,r.a(2,{data:null,error:E,response:E instanceof m||E instanceof v?E.context:void 0});case 14:return r.p=14,a&&clearTimeout(a),r.f(14);case 15:return r.a(2)}},r,null,[[0,13,14,15]])})()})}}])}(),S=function(e){function t(e){var n;return g(this,t),(n=b(this,t,[e.message])).name="PostgrestError",n.details=e.details,n.hint=e.hint,n.code=e.code,n}return w(t,e),y(t)}(k(Error)),T=function(){return y(function e(t){var n,r,i;g(this,e),this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=null!==(n=t.shouldThrowOnError)&&void 0!==n&&n,this.signal=t.signal,this.isMaybeSingle=null!==(r=t.isMaybeSingle)&&void 0!==r&&r,this.urlLengthLimit=null!==(i=t.urlLengthLimit)&&void 0!==i?i:8e3,t.fetch?this.fetch=t.fetch:this.fetch=fetch},[{key:"throwOnError",value:function(){return this.shouldThrowOnError=!0,this}},{key:"setHeader",value:function(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}},{key:"then",value:function(e,t){var n=this,r=this;void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");var i=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(function(){var e=f(d().m(function e(t){var n,i,a,s,o,u,c,l,h,f,p,v,y;return d().w(function(e){for(;;)switch(e.n){case 0:if(n=null,i=null,a=null,s=t.status,o=t.statusText,!t.ok){e.n=3;break}if("HEAD"===r.method){e.n=2;break}return e.n=1,t.text();case 1:""===(h=e.v)||(i="text/csv"===r.headers.get("Accept")||r.headers.get("Accept")&&(null===(l=r.headers.get("Accept"))||void 0===l?void 0:l.includes("application/vnd.pgrst.plan+text"))?h:JSON.parse(h));case 2:f=null===(u=r.headers.get("Prefer"))||void 0===u?void 0:u.match(/count=(exact|planned|estimated)/),p=null===(c=t.headers.get("content-range"))||void 0===c?void 0:c.split("/"),f&&p&&p.length>1&&(a=parseInt(p[1])),r.isMaybeSingle&&"GET"===r.method&&Array.isArray(i)&&(i.length>1?(n={code:"PGRST116",details:"Results contain ".concat(i.length," rows, application/vnd.pgrst.object+json requires 1 row"),hint:null,message:"JSON object requested, multiple (or no) rows returned"},i=null,a=null,s=406,o="Not Acceptable"):i=1===i.length?i[0]:null),e.n=5;break;case 3:return e.n=4,t.text();case 4:y=e.v;try{n=JSON.parse(y),Array.isArray(n)&&404===t.status&&(i=[],n=null,s=200,o="OK")}catch(d){404===t.status&&""===y?(s=204,o="No Content"):n={message:y}}if(n&&r.isMaybeSingle&&(null==n||null===(v=n.details)||void 0===v?void 0:v.includes("0 rows"))&&(n=null,s=200,o="OK"),!n||!r.shouldThrowOnError){e.n=5;break}throw new S(n);case 5:return e.a(2,{error:n,data:i,count:a,status:s,statusText:o})}},e)}));return function(t){return e.apply(this,arguments)}}());return this.shouldThrowOnError||(i=i.catch(function(e){var t,r="",i="",a="",s=null==e?void 0:e.cause;if(s){var o,u,c,l,h=null!==(o=null==s?void 0:s.message)&&void 0!==o?o:"",f=null!==(u=null==s?void 0:s.code)&&void 0!==u?u:"";r="".concat(null!==(c=null==e?void 0:e.name)&&void 0!==c?c:"FetchError",": ").concat(null==e?void 0:e.message),r+="\n\nCaused by: ".concat(null!==(l=null==s?void 0:s.name)&&void 0!==l?l:"Error",": ").concat(h),f&&(r+=" (".concat(f,")")),(null==s?void 0:s.stack)&&(r+="\n".concat(s.stack))}else{var d;r=null!==(d=null==e?void 0:e.stack)&&void 0!==d?d:""}var p=n.url.toString().length;return"AbortError"===(null==e?void 0:e.name)||"ABORT_ERR"===(null==e?void 0:e.code)?(a="",i="Request was aborted (timeout or manual cancellation)",p>n.urlLengthLimit&&(i+=". Note: Your request URL is ".concat(p," characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side."))):"HeadersOverflowError"!==(null==s?void 0:s.name)&&"UND_ERR_HEADERS_OVERFLOW"!==(null==s?void 0:s.code)||(a="",i="HTTP headers exceeded server limits (typically 16KB)",p>n.urlLengthLimit&&(i+=". Your request URL is ".concat(p," characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead."))),{error:{message:"".concat(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError",": ").concat(null==e?void 0:e.message),details:r,hint:i,code:a},data:null,count:null,status:0,statusText:""}})),i.then(e,t)}},{key:"returns",value:function(){return this}},{key:"overrideTypes",value:function(){return this}}])}(),E=function(e){function t(){return g(this,t),b(this,t,arguments)}return w(t,e),y(t,[{key:"select",value:function(e){var t=!1,n=(null!=e?e:"*").split("").map(function(e){return/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)}).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}},{key:"order",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.ascending,r=void 0===n||n,i=t.nullsFirst,a=t.foreignTable,s=t.referencedTable,o=void 0===s?a:s,u=o?"".concat(o,".order"):"order",c=this.url.searchParams.get(u);return this.url.searchParams.set(u,"".concat(c?"".concat(c,","):"").concat(e,".").concat(r?"asc":"desc").concat(void 0===i?"":i?".nullsfirst":".nullslast")),this}},{key:"limit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.foreignTable,r=t.referencedTable,i=void 0===r?n:r,a=void 0===i?"limit":"".concat(i,".limit");return this.url.searchParams.set(a,"".concat(e)),this}},{key:"range",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.foreignTable,i=n.referencedTable,a=void 0===i?r:i,s=void 0===a?"offset":"".concat(a,".offset"),o=void 0===a?"limit":"".concat(a,".limit");return this.url.searchParams.set(s,"".concat(e)),this.url.searchParams.set(o,"".concat(t-e+1)),this}},{key:"abortSignal",value:function(e){return this.signal=e,this}},{key:"single",value:function(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}},{key:"maybeSingle",value:function(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}},{key:"csv",value:function(){return this.headers.set("Accept","text/csv"),this}},{key:"geojson",value:function(){return this.headers.set("Accept","application/geo+json"),this}},{key:"explain",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.analyze,r=void 0!==n&&n,i=t.verbose,a=void 0!==i&&i,s=t.settings,o=void 0!==s&&s,u=t.buffers,c=void 0!==u&&u,l=t.wal,h=void 0!==l&&l,f=t.format,d=void 0===f?"text":f,p=[r?"analyze":null,a?"verbose":null,o?"settings":null,c?"buffers":null,h?"wal":null].filter(Boolean).join("|"),v=null!==(e=this.headers.get("Accept"))&&void 0!==e?e:"application/json";return this.headers.set("Accept","application/vnd.pgrst.plan+".concat(d,'; for="').concat(v,'"; options=').concat(p,";")),this}},{key:"rollback",value:function(){return this.headers.append("Prefer","tx=rollback"),this}},{key:"returns",value:function(){return this}},{key:"maxAffected",value:function(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer","max-affected=".concat(e)),this}}])}(T),O=new RegExp("[,()]"),R=function(e){function t(){return g(this,t),b(this,t,arguments)}return w(t,e),y(t,[{key:"eq",value:function(e,t){return this.url.searchParams.append(e,"eq.".concat(t)),this}},{key:"neq",value:function(e,t){return this.url.searchParams.append(e,"neq.".concat(t)),this}},{key:"gt",value:function(e,t){return this.url.searchParams.append(e,"gt.".concat(t)),this}},{key:"gte",value:function(e,t){return this.url.searchParams.append(e,"gte.".concat(t)),this}},{key:"lt",value:function(e,t){return this.url.searchParams.append(e,"lt.".concat(t)),this}},{key:"lte",value:function(e,t){return this.url.searchParams.append(e,"lte.".concat(t)),this}},{key:"like",value:function(e,t){return this.url.searchParams.append(e,"like.".concat(t)),this}},{key:"likeAllOf",value:function(e,t){return this.url.searchParams.append(e,"like(all).{".concat(t.join(","),"}")),this}},{key:"likeAnyOf",value:function(e,t){return this.url.searchParams.append(e,"like(any).{".concat(t.join(","),"}")),this}},{key:"ilike",value:function(e,t){return this.url.searchParams.append(e,"ilike.".concat(t)),this}},{key:"ilikeAllOf",value:function(e,t){return this.url.searchParams.append(e,"ilike(all).{".concat(t.join(","),"}")),this}},{key:"ilikeAnyOf",value:function(e,t){return this.url.searchParams.append(e,"ilike(any).{".concat(t.join(","),"}")),this}},{key:"regexMatch",value:function(e,t){return this.url.searchParams.append(e,"match.".concat(t)),this}},{key:"regexIMatch",value:function(e,t){return this.url.searchParams.append(e,"imatch.".concat(t)),this}},{key:"is",value:function(e,t){return this.url.searchParams.append(e,"is.".concat(t)),this}},{key:"isDistinct",value:function(e,t){return this.url.searchParams.append(e,"isdistinct.".concat(t)),this}},{key:"in",value:function(e,t){var n=Array.from(new Set(t)).map(function(e){return"string"==typeof e&&O.test(e)?'"'.concat(e,'"'):"".concat(e)}).join(",");return this.url.searchParams.append(e,"in.(".concat(n,")")),this}},{key:"notIn",value:function(e,t){var n=Array.from(new Set(t)).map(function(e){return"string"==typeof e&&O.test(e)?'"'.concat(e,'"'):"".concat(e)}).join(",");return this.url.searchParams.append(e,"not.in.(".concat(n,")")),this}},{key:"contains",value:function(e,t){return"string"==typeof t?this.url.searchParams.append(e,"cs.".concat(t)):Array.isArray(t)?this.url.searchParams.append(e,"cs.{".concat(t.join(","),"}")):this.url.searchParams.append(e,"cs.".concat(JSON.stringify(t))),this}},{key:"containedBy",value:function(e,t){return"string"==typeof t?this.url.searchParams.append(e,"cd.".concat(t)):Array.isArray(t)?this.url.searchParams.append(e,"cd.{".concat(t.join(","),"}")):this.url.searchParams.append(e,"cd.".concat(JSON.stringify(t))),this}},{key:"rangeGt",value:function(e,t){return this.url.searchParams.append(e,"sr.".concat(t)),this}},{key:"rangeGte",value:function(e,t){return this.url.searchParams.append(e,"nxl.".concat(t)),this}},{key:"rangeLt",value:function(e,t){return this.url.searchParams.append(e,"sl.".concat(t)),this}},{key:"rangeLte",value:function(e,t){return this.url.searchParams.append(e,"nxr.".concat(t)),this}},{key:"rangeAdjacent",value:function(e,t){return this.url.searchParams.append(e,"adj.".concat(t)),this}},{key:"overlaps",value:function(e,t){return"string"==typeof t?this.url.searchParams.append(e,"ov.".concat(t)):this.url.searchParams.append(e,"ov.{".concat(t.join(","),"}")),this}},{key:"textSearch",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.config,i=n.type,a="";"plain"===i?a="pl":"phrase"===i?a="ph":"websearch"===i&&(a="w");var s=void 0===r?"":"(".concat(r,")");return this.url.searchParams.append(e,"".concat(a,"fts").concat(s,".").concat(t)),this}},{key:"match",value:function(e){var t=this;return Object.entries(e).forEach(function(e){var n=u(e,2),r=n[0],i=n[1];t.url.searchParams.append(r,"eq.".concat(i))}),this}},{key:"not",value:function(e,t,n){return this.url.searchParams.append(e,"not.".concat(t,".").concat(n)),this}},{key:"or",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.foreignTable,r=t.referencedTable,i=void 0===r?n:r,a=i?"".concat(i,".or"):"or";return this.url.searchParams.append(a,"(".concat(e,")")),this}},{key:"filter",value:function(e,t,n){return this.url.searchParams.append(e,"".concat(t,".").concat(n)),this}}])}(E),A=function(){return y(function e(t,n){var r=n.headers,i=void 0===r?{}:r,a=n.schema,s=n.fetch,o=n.urlLengthLimit,u=void 0===o?8e3:o;g(this,e),this.url=t,this.headers=new Headers(i),this.schema=a,this.fetch=s,this.urlLengthLimit=u},[{key:"cloneRequestState",value:function(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}},{key:"select",value:function(e,t){var n=null!=t?t:{},r=n.head,i=void 0!==r&&r,a=n.count,s=i?"HEAD":"GET",o=!1,u=(null!=e?e:"*").split("").map(function(e){return/\s/.test(e)&&!o?"":('"'===e&&(o=!o),e)}).join(""),c=this.cloneRequestState(),l=c.url,h=c.headers;return l.searchParams.set("select",u),a&&h.append("Prefer","count=".concat(a)),new R({method:s,url:l,headers:h,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}},{key:"insert",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.count,i=n.defaultToNull,a=void 0===i||i,s=this.cloneRequestState(),u=s.url,c=s.headers;if(r&&c.append("Prefer","count=".concat(r)),a||c.append("Prefer","missing=default"),Array.isArray(e)){var l=e.reduce(function(e,t){return e.concat(Object.keys(t))},[]);if(l.length>0){var h=o(new Set(l)).map(function(e){return'"'.concat(e,'"')});u.searchParams.set("columns",h.join(","))}}return new R({method:"POST",url:u,headers:c,schema:this.schema,body:e,fetch:null!==(t=this.fetch)&&void 0!==t?t:fetch,urlLengthLimit:this.urlLengthLimit})}},{key:"upsert",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.onConflict,i=n.ignoreDuplicates,a=void 0!==i&&i,s=n.count,u=n.defaultToNull,c=void 0===u||u,l=this.cloneRequestState(),h=l.url,f=l.headers;if(f.append("Prefer","resolution=".concat(a?"ignore":"merge","-duplicates")),void 0!==r&&h.searchParams.set("on_conflict",r),s&&f.append("Prefer","count=".concat(s)),c||f.append("Prefer","missing=default"),Array.isArray(e)){var d=e.reduce(function(e,t){return e.concat(Object.keys(t))},[]);if(d.length>0){var p=o(new Set(d)).map(function(e){return'"'.concat(e,'"')});h.searchParams.set("columns",p.join(","))}}return new R({method:"POST",url:h,headers:f,schema:this.schema,body:e,fetch:null!==(t=this.fetch)&&void 0!==t?t:fetch,urlLengthLimit:this.urlLengthLimit})}},{key:"update",value:function(e){var t,n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).count,r=this.cloneRequestState(),i=r.url,a=r.headers;return n&&a.append("Prefer","count=".concat(n)),new R({method:"PATCH",url:i,headers:a,schema:this.schema,body:e,fetch:null!==(t=this.fetch)&&void 0!==t?t:fetch,urlLengthLimit:this.urlLengthLimit})}},{key:"delete",value:function(){var e,t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).count,n=this.cloneRequestState(),r=n.url,i=n.headers;return t&&i.append("Prefer","count=".concat(t)),new R({method:"DELETE",url:r,headers:i,schema:this.schema,fetch:null!==(e=this.fetch)&&void 0!==e?e:fetch,urlLengthLimit:this.urlLengthLimit})}}])}();function j(e){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function P(e){var t=function(e,t){if("object"!=j(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=j(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==j(t)?t:t+""}function I(e,t,n){return(t=P(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach(function(t){I(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var x,U,L,D,B,q=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.headers,i=void 0===r?{}:r,a=n.schema,s=n.fetch,o=n.timeout,u=n.urlLengthLimit,c=void 0===u?8e3:u;g(this,e),this.url=t,this.headers=new Headers(i),this.schemaName=a,this.urlLengthLimit=c;var l=null!=s?s:globalThis.fetch;this.fetch=void 0!==o&&o>0?function(e,t){var n=new AbortController,r=setTimeout(function(){return n.abort()},o),i=null==t?void 0:t.signal;if(i){if(i.aborted)return clearTimeout(r),l(e,t);var a=function(){clearTimeout(r),n.abort()};return i.addEventListener("abort",a,{once:!0}),l(e,N(N({},t),{},{signal:n.signal})).finally(function(){clearTimeout(r),i.removeEventListener("abort",a)})}return l(e,N(N({},t),{},{signal:n.signal})).finally(function(){return clearTimeout(r)})}:l}return y(e,[{key:"from",value:function(e){if(!e||"string"!=typeof e||""===e.trim())throw new Error("Invalid relation name: relation must be a non-empty string.");return new A(new URL("".concat(this.url,"/").concat(e)),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}},{key:"schema",value:function(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}},{key:"rpc",value:function(e){var t,n,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=a.head,c=void 0!==o&&o,l=a.get,h=void 0!==l&&l,f=a.count,d=new URL("".concat(this.url,"/rpc/").concat(e)),p=function(e){return null!==e&&"object"===s(e)&&(!Array.isArray(e)||e.some(p))},v=c&&Object.values(i).some(p);v?(n="POST",r=i):c||h?(n=c?"HEAD":"GET",Object.entries(i).filter(function(e){var t=u(e,2);t[0];return void 0!==t[1]}).map(function(e){var t=u(e,2),n=t[0],r=t[1];return[n,Array.isArray(r)?"{".concat(r.join(","),"}"):"".concat(r)]}).forEach(function(e){var t=u(e,2),n=t[0],r=t[1];d.searchParams.append(n,r)})):(n="POST",r=i);var y=new Headers(this.headers);return v?y.set("Prefer",f?"count=".concat(f,",return=minimal"):"return=minimal"):f&&y.set("Prefer","count=".concat(f)),new R({method:n,url:d,headers:y,schema:this.schemaName,body:r,fetch:null!==(t=this.fetch)&&void 0!==t?t:fetch,urlLengthLimit:this.urlLengthLimit})}}])}(),K=function(){return y(function e(){g(this,e)},null,[{key:"detectEnvironment",value:function(){var e;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!=typeof global&&void 0!==global.WebSocket)return{type:"native",constructor:global.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};var t=globalThis.process;if(t){var n=t.versions;if(n&&n.node){var r=n.node,i=parseInt(r.replace(/^v/,"").split(".")[0]);return i>=22?void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:"Node.js ".concat(i," detected but native WebSocket not found."),workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:"Node.js ".concat(i," detected without native WebSocket support."),workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}},{key:"getWebSocketConstructor",value:function(){var e=this.detectEnvironment();if(e.constructor)return e.constructor;var t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+="\n\nSuggested solution: ".concat(e.workaround)),new Error(t)}},{key:"createWebSocket",value:function(e,t){return new(this.getWebSocketConstructor())(e,t)}},{key:"isWebSocketSupported",value:function(){try{var e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(t){return!1}}}])}(),W="realtime-js/".concat("2.95.3"),M="2.0.0",F=M,G=1e4;!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(x||(x={})),function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"}(U||(U={})),function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(L||(L={})),function(e){e.websocket="websocket"}(D||(D={})),function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(B||(B={}));var H,J=function(){return y(function e(t){g(this,e),this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=null!=t?t:[]},[{key:"encode",value:function(e,t){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&"string"==typeof e.payload.event)return t(this._binaryEncodeUserBroadcastPush(e));var n=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(n))}},{key:"_binaryEncodeUserBroadcastPush",value:function(e){var t;return this._isArrayBuffer(null===(t=e.payload)||void 0===t?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}},{key:"_encodeBinaryUserBroadcastPush",value:function(e){var t,n,r=null!==(n=null===(t=e.payload)||void 0===t?void 0:t.payload)&&void 0!==n?n:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,r)}},{key:"_encodeJsonUserBroadcastPush",value:function(e){var t,n,r=null!==(n=null===(t=e.payload)||void 0===t?void 0:t.payload)&&void 0!==n?n:{},i=(new TextEncoder).encode(JSON.stringify(r)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,i)}},{key:"_encodeUserBroadcastPush",value:function(e,t,n){var r,i,a=e.topic,s=null!==(r=e.ref)&&void 0!==r?r:"",o=null!==(i=e.join_ref)&&void 0!==i?i:"",u=e.payload.event,c=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},l=0===Object.keys(c).length?"":JSON.stringify(c);if(o.length>255)throw new Error("joinRef length ".concat(o.length," exceeds maximum of 255"));if(s.length>255)throw new Error("ref length ".concat(s.length," exceeds maximum of 255"));if(a.length>255)throw new Error("topic length ".concat(a.length," exceeds maximum of 255"));if(u.length>255)throw new Error("userEvent length ".concat(u.length," exceeds maximum of 255"));if(l.length>255)throw new Error("metadata length ".concat(l.length," exceeds maximum of 255"));var h=this.USER_BROADCAST_PUSH_META_LENGTH+o.length+s.length+a.length+u.length+l.length,f=new ArrayBuffer(this.HEADER_LENGTH+h),d=new DataView(f),p=0;d.setUint8(p++,this.KINDS.userBroadcastPush),d.setUint8(p++,o.length),d.setUint8(p++,s.length),d.setUint8(p++,a.length),d.setUint8(p++,u.length),d.setUint8(p++,l.length),d.setUint8(p++,t),Array.from(o,function(e){return d.setUint8(p++,e.charCodeAt(0))}),Array.from(s,function(e){return d.setUint8(p++,e.charCodeAt(0))}),Array.from(a,function(e){return d.setUint8(p++,e.charCodeAt(0))}),Array.from(u,function(e){return d.setUint8(p++,e.charCodeAt(0))}),Array.from(l,function(e){return d.setUint8(p++,e.charCodeAt(0))});var v=new Uint8Array(f.byteLength+n.byteLength);return v.set(new Uint8Array(f),0),v.set(new Uint8Array(n),f.byteLength),v.buffer}},{key:"decode",value:function(e,t){if(this._isArrayBuffer(e))return t(this._binaryDecode(e));if("string"==typeof e){var n=u(JSON.parse(e),5);return t({join_ref:n[0],ref:n[1],topic:n[2],event:n[3],payload:n[4]})}return t({})}},{key:"_binaryDecode",value:function(e){var t=new DataView(e),n=t.getUint8(0),r=new TextDecoder;if(n===this.KINDS.userBroadcast)return this._decodeUserBroadcast(e,t,r)}},{key:"_decodeUserBroadcast",value:function(e,t,n){var r=t.getUint8(1),i=t.getUint8(2),a=t.getUint8(3),s=t.getUint8(4),o=this.HEADER_LENGTH+4,u=n.decode(e.slice(o,o+r));o+=r;var c=n.decode(e.slice(o,o+i));o+=i;var l=n.decode(e.slice(o,o+a));o+=a;var h=e.slice(o,e.byteLength),f=s===this.JSON_ENCODING?JSON.parse(n.decode(h)):h,d={type:this.BROADCAST_EVENT,event:c,payload:f};return a>0&&(d.meta=JSON.parse(l)),{join_ref:null,ref:null,topic:u,event:this.BROADCAST_EVENT,payload:d}}},{key:"_isArrayBuffer",value:function(e){var t;return e instanceof ArrayBuffer||"ArrayBuffer"===(null===(t=null==e?void 0:e.constructor)||void 0===t?void 0:t.name)}},{key:"_pick",value:function(e,t){return e&&"object"===s(e)?Object.fromEntries(Object.entries(e).filter(function(e){var n=u(e,1)[0];return t.includes(n)})):{}}}])}(),V=function(){return y(function e(t,n){g(this,e),this.callback=t,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=n},[{key:"reset",value:function(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}},{key:"scheduleTimeout",value:function(){var e=this;clearTimeout(this.timer),this.timer=setTimeout(function(){e.tries=e.tries+1,e.callback()},this.timerCalc(this.tries+1))}}])}();!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(H||(H={}));var z,Y=function(e,t){var n,r=null!==(n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).skipTypes)&&void 0!==n?n:[];return t?Object.keys(t).reduce(function(n,i){return n[i]=$(i,e,t,r),n},{}):{}},$=function(e,t,n,r){var i=t.find(function(t){return t.name===e}),a=null==i?void 0:i.type,s=n[e];return a&&!r.includes(a)?X(a,s):Q(s)},X=function(e,t){if("_"===e.charAt(0)){var n=e.slice(1,e.length);return ne(t,n)}switch(e){case H.bool:return Z(t);case H.float4:case H.float8:case H.int2:case H.int4:case H.int8:case H.numeric:case H.oid:return ee(t);case H.json:case H.jsonb:return te(t);case H.timestamp:return re(t);case H.abstime:case H.date:case H.daterange:case H.int4range:case H.int8range:case H.money:case H.reltime:case H.text:case H.time:case H.timestamptz:case H.timetz:case H.tsrange:case H.tstzrange:default:return Q(t)}},Q=function(e){return e},Z=function(e){switch(e){case"t":return!0;case"f":return!1;default:return e}},ee=function(e){if("string"==typeof e){var t=parseFloat(e);if(!Number.isNaN(t))return t}return e},te=function(e){if("string"==typeof e)try{return JSON.parse(e)}catch(t){return e}return e},ne=function(e,t){if("string"!=typeof e)return e;var n=e.length-1,r=e[n];if("{"===e[0]&&"}"===r){var i,a=e.slice(1,n);try{i=JSON.parse("["+a+"]")}catch(s){i=a?a.split(","):[]}return i.map(function(e){return X(t,e)})}return e},re=function(e){return"string"==typeof e?e.replace(" ","T"):e},ie=function(e){var t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),""===t.pathname||"/"===t.pathname?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href},ae=function(){return y(function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:G;g(this,e),this.channel=t,this.event=n,this.payload=r,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null},[{key:"resend",value:function(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}},{key:"send",value:function(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}},{key:"updatePayload",value:function(e){this.payload=Object.assign(Object.assign({},this.payload),e)}},{key:"receive",value:function(e,t){var n;return this._hasReceived(e)&&t(null===(n=this.receivedResp)||void 0===n?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}},{key:"startTimeout",value:function(){var e=this;if(!this.timeoutTimer){this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},function(t){e._cancelRefEvent(),e._cancelTimeout(),e.receivedResp=t,e._matchReceive(t)}),this.timeoutTimer=setTimeout(function(){e.trigger("timeout",{})},this.timeout)}}},{key:"trigger",value:function(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}},{key:"destroy",value:function(){this._cancelRefEvent(),this._cancelTimeout()}},{key:"_cancelRefEvent",value:function(){this.refEvent&&this.channel._off(this.refEvent,{})}},{key:"_cancelTimeout",value:function(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}},{key:"_matchReceive",value:function(e){var t=e.status,n=e.response;this.recHooks.filter(function(e){return e.status===t}).forEach(function(e){return e.callback(n)})}},{key:"_hasReceived",value:function(e){return this.receivedResp&&this.receivedResp.status===e}}])}();!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(z||(z={}));var se,oe,ue,ce=function(){return y(function e(t,n){var r=this;g(this,e),this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:function(){},onLeave:function(){},onSync:function(){}};var i=(null==n?void 0:n.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(i.state,{},function(t){var n=r.caller,i=n.onJoin,a=n.onLeave,s=n.onSync;r.joinRef=r.channel._joinRef(),r.state=e.syncState(r.state,t,i,a),r.pendingDiffs.forEach(function(t){r.state=e.syncDiff(r.state,t,i,a)}),r.pendingDiffs=[],s()}),this.channel._on(i.diff,{},function(t){var n=r.caller,i=n.onJoin,a=n.onLeave,s=n.onSync;r.inPendingSyncState()?r.pendingDiffs.push(t):(r.state=e.syncDiff(r.state,t,i,a),s())}),this.onJoin(function(e,t,n){r.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:n})}),this.onLeave(function(e,t,n){r.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:n})}),this.onSync(function(){r.channel._trigger("presence",{event:"sync"})})},[{key:"onJoin",value:function(e){this.caller.onJoin=e}},{key:"onLeave",value:function(e){this.caller.onLeave=e}},{key:"onSync",value:function(e){this.caller.onSync=e}},{key:"inPendingSyncState",value:function(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}],[{key:"syncState",value:function(e,t,n,r){var i=this.cloneDeep(e),a=this.transformState(t),s={},o={};return this.map(i,function(e,t){a[e]||(o[e]=t)}),this.map(a,function(e,t){var n=i[e];if(n){var r=t.map(function(e){return e.presence_ref}),a=n.map(function(e){return e.presence_ref}),u=t.filter(function(e){return a.indexOf(e.presence_ref)<0}),c=n.filter(function(e){return r.indexOf(e.presence_ref)<0});u.length>0&&(s[e]=u),c.length>0&&(o[e]=c)}else s[e]=t}),this.syncDiff(i,{joins:s,leaves:o},n,r)}},{key:"syncDiff",value:function(e,t,n,r){var i=this,a={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)},s=a.joins,u=a.leaves;return n||(n=function(){}),r||(r=function(){}),this.map(s,function(t,r){var a,s=null!==(a=e[t])&&void 0!==a?a:[];if(e[t]=i.cloneDeep(r),s.length>0){var u,c=e[t].map(function(e){return e.presence_ref}),l=s.filter(function(e){return c.indexOf(e.presence_ref)<0});(u=e[t]).unshift.apply(u,o(l))}n(t,s,r)}),this.map(u,function(t,n){var i=e[t];if(i){var a=n.map(function(e){return e.presence_ref});i=i.filter(function(e){return a.indexOf(e.presence_ref)<0}),e[t]=i,r(t,i,n),0===i.length&&delete e[t]}}),e}},{key:"map",value:function(e,t){return Object.getOwnPropertyNames(e).map(function(n){return t(n,e[n])})}},{key:"transformState",value:function(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce(function(t,n){var r=e[n];return t[n]="metas"in r?r.metas.map(function(e){return e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e}):r,t},{})}},{key:"cloneDeep",value:function(e){return JSON.parse(JSON.stringify(e))}}])}();!function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"}(se||(se={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"}(oe||(oe={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}(ue||(ue={}));var le=function(){function e(t){var n,r,i=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}},s=arguments.length>2?arguments[2]:void 0;if(g(this,e),this.topic=t,this.params=a,this.socket=s,this.bindings={},this.state=U.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},a.config),this.timeout=this.socket.timeout,this.joinPush=new ae(this,L.join,this.params,this.timeout),this.rejoinTimer=new V(function(){return i._rejoinUntilConnected()},this.socket.reconnectAfterMs),this.joinPush.receive("ok",function(){i.state=U.joined,i.rejoinTimer.reset(),i.pushBuffer.forEach(function(e){return e.send()}),i.pushBuffer=[]}),this._onClose(function(){i.rejoinTimer.reset(),i.socket.log("channel","close ".concat(i.topic," ").concat(i._joinRef())),i.state=U.closed,i.socket._remove(i)}),this._onError(function(e){i._isLeaving()||i._isClosed()||(i.socket.log("channel","error ".concat(i.topic),e),i.state=U.errored,i.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",function(){i._isJoining()&&(i.socket.log("channel","timeout ".concat(i.topic),i.joinPush.timeout),i.state=U.errored,i.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",function(e){i._isLeaving()||i._isClosed()||(i.socket.log("channel","error ".concat(i.topic),e),i.state=U.errored,i.rejoinTimer.scheduleTimeout())}),this._on(L.reply,{},function(e,t){i._trigger(i._replyEventName(t),e)}),this.presence=new ce(this),this.broadcastEndpointURL=ie(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null===(r=null===(n=this.params.config)||void 0===n?void 0:n.broadcast)||void 0===r?void 0:r.replay))throw"tried to use replay on public channel '".concat(this.topic,"'. It must be a private channel.")}return y(e,[{key:"subscribe",value:function(t){var n,r,i,a=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.timeout;if(this.socket.isConnected()||this.socket.connect(),this.state==U.closed){var o=this.params.config,u=o.broadcast,c=o.presence,l=o.private,h=null!==(r=null===(n=this.bindings.postgres_changes)||void 0===n?void 0:n.map(function(e){return e.filter}))&&void 0!==r?r:[],p=!!this.bindings[oe.PRESENCE]&&this.bindings[oe.PRESENCE].length>0||!0===(null===(i=this.params.config.presence)||void 0===i?void 0:i.enabled),v={},y={broadcast:u,presence:Object.assign(Object.assign({},c),{enabled:p}),postgres_changes:h,private:l};this.socket.accessTokenValue&&(v.access_token=this.socket.accessTokenValue),this._onError(function(e){return null==t?void 0:t(ue.CHANNEL_ERROR,e)}),this._onClose(function(){return null==t?void 0:t(ue.CLOSED)}),this.updateJoinPayload(Object.assign({config:y},v)),this.joinedOnce=!0,this._rejoin(s),this.joinPush.receive("ok",function(){var n=f(d().m(function n(r){var i,s,o,u,c,l,h,f,p,v,y,m,g;return d().w(function(n){for(;;)switch(n.n){case 0:if(i=r.postgres_changes,a.socket._isManualToken()||a.socket.setAuth(),void 0!==i){n.n=1;break}return null==t||t(ue.SUBSCRIBED),n.a(2);case 1:o=a.bindings.postgres_changes,u=null!==(s=null==o?void 0:o.length)&&void 0!==s?s:0,c=[],l=0;case 2:if(!(l<u)){n.n=5;break}if(h=o[l],f=h.filter,p=f.event,v=f.schema,y=f.table,m=f.filter,!((g=i&&i[l])&&g.event===p&&e.isFilterValueEqual(g.schema,v)&&e.isFilterValueEqual(g.table,y)&&e.isFilterValueEqual(g.filter,m))){n.n=3;break}c.push(Object.assign(Object.assign({},h),{id:g.id})),n.n=4;break;case 3:return a.unsubscribe(),a.state=U.errored,null==t||t(ue.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")),n.a(2);case 4:l++,n.n=2;break;case 5:return a.bindings.postgres_changes=c,t&&t(ue.SUBSCRIBED),n.a(2);case 6:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}()).receive("error",function(e){a.state=U.errored,null==t||t(ue.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(e).join(", ")||"error")))}).receive("timeout",function(){null==t||t(ue.TIMED_OUT)})}return this}},{key:"presenceState",value:function(){return this.presence.state}},{key:"track",value:(a=f(d().m(function e(t){var n,r=arguments;return d().w(function(e){for(;;)switch(e.n){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.n=1,this.send({type:"presence",event:"track",payload:t},n.timeout||this.timeout);case 1:return e.a(2,e.v)}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"untrack",value:(i=f(d().m(function e(){var t,n=arguments;return d().w(function(e){for(;;)switch(e.n){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.n=1,this.send({type:"presence",event:"untrack"},t);case 1:return e.a(2,e.v)}},e,this)})),function(){return i.apply(this,arguments)})},{key:"on",value:function(e,t,n){var r=this;return this.state===U.joined&&e===oe.PRESENCE&&(this.socket.log("channel","resubscribe to ".concat(this.topic," due to change in presence callbacks on joined channel")),this.unsubscribe().then(f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,r.subscribe();case 1:return e.a(2,e.v)}},e)})))),this._on(e,t,n)}},{key:"httpSend",value:(r=f(d().m(function e(t,n){var r,i,a,s,o,u,c,l=arguments;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r=l.length>2&&void 0!==l[2]?l[2]:{},null!=n){e.n=1;break}return e.a(2,Promise.reject("Payload is required for httpSend()"));case 1:return a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},this.socket.accessTokenValue&&(a.Authorization="Bearer ".concat(this.socket.accessTokenValue)),s={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:n,private:this.private}]})},e.n=2,this._fetchWithTimeout(this.broadcastEndpointURL,s,null!==(i=r.timeout)&&void 0!==i?i:this.timeout);case 2:if(202!==(o=e.v).status){e.n=3;break}return e.a(2,{success:!0});case 3:return u=o.statusText,e.p=4,e.n=5,o.json();case 5:c=e.v,u=c.error||c.message||u,e.n=7;break;case 6:e.p=6,e.v;case 7:return e.a(2,Promise.reject(new Error(u)))}},e,this,[[4,6]])})),function(e,t){return r.apply(this,arguments)})},{key:"send",value:(n=f(d().m(function e(t){var n,r,i,a,s,o,u,c,l=this,h=arguments;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=h.length>1&&void 0!==h[1]?h[1]:{},this._canPush()||"broadcast"!==t.type){e.n=7;break}return a=t.event,s=t.payload,o={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},this.socket.accessTokenValue&&(o.Authorization="Bearer ".concat(this.socket.accessTokenValue)),u={method:"POST",headers:o,body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:s,private:this.private}]})},e.p=1,e.n=2,this._fetchWithTimeout(this.broadcastEndpointURL,u,null!==(r=n.timeout)&&void 0!==r?r:this.timeout);case 2:return c=e.v,e.n=3,null===(i=c.body)||void 0===i?void 0:i.cancel();case 3:return e.a(2,c.ok?"ok":"error");case 4:if(e.p=4,"AbortError"!==e.v.name){e.n=5;break}return e.a(2,"timed out");case 5:return e.a(2,"error");case 6:e.n=8;break;case 7:return e.a(2,new Promise(function(e){var r,i,a,s=l._push(t.type,t,n.timeout||l.timeout);"broadcast"!==t.type||(null===(a=null===(i=null===(r=l.params)||void 0===r?void 0:r.config)||void 0===i?void 0:i.broadcast)||void 0===a?void 0:a.ack)||e("ok"),s.receive("ok",function(){return e("ok")}),s.receive("error",function(){return e("error")}),s.receive("timeout",function(){return e("timed out")})}));case 8:return e.a(2)}},e,this,[[1,4]])})),function(e){return n.apply(this,arguments)})},{key:"updateJoinPayload",value:function(e){this.joinPush.updatePayload(e)}},{key:"unsubscribe",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this.state=U.leaving;var n=function(){e.socket.log("channel","leave ".concat(e.topic)),e._trigger(L.close,"leave",e._joinRef())};this.joinPush.destroy();var r=null;return new Promise(function(i){(r=new ae(e,L.leave,{},t)).receive("ok",function(){n(),i("ok")}).receive("timeout",function(){n(),i("timed out")}).receive("error",function(){i("error")}),r.send(),e._canPush()||r.trigger("ok",{})}).finally(function(){null==r||r.destroy()})}},{key:"teardown",value:function(){this.pushBuffer.forEach(function(e){return e.destroy()}),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=U.closed,this.bindings={}}},{key:"_fetchWithTimeout",value:(t=f(d().m(function e(t,n,r){var i,a,s;return d().w(function(e){for(;;)switch(e.n){case 0:return i=new AbortController,a=setTimeout(function(){return i.abort()},r),e.n=1,this.socket.fetch(t,Object.assign(Object.assign({},n),{signal:i.signal}));case 1:return s=e.v,clearTimeout(a),e.a(2,s)}},e,this)})),function(e,n,r){return t.apply(this,arguments)})},{key:"_push",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.timeout;if(!this.joinedOnce)throw"tried to push '".concat(e,"' to '").concat(this.topic,"' before joining. Use channel.subscribe() before pushing events");var r=new ae(this,e,t,n);return this._canPush()?r.send():this._addToPushBuffer(r),r}},{key:"_addToPushBuffer",value:function(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){var t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel","discarded push due to buffer overflow: ".concat(t.event),t.payload))}}},{key:"_onMessage",value:function(e,t,n){return t}},{key:"_isMember",value:function(e){return this.topic===e}},{key:"_joinRef",value:function(){return this.joinPush.ref}},{key:"_trigger",value:function(e,t,n){var r,i,a=this,o=e.toLocaleLowerCase(),u=L,c=u.close,l=u.error,h=u.leave,f=u.join;if(!(n&&[c,l,h,f].indexOf(o)>=0&&n!==this._joinRef())){var d=this._onMessage(o,t,n);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?null===(r=this.bindings.postgres_changes)||void 0===r||r.filter(function(e){var t,n,r;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(r=null===(n=e.filter)||void 0===n?void 0:n.event)||void 0===r?void 0:r.toLocaleLowerCase())===o}).map(function(e){return e.callback(d,n)}):null===(i=this.bindings[o])||void 0===i||i.filter(function(e){var n,r,i,a,s,u;if(["broadcast","presence","postgres_changes"].includes(o)){if("id"in e){var c=e.id,l=null===(n=e.filter)||void 0===n?void 0:n.event;return c&&(null===(r=t.ids)||void 0===r?void 0:r.includes(c))&&("*"===l||(null==l?void 0:l.toLocaleLowerCase())===(null===(i=t.data)||void 0===i?void 0:i.type.toLocaleLowerCase()))}var h=null===(s=null===(a=null==e?void 0:e.filter)||void 0===a?void 0:a.event)||void 0===s?void 0:s.toLocaleLowerCase();return"*"===h||h===(null===(u=null==t?void 0:t.event)||void 0===u?void 0:u.toLocaleLowerCase())}return e.type.toLocaleLowerCase()===o}).map(function(e){if("object"===s(d)&&"ids"in d){var t=d.data,r={schema:t.schema,table:t.table,commit_timestamp:t.commit_timestamp,eventType:t.type,new:{},old:{},errors:t.errors};d=Object.assign(Object.assign({},r),a._getPayloadRecords(t))}e.callback(d,n)})}}},{key:"_isClosed",value:function(){return this.state===U.closed}},{key:"_isJoined",value:function(){return this.state===U.joined}},{key:"_isJoining",value:function(){return this.state===U.joining}},{key:"_isLeaving",value:function(){return this.state===U.leaving}},{key:"_replyEventName",value:function(e){return"chan_reply_".concat(e)}},{key:"_on",value:function(e,t,n){var r=e.toLocaleLowerCase(),i={type:r,filter:t,callback:n};return this.bindings[r]?this.bindings[r].push(i):this.bindings[r]=[i],this}},{key:"_off",value:function(t,n){var r=t.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(function(t){var i;return!((null===(i=t.type)||void 0===i?void 0:i.toLocaleLowerCase())===r&&e.isEqual(t.filter,n))})),this}},{key:"_rejoinUntilConnected",value:function(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}},{key:"_onClose",value:function(e){this._on(L.close,{},e)}},{key:"_onError",value:function(e){this._on(L.error,{},function(t){return e(t)})}},{key:"_canPush",value:function(){return this.socket.isConnected()&&this._isJoined()}},{key:"_rejoin",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=U.joining,this.joinPush.resend(e))}},{key:"_getPayloadRecords",value:function(e){var t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=Y(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=Y(e.columns,e.old_record)),t}}],[{key:"isEqual",value:function(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var n in e)if(e[n]!==t[n])return!1;return!0}},{key:"isFilterValueEqual",value:function(e,t){return(null!=e?e:void 0)===(null!=t?t:void 0)}}]);var t,n,r,i,a}(),he=function(){},fe=25e3,de=10,pe=100,ve=[1e3,2e3,5e3,1e4],ye=function(){return y(function e(t,n){var r;if(g(this,e),this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=G,this.transport=null,this.heartbeatIntervalMs=fe,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=he,this.ref=0,this.reconnectTimer=null,this.vsn=F,this.logger=he,this.conn=null,this.sendBuffer=[],this.serializer=new J,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=function(e){return e?function(){return e.apply(void 0,arguments)}:function(){return fetch.apply(void 0,arguments)}},!(null===(r=null==n?void 0:n.params)||void 0===r?void 0:r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint="".concat(t,"/").concat(D.websocket),this.httpEndpoint=ie(t),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null==n?void 0:n.fetch)},[{key:"connect",value:function(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=K.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");var e=t.message;if(e.includes("Node.js"))throw new Error("".concat(e,"\n\n")+'To use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })');throw new Error("WebSocket not available: ".concat(e))}this._setupConnectionHandlers()}}},{key:"endpointURL",value:function(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}},{key:"disconnect",value:function(e,t){var n=this;if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){var r=setTimeout(function(){n._setConnectionState("disconnected")},100);this.conn.onclose=function(){clearTimeout(r),n._setConnectionState("disconnected")},"function"==typeof this.conn.close&&(e?this.conn.close(e,null!=t?t:""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}},{key:"getChannels",value:function(){return this.channels}},{key:"removeChannel",value:(a=f(d().m(function e(t){var n;return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.unsubscribe();case 1:return"ok"===(n=e.v)&&this._remove(t),0===this.channels.length&&this.disconnect(),e.a(2,n)}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"removeAllChannels",value:(i=f(d().m(function e(){var t;return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Promise.all(this.channels.map(function(e){return e.unsubscribe()}));case 1:return t=e.v,this.channels=[],this.disconnect(),e.a(2,t)}},e,this)})),function(){return i.apply(this,arguments)})},{key:"log",value:function(e,t,n){this.logger(e,t,n)}},{key:"connectionState",value:function(){switch(this.conn&&this.conn.readyState){case x.connecting:return B.Connecting;case x.open:return B.Open;case x.closing:return B.Closing;default:return B.Closed}}},{key:"isConnected",value:function(){return this.connectionState()===B.Open}},{key:"isConnecting",value:function(){return"connecting"===this._connectionState}},{key:"isDisconnecting",value:function(){return"disconnecting"===this._connectionState}},{key:"channel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}},n="realtime:".concat(e),r=this.getChannels().find(function(e){return e.topic===n});if(r)return r;var i=new le("realtime:".concat(e),t,this);return this.channels.push(i),i}},{key:"push",value:function(e){var t=this,n=e.topic,r=e.event,i=e.payload,a=e.ref,s=function(){t.encode(e,function(e){var n;null===(n=t.conn)||void 0===n||n.send(e)})};this.log("push","".concat(n," ").concat(r," (").concat(a,")"),i),this.isConnected()?s():this.sendBuffer.push(s)}},{key:"setAuth",value:(r=f(d().m(function e(){var t,n=arguments;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:null,this._authPromise=this._performAuth(t),e.p=1,e.n=2,this._authPromise;case 2:return e.p=2,this._authPromise=null,e.f(2);case 3:return e.a(2)}},e,this,[[1,,2,3]])})),function(){return r.apply(this,arguments)})},{key:"_isManualToken",value:function(){return this._manuallySetToken}},{key:"sendHeartbeat",value:(n=f(d().m(function e(){var t,n=this;return d().w(function(e){for(;;)switch(e.n){case 0:if(this.isConnected()){e.n=1;break}try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return e.a(2);case 1:if(!this.pendingHeartbeatRef){e.n=2;break}this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}return this._wasManualDisconnect=!1,null===(t=this.conn)||void 0===t||t.close(1e3,"heartbeat timeout"),setTimeout(function(){var e;n.isConnected()||null===(e=n.reconnectTimer)||void 0===e||e.scheduleTimeout()},pe),e.a(2);case 2:this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat");case 3:return e.a(2)}},e,this)})),function(){return n.apply(this,arguments)})},{key:"onHeartbeat",value:function(e){this.heartbeatCallback=e}},{key:"flushSendBuffer",value:function(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(function(e){return e()}),this.sendBuffer=[])}},{key:"_makeRef",value:function(){var e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}},{key:"_leaveOpenTopic",value:function(e){var t=this.channels.find(function(t){return t.topic===e&&(t._isJoined()||t._isJoining())});t&&(this.log("transport",'leaving duplicate topic "'.concat(e,'"')),t.unsubscribe())}},{key:"_remove",value:function(e){this.channels=this.channels.filter(function(t){return t.topic!==e.topic})}},{key:"_onConnMessage",value:function(e){var t=this;this.decode(e.data,function(e){if("phoenix"===e.topic&&"phx_reply"===e.event&&e.ref&&e.ref===t.pendingHeartbeatRef){var n=t._heartbeatSentAt?Date.now()-t._heartbeatSentAt:void 0;try{t.heartbeatCallback("ok"===e.payload.status?"ok":"error",n)}catch(c){t.log("error","error in heartbeat callback",c)}t._heartbeatSentAt=null,t.pendingHeartbeatRef=null}var r=e.topic,i=e.event,a=e.payload,s=e.ref,o=s?"(".concat(s,")"):"",u=a.status||"";t.log("receive","".concat(u," ").concat(r," ").concat(i," ").concat(o).trim(),a),t.channels.filter(function(e){return e._isMember(r)}).forEach(function(e){return e._trigger(i,a,s)}),t._triggerStateCallbacks("message",e)})}},{key:"_clearTimer",value:function(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null===(t=this.reconnectTimer)||void 0===t||t.reset())}},{key:"_clearAllTimers",value:function(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}},{key:"_setupConnectionHandlers",value:function(){var e=this;this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=function(){return e._onConnOpen()},this.conn.onerror=function(t){return e._onConnError(t)},this.conn.onmessage=function(t){return e._onConnMessage(t)},this.conn.onclose=function(t){return e._onConnClose(t)},this.conn.readyState===x.open&&this._onConnOpen())}},{key:"_teardownConnection",value:function(){if(this.conn){if(this.conn.readyState===x.open||this.conn.readyState===x.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(function(e){return e.teardown()})}},{key:"_onConnOpen",value:function(){var e=this;this._setConnectionState("connected"),this.log("transport","connected to ".concat(this.endpointURL())),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(function(){e.flushSendBuffer()}).catch(function(t){e.log("error","error waiting for auth on connect",t),e.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}},{key:"_startHeartbeat",value:function(){var e=this;this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(function(){return e.sendHeartbeat()},this.heartbeatIntervalMs)}},{key:"_startWorkerHeartbeat",value:function(){var e=this;this.workerUrl?this.log("worker","starting worker for from ".concat(this.workerUrl)):this.log("worker","starting default worker");var t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=function(t){e.log("worker","worker error",t.message),e._terminateWorker()},this.workerRef.onmessage=function(t){"keepAlive"===t.data.event&&e.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}},{key:"_terminateWorker",value:function(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}},{key:"_onConnClose",value:function(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}},{key:"_onConnError",value:function(e){this._setConnectionState("disconnected"),this.log("transport","".concat(e)),this._triggerChanError(),this._triggerStateCallbacks("error",e);try{this.heartbeatCallback("error")}catch(t){this.log("error","error in heartbeat callback",t)}}},{key:"_triggerChanError",value:function(){this.channels.forEach(function(e){return e._trigger(L.error)})}},{key:"_appendParams",value:function(e,t){if(0===Object.keys(t).length)return e;var n=e.match(/\?/)?"&":"?",r=new URLSearchParams(t);return"".concat(e).concat(n).concat(r)}},{key:"_workerObjectUrl",value:function(e){var t;if(e)t=e;else{var n=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(n)}return t}},{key:"_setConnectionState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}},{key:"_performAuth",value:(t=f(d().m(function e(){var t,n,r,i,a=arguments;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r=!1,!(t=a.length>0&&void 0!==a[0]?a[0]:null)){e.n=1;break}n=t,r=!0,e.n=7;break;case 1:if(!this.accessToken){e.n=6;break}return e.p=2,e.n=3,this.accessToken();case 3:n=e.v,e.n=5;break;case 4:e.p=4,i=e.v,this.log("error","Error fetching access token from callback",i),n=this.accessTokenValue;case 5:e.n=7;break;case 6:n=this.accessTokenValue;case 7:r?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(function(e){var t={access_token:n,version:W};n&&e.updateJoinPayload(t),e.joinedOnce&&e._isJoined()&&e._push(L.access_token,{access_token:n})}));case 8:return e.a(2)}},e,this,[[2,4]])})),function(){return t.apply(this,arguments)})},{key:"_waitForAuthIfNeeded",value:(e=f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:if(!this._authPromise){e.n=1;break}return e.n=1,this._authPromise;case 1:return e.a(2)}},e,this)})),function(){return e.apply(this,arguments)})},{key:"_setAuthSafely",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"general";this._isManualToken()||this.setAuth().catch(function(n){e.log("error","Error setting auth in ".concat(t),n)})}},{key:"_triggerStateCallbacks",value:function(e,t){var n=this;try{this.stateChangeCallbacks[e].forEach(function(r){try{r(t)}catch(i){n.log("error","error in ".concat(e," callback"),i)}})}catch(r){this.log("error","error triggering ".concat(e," callbacks"),r)}}},{key:"_setupReconnectionTimer",value:function(){var e=this;this.reconnectTimer=new V(f(d().m(function t(){return d().w(function(t){for(;;)switch(t.n){case 0:setTimeout(f(d().m(function t(){return d().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,e._waitForAuthIfNeeded();case 1:e.isConnected()||e.connect();case 2:return t.a(2)}},t)})),de);case 1:return t.a(2)}},t)})),this.reconnectAfterMs)}},{key:"_initializeOptions",value:function(e){var t,n,r,i,a,s,o,u,c,l,h,f;switch(this.transport=null!==(t=null==e?void 0:e.transport)&&void 0!==t?t:null,this.timeout=null!==(n=null==e?void 0:e.timeout)&&void 0!==n?n:G,this.heartbeatIntervalMs=null!==(r=null==e?void 0:e.heartbeatIntervalMs)&&void 0!==r?r:fe,this.worker=null!==(i=null==e?void 0:e.worker)&&void 0!==i&&i,this.accessToken=null!==(a=null==e?void 0:e.accessToken)&&void 0!==a?a:null,this.heartbeatCallback=null!==(s=null==e?void 0:e.heartbeatCallback)&&void 0!==s?s:he,this.vsn=null!==(o=null==e?void 0:e.vsn)&&void 0!==o?o:F,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.logger)&&(this.logger=e.logger),((null==e?void 0:e.logLevel)||(null==e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(u=null==e?void 0:e.reconnectAfterMs)&&void 0!==u?u:function(e){return ve[e-1]||1e4},this.vsn){case"1.0.0":this.encode=null!==(c=null==e?void 0:e.encode)&&void 0!==c?c:function(e,t){return t(JSON.stringify(e))},this.decode=null!==(l=null==e?void 0:e.decode)&&void 0!==l?l:function(e,t){return t(JSON.parse(e))};break;case M:this.encode=null!==(h=null==e?void 0:e.encode)&&void 0!==h?h:this.serializer.encode.bind(this.serializer),this.decode=null!==(f=null==e?void 0:e.decode)&&void 0!==f?f:this.serializer.decode.bind(this.serializer);break;default:throw new Error("Unsupported serializer version: ".concat(this.vsn))}if(this.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=null==e?void 0:e.workerUrl}}}]);var e,t,n,r,i,a}(),me=function(e){function t(e,n){var r,i;return g(this,t),(i=b(this,t,[e])).name="IcebergError",i.status=n.status,i.icebergType=n.icebergType,i.icebergCode=n.icebergCode,i.details=n.details,i.isCommitStateUnknown="CommitStateUnknownException"===n.icebergType||[500,502,504].includes(n.status)&&!0===(null===(r=n.icebergType)||void 0===r?void 0:r.includes("CommitState")),i}return w(t,e),y(t,[{key:"isNotFound",value:function(){return 404===this.status}},{key:"isConflict",value:function(){return 409===this.status}},{key:"isAuthenticationTimeout",value:function(){return 419===this.status}}])}(k(Error));function ge(e,t,n){var r=new URL(t,e);if(n)for(var i=0,a=Object.entries(n);i<a.length;i++){var s=u(a[i],2),o=s[0],c=s[1];void 0!==c&&r.searchParams.set(o,c)}return r.toString()}function be(e){return we.apply(this,arguments)}function we(){return(we=f(d().m(function e(t){return d().w(function(e){for(;;)switch(e.n){case 0:if(t&&"none"!==t.type){e.n=1;break}return e.a(2,{});case 1:if("bearer"!==t.type){e.n=2;break}return e.a(2,{Authorization:"Bearer ".concat(t.token)});case 2:if("header"!==t.type){e.n=3;break}return e.a(2,a({},t.name,t.value));case 3:if("custom"!==t.type){e.n=5;break}return e.n=4,t.getHeaders();case 4:return e.a(2,e.v);case 5:return e.a(2,{})}},e)}))).apply(this,arguments)}function ke(e){return e.join("")}var _e=function(){return y(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";g(this,e),this.client=t,this.prefix=n},[{key:"listNamespaces",value:(a=f(d().m(function e(t){var n,r;return d().w(function(e){for(;;)switch(e.n){case 0:return n=t?{parent:ke(t.namespace)}:void 0,e.n=1,this.client.request({method:"GET",path:"".concat(this.prefix,"/namespaces"),query:n});case 1:return r=e.v,e.a(2,r.data.namespaces.map(function(e){return{namespace:e}}))}},e,this)})),function(e){return a.apply(this,arguments)})},{key:"createNamespace",value:(i=f(d().m(function e(t,n){var r,i;return d().w(function(e){for(;;)switch(e.n){case 0:return r={namespace:t.namespace,properties:null==n?void 0:n.properties},e.n=1,this.client.request({method:"POST",path:"".concat(this.prefix,"/namespaces"),body:r});case 1:return i=e.v,e.a(2,i.data)}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"dropNamespace",value:(r=f(d().m(function e(t){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.client.request({method:"DELETE",path:"".concat(this.prefix,"/namespaces/").concat(ke(t.namespace))});case 1:return e.a(2)}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"loadNamespaceMetadata",value:(n=f(d().m(function e(t){var n;return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.client.request({method:"GET",path:"".concat(this.prefix,"/namespaces/").concat(ke(t.namespace))});case 1:return n=e.v,e.a(2,{properties:n.data.properties})}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"namespaceExists",value:(t=f(d().m(function e(t){var n;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this.client.request({method:"HEAD",path:"".concat(this.prefix,"/namespaces/").concat(ke(t.namespace))});case 1:return e.a(2,!0);case 2:if(e.p=2,!((n=e.v)instanceof me&&404===n.status)){e.n=3;break}return e.a(2,!1);case 3:throw n;case 4:return e.a(2)}},e,this,[[0,2]])})),function(e){return t.apply(this,arguments)})},{key:"createNamespaceIfNotExists",value:(e=f(d().m(function e(t,n){var r;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this.createNamespace(t,n);case 1:return e.a(2,e.v);case 2:if(e.p=2,!((r=e.v)instanceof me&&409===r.status)){e.n=3;break}return e.a(2);case 3:throw r;case 4:return e.a(2)}},e,this,[[0,2]])})),function(t,n){return e.apply(this,arguments)})}]);var e,t,n,r,i,a}();function Se(e){return e.join("")}var Te=function(){return y(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;g(this,e),this.client=t,this.prefix=n,this.accessDelegation=r},[{key:"listTables",value:(s=f(d().m(function e(t){var n;return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.client.request({method:"GET",path:"".concat(this.prefix,"/namespaces/").concat(Se(t.namespace),"/tables")});case 1:return n=e.v,e.a(2,n.data.identifiers)}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"createTable",value:(a=f(d().m(function e(t,n){var r,i;return d().w(function(e){for(;;)switch(e.n){case 0:return r={},this.accessDelegation&&(r["X-Iceberg-Access-Delegation"]=this.accessDelegation),e.n=1,this.client.request({method:"POST",path:"".concat(this.prefix,"/namespaces/").concat(Se(t.namespace),"/tables"),body:n,headers:r});case 1:return i=e.v,e.a(2,i.data.metadata)}},e,this)})),function(e,t){return a.apply(this,arguments)})},{key:"updateTable",value:(i=f(d().m(function e(t,n){var r;return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.client.request({method:"POST",path:"".concat(this.prefix,"/namespaces/").concat(Se(t.namespace),"/tables/").concat(t.name),body:n});case 1:return r=e.v,e.a(2,{"metadata-location":r.data["metadata-location"],metadata:r.data.metadata})}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"dropTable",value:(r=f(d().m(function e(t,n){var r;return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.client.request({method:"DELETE",path:"".concat(this.prefix,"/namespaces/").concat(Se(t.namespace),"/tables/").concat(t.name),query:{purgeRequested:String(null!==(r=null==n?void 0:n.purge)&&void 0!==r&&r)}});case 1:return e.a(2)}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"loadTable",value:(n=f(d().m(function e(t){var n,r;return d().w(function(e){for(;;)switch(e.n){case 0:return n={},this.accessDelegation&&(n["X-Iceberg-Access-Delegation"]=this.accessDelegation),e.n=1,this.client.request({method:"GET",path:"".concat(this.prefix,"/namespaces/").concat(Se(t.namespace),"/tables/").concat(t.name),headers:n});case 1:return r=e.v,e.a(2,r.data.metadata)}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"tableExists",value:(t=f(d().m(function e(t){var n,r;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return n={},this.accessDelegation&&(n["X-Iceberg-Access-Delegation"]=this.accessDelegation),e.p=1,e.n=2,this.client.request({method:"HEAD",path:"".concat(this.prefix,"/namespaces/").concat(Se(t.namespace),"/tables/").concat(t.name),headers:n});case 2:return e.a(2,!0);case 3:if(e.p=3,!((r=e.v)instanceof me&&404===r.status)){e.n=4;break}return e.a(2,!1);case 4:throw r;case 5:return e.a(2)}},e,this,[[1,3]])})),function(e){return t.apply(this,arguments)})},{key:"createTableIfNotExists",value:(e=f(d().m(function e(t,n){var r;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this.createTable(t,n);case 1:case 3:return e.a(2,e.v);case 2:if(e.p=2,!((r=e.v)instanceof me&&409===r.status)){e.n=4;break}return e.n=3,this.loadTable({namespace:t.namespace,name:n.name});case 4:throw r;case 5:return e.a(2)}},e,this,[[0,2]])})),function(t,n){return e.apply(this,arguments)})}]);var e,t,n,r,i,a,s}(),Ee=function(){return y(function e(t){var n;g(this,e);var r="v1";t.catalogName&&(r+="/".concat(t.catalogName));var a=t.baseUrl.endsWith("/")?t.baseUrl:"".concat(t.baseUrl,"/");this.client=function(e){var t,n=null!==(t=e.fetchImpl)&&void 0!==t?t:globalThis.fetch;return{request:function(t){return f(d().m(function r(){var a,s,o,u,c,l,h,f,p,v,y,m,g,b;return d().w(function(r){for(;;)switch(r.n){case 0:return a=t.method,s=t.path,o=t.query,u=t.body,c=t.headers,l=ge(e.baseUrl,s,o),r.n=1,be(e.auth);case 1:return h=r.v,r.n=2,n(l,{method:a,headers:i(i(i({},u?{"Content-Type":"application/json"}:{}),h),c),body:u?JSON.stringify(u):void 0});case 2:return f=r.v,r.n=3,f.text();case 3:if(p=r.v,v=(f.headers.get("content-type")||"").includes("application/json"),y=v&&p?JSON.parse(p):p,f.ok){r.n=4;break}throw b=null==(g=v?y:void 0)?void 0:g.error,new me(null!==(m=null==b?void 0:b.message)&&void 0!==m?m:"Request failed with status ".concat(f.status),{status:f.status,icebergType:null==b?void 0:b.type,icebergCode:null==b?void 0:b.code,details:g});case 4:return r.a(2,{status:f.status,headers:f.headers,data:y})}},r)}))()}}}({baseUrl:a,auth:t.auth,fetchImpl:t.fetch}),this.accessDelegation=null===(n=t.accessDelegation)||void 0===n?void 0:n.join(","),this.namespaceOps=new _e(this.client,r),this.tableOps=new Te(this.client,r,this.accessDelegation)},[{key:"listNamespaces",value:(v=f(d().m(function e(t){return d().w(function(e){for(;;)if(0===e.n)return e.a(2,this.namespaceOps.listNamespaces(t))},e,this)})),function(e){return v.apply(this,arguments)})},{key:"createNamespace",value:(p=f(d().m(function e(t,n){return d().w(function(e){for(;;)if(0===e.n)return e.a(2,this.namespaceOps.createNamespace(t,n))},e,this)})),function(e,t){return p.apply(this,arguments)})},{key:"dropNamespace",value:(h=f(d().m(function e(t){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.namespaceOps.dropNamespace(t);case 1:return e.a(2)}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"loadNamespaceMetadata",value:(l=f(d().m(function e(t){return d().w(function(e){for(;;)if(0===e.n)return e.a(2,this.namespaceOps.loadNamespaceMetadata(t))},e,this)})),function(e){return l.apply(this,arguments)})},{key:"listTables",value:(c=f(d().m(function e(t){return d().w(function(e){for(;;)if(0===e.n)return e.a(2,this.tableOps.listTables(t))},e,this)})),function(e){return c.apply(this,arguments)})},{key:"createTable",value:(u=f(d().m(function e(t,n){return d().w(function(e){for(;;)if(0===e.n)return e.a(2,this.tableOps.createTable(t,n))},e,this)})),function(e,t){return u.apply(this,arguments)})},{key:"updateTable",value:(o=f(d().m(function e(t,n){return d().w(function(e){for(;;)if(0===e.n)return e.a(2,this.tableOps.updateTable(t,n))},e,this)})),function(e,t){return o.apply(this,arguments)})},{key:"dropTable",value:(s=f(d().m(function e(t,n){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.tableOps.dropTable(t,n);case 1:return e.a(2)}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"loadTable",value:(a=f(d().m(function e(t){return d().w(function(e){for(;;)if(0===e.n)return e.a(2,this.tableOps.loadTable(t))},e,this)})),function(e){return a.apply(this,arguments)})},{key:"namespaceExists",value:(r=f(d().m(function e(t){return d().w(function(e){for(;;)if(0===e.n)return e.a(2,this.namespaceOps.namespaceExists(t))},e,this)})),function(e){return r.apply(this,arguments)})},{key:"tableExists",value:(n=f(d().m(function e(t){return d().w(function(e){for(;;)if(0===e.n)return e.a(2,this.tableOps.tableExists(t))},e,this)})),function(e){return n.apply(this,arguments)})},{key:"createNamespaceIfNotExists",value:(t=f(d().m(function e(t,n){return d().w(function(e){for(;;)if(0===e.n)return e.a(2,this.namespaceOps.createNamespaceIfNotExists(t,n))},e,this)})),function(e,n){return t.apply(this,arguments)})},{key:"createTableIfNotExists",value:(e=f(d().m(function e(t,n){return d().w(function(e){for(;;)if(0===e.n)return e.a(2,this.tableOps.createTableIfNotExists(t,n))},e,this)})),function(t,n){return e.apply(this,arguments)})}]);var e,t,n,r,a,s,o,u,c,l,h,p,v}(),Oe=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"storage",i=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;return g(this,t),(n=b(this,t,[e])).__isStorageError=!0,n.namespace=r,n.name="vectors"===r?"StorageVectorsError":"StorageError",n.status=i,n.statusCode=a,n}return w(t,e),y(t)}(k(Error));function Re(e){return"object"===s(e)&&null!==e&&"__isStorageError"in e}var Ae=function(e){function t(e,n,r){var i,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"storage";return g(this,t),(i=b(this,t,[e,a,n,r])).name="vectors"===a?"StorageVectorsApiError":"StorageApiError",i.status=n,i.statusCode=r,i}return w(t,e),y(t,[{key:"toJSON",value:function(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}])}(Oe),je=function(e){function t(e,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"storage";return g(this,t),(r=b(this,t,[e,i])).name="vectors"===i?"StorageVectorsUnknownError":"StorageUnknownError",r.originalError=n,r}return w(t,e),y(t)}(Oe),Pe=function(e){if(Array.isArray(e))return e.map(function(e){return Pe(e)});if("function"==typeof e||e!==Object(e))return e;var t={};return Object.entries(e).forEach(function(e){var n=u(e,2),r=n[0],i=n[1],a=r.replace(/([-_][a-z])/gi,function(e){return e.toUpperCase().replace(/[-_]/g,"")});t[a]=Pe(i)}),t};function Ie(e){return(Ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ce(e){var t=function(e,t){if("object"!=Ie(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=Ie(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Ie(t)?t:t+""}function Ne(e,t,n){return(t=Ce(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xe(Object(n),!0).forEach(function(t){Ne(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xe(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Le=function(e){var t;return e.msg||e.message||e.error_description||("string"==typeof e.error?e.error:null===(t=e.error)||void 0===t?void 0:t.message)||JSON.stringify(e)},De=function(){var e=f(d().m(function e(t,n,r,i){var a,o,u;return d().w(function(e){for(;;)switch(e.n){case 0:t&&"object"===s(t)&&"status"in t&&"ok"in t&&"number"==typeof t.status&&!(null==r?void 0:r.noResolveJson)?(o=(a=t).status||500,"function"==typeof a.json?a.json().then(function(e){var t=(null==e?void 0:e.statusCode)||(null==e?void 0:e.code)||o+"";n(new Ae(Le(e),o,t,i))}).catch(function(){if("vectors"===i){var e=o+"";n(new Ae(a.statusText||"HTTP ".concat(o," error"),o,e,i))}else{var t=o+"";n(new Ae(a.statusText||"HTTP ".concat(o," error"),o,t,i))}}):(u=o+"",n(new Ae(a.statusText||"HTTP ".concat(o," error"),o,u,i)))):n(new je(Le(t),t,i));case 1:return e.a(2)}},e)}));return function(t,n,r,i){return e.apply(this,arguments)}}(),Be=function(e,t,n,r){var i={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"!==e&&"HEAD"!==e&&r?(!function(e){if("object"!==s(e)||null===e)return!1;var t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)}(r)?i.body=r:(i.headers=Ue({"Content-Type":"application/json"},null==t?void 0:t.headers),i.body=JSON.stringify(r)),(null==t?void 0:t.duplex)&&(i.duplex=t.duplex),Ue(Ue({},i),n)):Ue(Ue({},i),n)};function qe(e,t,n,r,i,a,s){return Ke.apply(this,arguments)}function Ke(){return(Ke=f(d().m(function e(t,n,r,i,a,s,o){return d().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e,u){t(r,Be(n,i,a,s)).then(function(e){if(!e.ok)throw e;if(null==i?void 0:i.noResolveJson)return e;if("vectors"===o){var t=e.headers.get("content-type");if("0"===e.headers.get("content-length")||204===e.status)return{};if(!t||!t.includes("application/json"))return{}}return e.json()}).then(function(t){return e(t)}).catch(function(e){return De(e,u,i,o)})}))},e)}))).apply(this,arguments)}function We(){var e,t,n,r,i,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"storage";return{get:(i=f(d().m(function e(t,n,r,i){return d().w(function(e){for(;;)if(0===e.n)return e.a(2,qe(t,"GET",n,r,i,void 0,a))},e)})),function(e,t,n,r){return i.apply(this,arguments)}),post:(r=f(d().m(function e(t,n,r,i,s){return d().w(function(e){for(;;)if(0===e.n)return e.a(2,qe(t,"POST",n,i,s,r,a))},e)})),function(e,t,n,i,a){return r.apply(this,arguments)}),put:(n=f(d().m(function e(t,n,r,i,s){return d().w(function(e){for(;;)if(0===e.n)return e.a(2,qe(t,"PUT",n,i,s,r,a))},e)})),function(e,t,r,i,a){return n.apply(this,arguments)}),head:(t=f(d().m(function e(t,n,r,i){return d().w(function(e){for(;;)if(0===e.n)return e.a(2,qe(t,"HEAD",n,Ue(Ue({},r),{},{noResolveJson:!0}),i,void 0,a))},e)})),function(e,n,r,i){return t.apply(this,arguments)}),remove:(e=f(d().m(function e(t,n,r,i,s){return d().w(function(e){for(;;)if(0===e.n)return e.a(2,qe(t,"DELETE",n,i,s,r,a))},e)})),function(t,n,r,i,a){return e.apply(this,arguments)})}}var Me,Fe=We("storage"),Ge=Fe.get,He=Fe.post,Je=Fe.put,Ve=Fe.head,ze=Fe.remove,Ye=We("vectors"),$e=function(){return y(function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"storage";g(this,e),this.shouldThrowOnError=!1,this.url=t,this.headers=r,this.fetch=(n=i)?function(){return n.apply(void 0,arguments)}:function(){return fetch.apply(void 0,arguments)},this.namespace=a},[{key:"throwOnError",value:function(){return this.shouldThrowOnError=!0,this}},{key:"handleOperation",value:(e=f(d().m(function e(t){var n,r,i;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=this,e.p=1,e.n=2,t();case 2:return r=e.v,e.a(2,{data:r,error:null});case 3:if(e.p=3,i=e.v,!n.shouldThrowOnError){e.n=4;break}throw i;case 4:if(!Re(i)){e.n=5;break}return e.a(2,{data:null,error:i});case 5:throw i;case 6:return e.a(2)}},e,this,[[1,3]])})),function(t){return e.apply(this,arguments)})}]);var e}(),Xe=function(){return y(function e(t,n){g(this,e),this.downloadFn=t,this.shouldThrowOnError=n},[{key:"then",value:function(e,t){return this.execute().then(e,t)}},{key:"execute",value:(e=f(d().m(function e(){var t,n,r;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return t=this,e.p=1,e.n=2,t.downloadFn();case 2:return n=e.v.body,e.a(2,{data:n,error:null});case 3:if(e.p=3,r=e.v,!t.shouldThrowOnError){e.n=4;break}throw r;case 4:if(!Re(r)){e.n=5;break}return e.a(2,{data:null,error:r});case 5:throw r;case 6:return e.a(2)}},e,this,[[1,3]])})),function(){return e.apply(this,arguments)})}]);var e}();Me=Symbol.toStringTag;var Qe=function(){return y(function e(t,n){g(this,e),this.downloadFn=t,this.shouldThrowOnError=n,this[Me]="BlobDownloadBuilder",this.promise=null},[{key:"asStream",value:function(){return new Xe(this.downloadFn,this.shouldThrowOnError)}},{key:"then",value:function(e,t){return this.getPromise().then(e,t)}},{key:"catch",value:function(e){return this.getPromise().catch(e)}},{key:"finally",value:function(e){return this.getPromise().finally(e)}},{key:"getPromise",value:function(){return this.promise||(this.promise=this.execute()),this.promise}},{key:"execute",value:(e=f(d().m(function e(){var t,n,r;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return t=this,e.p=1,e.n=2,t.downloadFn();case 2:return e.n=3,e.v.blob();case 3:return n=e.v,e.a(2,{data:n,error:null});case 4:if(e.p=4,r=e.v,!t.shouldThrowOnError){e.n=5;break}throw r;case 5:if(!Re(r)){e.n=6;break}return e.a(2,{data:null,error:r});case 6:throw r;case 7:return e.a(2)}},e,this,[[1,4]])})),function(){return e.apply(this,arguments)})}]);var e}(),Ze={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},et={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1},tt=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;return g(this,t),(n=b(this,t,[e,r,a,"storage"])).bucketId=i,n}return w(t,e),y(t,[{key:"uploadOrUpdate",value:(_=f(d().m(function e(t,n,r,i){var a;return d().w(function(e){for(;;)if(0===e.n)return a=this,e.a(2,a.handleOperation(f(d().m(function e(){var o,u,c,l,h,f,p;return d().w(function(e){for(;;)switch(e.n){case 0:return u=Ue(Ue({},et),i),c=Ue(Ue({},a.headers),"POST"===t&&{"x-upsert":String(u.upsert)}),l=u.metadata,"undefined"!=typeof Blob&&r instanceof Blob?((o=new FormData).append("cacheControl",u.cacheControl),l&&o.append("metadata",a.encodeMetadata(l)),o.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?((o=r).has("cacheControl")||o.append("cacheControl",u.cacheControl),l&&!o.has("metadata")&&o.append("metadata",a.encodeMetadata(l))):(o=r,c["cache-control"]="max-age=".concat(u.cacheControl),c["content-type"]=u.contentType,l&&(c["x-metadata"]=a.toBase64(a.encodeMetadata(l))),("undefined"!=typeof ReadableStream&&o instanceof ReadableStream||o&&"object"===s(o)&&"pipe"in o&&"function"==typeof o.pipe)&&!u.duplex&&(u.duplex="half")),(null==i?void 0:i.headers)&&(c=Ue(Ue({},c),i.headers)),h=a._removeEmptyFolders(n),f=a._getFinalPath(h),e.n=1,("PUT"==t?Je:He)(a.fetch,"".concat(a.url,"/object/").concat(f),o,Ue({headers:c},(null==u?void 0:u.duplex)?{duplex:u.duplex}:{}));case 1:return p=e.v,e.a(2,{path:h,id:p.Id,fullPath:p.Key})}},e)}))))},e,this)})),function(e,t,n,r){return _.apply(this,arguments)})},{key:"upload",value:(k=f(d().m(function e(t,n,r){return d().w(function(e){for(;;)if(0===e.n)return e.a(2,this.uploadOrUpdate("POST",t,n,r))},e,this)})),function(e,t,n){return k.apply(this,arguments)})},{key:"uploadToSignedUrl",value:(m=f(d().m(function e(t,n,r,i){var a,s,o,u;return d().w(function(e){for(;;)if(0===e.n)return s=(a=this)._removeEmptyFolders(t),o=a._getFinalPath(s),(u=new URL(a.url+"/object/upload/sign/".concat(o))).searchParams.set("token",n),e.a(2,a.handleOperation(f(d().m(function e(){var t,n,o,c,l;return d().w(function(e){for(;;)switch(e.n){case 0:return n=Ue({upsert:et.upsert},i),o=Ue(Ue({},a.headers),{"x-upsert":String(n.upsert)}),"undefined"!=typeof Blob&&r instanceof Blob?((t=new FormData).append("cacheControl",n.cacheControl),t.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(t=r).append("cacheControl",n.cacheControl):(t=r,o["cache-control"]="max-age=".concat(n.cacheControl),o["content-type"]=n.contentType),c=s,e.n=1,Je(a.fetch,u.toString(),t,{headers:o});case 1:return l=e.v.Key,e.a(2,{path:c,fullPath:l})}},e)}))))},e,this)})),function(e,t,n,r){return m.apply(this,arguments)})},{key:"createSignedUploadUrl",value:(v=f(d().m(function e(t,n){var r;return d().w(function(e){for(;;)if(0===e.n)return r=this,e.a(2,r.handleOperation(f(d().m(function e(){var i,a,s,o,u;return d().w(function(e){for(;;)switch(e.n){case 0:return i=r._getFinalPath(t),a=Ue({},r.headers),(null==n?void 0:n.upsert)&&(a["x-upsert"]="true"),e.n=1,He(r.fetch,"".concat(r.url,"/object/upload/sign/").concat(i),{},{headers:a});case 1:if(s=e.v,o=new URL(r.url+s.url),u=o.searchParams.get("token")){e.n=2;break}throw new Oe("No token returned by API");case 2:return e.a(2,{signedUrl:o.toString(),path:t,token:u})}},e)}))))},e,this)})),function(e,t){return v.apply(this,arguments)})},{key:"update",value:(p=f(d().m(function e(t,n,r){return d().w(function(e){for(;;)if(0===e.n)return e.a(2,this.uploadOrUpdate("PUT",t,n,r))},e,this)})),function(e,t,n){return p.apply(this,arguments)})},{key:"move",value:(h=f(d().m(function e(t,n,r){var i;return d().w(function(e){for(;;)if(0===e.n)return i=this,e.a(2,i.handleOperation(f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,He(i.fetch,"".concat(i.url,"/object/move"),{bucketId:i.bucketId,sourceKey:t,destinationKey:n,destinationBucket:null==r?void 0:r.destinationBucket},{headers:i.headers});case 1:return e.a(2,e.v)}},e)}))))},e,this)})),function(e,t,n){return h.apply(this,arguments)})},{key:"copy",value:(l=f(d().m(function e(t,n,r){var i;return d().w(function(e){for(;;)if(0===e.n)return i=this,e.a(2,i.handleOperation(f(d().m(function e(){var a;return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,He(i.fetch,"".concat(i.url,"/object/copy"),{bucketId:i.bucketId,sourceKey:t,destinationKey:n,destinationBucket:null==r?void 0:r.destinationBucket},{headers:i.headers});case 1:return a=e.v.Key,e.a(2,{path:a})}},e)}))))},e,this)})),function(e,t,n){return l.apply(this,arguments)})},{key:"createSignedUrl",value:(c=f(d().m(function e(t,n,r){var i;return d().w(function(e){for(;;)if(0===e.n)return i=this,e.a(2,i.handleOperation(f(d().m(function e(){var a,s,o;return d().w(function(e){for(;;)switch(e.n){case 0:return a=i._getFinalPath(t),e.n=1,He(i.fetch,"".concat(i.url,"/object/sign/").concat(a),Ue({expiresIn:n},(null==r?void 0:r.transform)?{transform:r.transform}:{}),{headers:i.headers});case 1:return s=e.v,o=(null==r?void 0:r.download)?"&download=".concat(!0===r.download?"":r.download):"",e.a(2,{signedUrl:encodeURI("".concat(i.url).concat(s.signedURL).concat(o))})}},e)}))))},e,this)})),function(e,t,n){return c.apply(this,arguments)})},{key:"createSignedUrls",value:(u=f(d().m(function e(t,n,r){var i;return d().w(function(e){for(;;)if(0===e.n)return i=this,e.a(2,i.handleOperation(f(d().m(function e(){var a,s;return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,He(i.fetch,"".concat(i.url,"/object/sign/").concat(i.bucketId),{expiresIn:n,paths:t},{headers:i.headers});case 1:return a=e.v,s=(null==r?void 0:r.download)?"&download=".concat(!0===r.download?"":r.download):"",e.a(2,a.map(function(e){return Ue(Ue({},e),{},{signedUrl:e.signedURL?encodeURI("".concat(i.url).concat(e.signedURL).concat(s)):null})}))}},e)}))))},e,this)})),function(e,t,n){return u.apply(this,arguments)})},{key:"download",value:function(e,t,n){var r=this,i=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",a=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),s=a?"?".concat(a):"",o=this._getFinalPath(e);return new Qe(function(){return Ge(r.fetch,"".concat(r.url,"/").concat(i,"/").concat(o).concat(s),{headers:r.headers,noResolveJson:!0},n)},this.shouldThrowOnError)}},{key:"info",value:(o=f(d().m(function e(t){var n,r;return d().w(function(e){for(;;)if(0===e.n)return r=(n=this)._getFinalPath(t),e.a(2,n.handleOperation(f(d().m(function e(){var t;return d().w(function(e){for(;;)switch(e.n){case 0:return t=Pe,e.n=1,Ge(n.fetch,"".concat(n.url,"/object/info/").concat(r),{headers:n.headers});case 1:return e.a(2,t(e.v))}},e)}))))},e,this)})),function(e){return o.apply(this,arguments)})},{key:"exists",value:(a=f(d().m(function e(t){var n,r,i,a;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return r=(n=this)._getFinalPath(t),e.p=1,e.n=2,Ve(n.fetch,"".concat(n.url,"/object/").concat(r),{headers:n.headers});case 2:return e.a(2,{data:!0,error:null});case 3:if(e.p=3,a=e.v,!n.shouldThrowOnError){e.n=4;break}throw a;case 4:if(!(Re(a)&&a instanceof je)){e.n=5;break}if(i=a.originalError,![400,404].includes(null==i?void 0:i.status)){e.n=5;break}return e.a(2,{data:!1,error:a});case 5:throw a;case 6:return e.a(2)}},e,this,[[1,3]])})),function(e){return a.apply(this,arguments)})},{key:"getPublicUrl",value:function(e,t){var n=this._getFinalPath(e),r=[],i=(null==t?void 0:t.download)?"download=".concat(!0===t.download?"":t.download):"";""!==i&&r.push(i);var a=void 0!==(null==t?void 0:t.transform)?"render/image":"object",s=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==s&&r.push(s);var o=r.join("&");return""!==o&&(o="?".concat(o)),{data:{publicUrl:encodeURI("".concat(this.url,"/").concat(a,"/public/").concat(n).concat(o))}}}},{key:"remove",value:(i=f(d().m(function e(t){var n;return d().w(function(e){for(;;)if(0===e.n)return n=this,e.a(2,n.handleOperation(f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,ze(n.fetch,"".concat(n.url,"/object/").concat(n.bucketId),{prefixes:t},{headers:n.headers});case 1:return e.a(2,e.v)}},e)}))))},e,this)})),function(e){return i.apply(this,arguments)})},{key:"list",value:(r=f(d().m(function e(t,n,r){var i;return d().w(function(e){for(;;)if(0===e.n)return i=this,e.a(2,i.handleOperation(f(d().m(function e(){var a;return d().w(function(e){for(;;)switch(e.n){case 0:return a=Ue(Ue(Ue({},Ze),n),{},{prefix:t||""}),e.n=1,He(i.fetch,"".concat(i.url,"/object/list/").concat(i.bucketId),a,{headers:i.headers},r);case 1:return e.a(2,e.v)}},e)}))))},e,this)})),function(e,t,n){return r.apply(this,arguments)})},{key:"listV2",value:(n=f(d().m(function e(t,n){var r;return d().w(function(e){for(;;)if(0===e.n)return r=this,e.a(2,r.handleOperation(f(d().m(function e(){var i;return d().w(function(e){for(;;)switch(e.n){case 0:return i=Ue({},t),e.n=1,He(r.fetch,"".concat(r.url,"/object/list-v2/").concat(r.bucketId),i,{headers:r.headers},n);case 1:return e.a(2,e.v)}},e)}))))},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"encodeMetadata",value:function(e){return JSON.stringify(e)}},{key:"toBase64",value:function(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}},{key:"_getFinalPath",value:function(e){return"".concat(this.bucketId,"/").concat(e.replace(/^\/+/,""))}},{key:"_removeEmptyFolders",value:function(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}},{key:"transformOptsToQueryString",value:function(e){var t=[];return e.width&&t.push("width=".concat(e.width)),e.height&&t.push("height=".concat(e.height)),e.resize&&t.push("resize=".concat(e.resize)),e.format&&t.push("format=".concat(e.format)),e.quality&&t.push("quality=".concat(e.quality)),t.join("&")}}]);var n,r,i,a,o,u,c,l,h,p,v,m,k,_}($e),nt={"X-Client-Info":"storage-js/".concat("2.95.3")},rt=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;g(this,t);var a=new URL(e);return(null==i?void 0:i.useNewHostname)&&/supabase\.(co|in|red)$/.test(a.hostname)&&!a.hostname.includes("storage.supabase.")&&(a.hostname=a.hostname.replace("supabase.","storage.supabase.")),b(this,t,[a.href.replace(/\/$/,""),Ue(Ue({},nt),n),r,"storage"])}return w(t,e),y(t,[{key:"listBuckets",value:(o=f(d().m(function e(t){var n;return d().w(function(e){for(;;)if(0===e.n)return n=this,e.a(2,n.handleOperation(f(d().m(function e(){var r;return d().w(function(e){for(;;)switch(e.n){case 0:return r=n.listBucketOptionsToQueryString(t),e.n=1,Ge(n.fetch,"".concat(n.url,"/bucket").concat(r),{headers:n.headers});case 1:return e.a(2,e.v)}},e)}))))},e,this)})),function(e){return o.apply(this,arguments)})},{key:"getBucket",value:(s=f(d().m(function e(t){var n;return d().w(function(e){for(;;)if(0===e.n)return n=this,e.a(2,n.handleOperation(f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Ge(n.fetch,"".concat(n.url,"/bucket/").concat(t),{headers:n.headers});case 1:return e.a(2,e.v)}},e)}))))},e,this)})),function(e){return s.apply(this,arguments)})},{key:"createBucket",value:(a=f(d().m(function e(t){var n,r,i=arguments;return d().w(function(e){for(;;)if(0===e.n)return n=i.length>1&&void 0!==i[1]?i[1]:{public:!1},r=this,e.a(2,r.handleOperation(f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,He(r.fetch,"".concat(r.url,"/bucket"),{id:t,name:t,type:n.type,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:r.headers});case 1:return e.a(2,e.v)}},e)}))))},e,this)})),function(e){return a.apply(this,arguments)})},{key:"updateBucket",value:(i=f(d().m(function e(t,n){var r;return d().w(function(e){for(;;)if(0===e.n)return r=this,e.a(2,r.handleOperation(f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Je(r.fetch,"".concat(r.url,"/bucket/").concat(t),{id:t,name:t,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:r.headers});case 1:return e.a(2,e.v)}},e)}))))},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"emptyBucket",value:(r=f(d().m(function e(t){var n;return d().w(function(e){for(;;)if(0===e.n)return n=this,e.a(2,n.handleOperation(f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,He(n.fetch,"".concat(n.url,"/bucket/").concat(t,"/empty"),{},{headers:n.headers});case 1:return e.a(2,e.v)}},e)}))))},e,this)})),function(e){return r.apply(this,arguments)})},{key:"deleteBucket",value:(n=f(d().m(function e(t){var n;return d().w(function(e){for(;;)if(0===e.n)return n=this,e.a(2,n.handleOperation(f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,ze(n.fetch,"".concat(n.url,"/bucket/").concat(t),{},{headers:n.headers});case 1:return e.a(2,e.v)}},e)}))))},e,this)})),function(e){return n.apply(this,arguments)})},{key:"listBucketOptionsToQueryString",value:function(e){var t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}}]);var n,r,i,a,s,o}($e),it=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;return g(this,t),b(this,t,[e.replace(/\/$/,""),Ue(Ue({},nt),n),r,"storage"])}return w(t,e),y(t,[{key:"createBucket",value:(i=f(d().m(function e(t){var n;return d().w(function(e){for(;;)if(0===e.n)return n=this,e.a(2,n.handleOperation(f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,He(n.fetch,"".concat(n.url,"/bucket"),{name:t},{headers:n.headers});case 1:return e.a(2,e.v)}},e)}))))},e,this)})),function(e){return i.apply(this,arguments)})},{key:"listBuckets",value:(r=f(d().m(function e(t){var n;return d().w(function(e){for(;;)if(0===e.n)return n=this,e.a(2,n.handleOperation(f(d().m(function e(){var r,i,a;return d().w(function(e){for(;;)switch(e.n){case 0:return r=new URLSearchParams,void 0!==(null==t?void 0:t.limit)&&r.set("limit",t.limit.toString()),void 0!==(null==t?void 0:t.offset)&&r.set("offset",t.offset.toString()),(null==t?void 0:t.sortColumn)&&r.set("sortColumn",t.sortColumn),(null==t?void 0:t.sortOrder)&&r.set("sortOrder",t.sortOrder),(null==t?void 0:t.search)&&r.set("search",t.search),i=r.toString(),a=i?"".concat(n.url,"/bucket?").concat(i):"".concat(n.url,"/bucket"),e.n=1,Ge(n.fetch,a,{headers:n.headers});case 1:return e.a(2,e.v)}},e)}))))},e,this)})),function(e){return r.apply(this,arguments)})},{key:"deleteBucket",value:(n=f(d().m(function e(t){var n;return d().w(function(e){for(;;)if(0===e.n)return n=this,e.a(2,n.handleOperation(f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,ze(n.fetch,"".concat(n.url,"/bucket/").concat(t),{},{headers:n.headers});case 1:return e.a(2,e.v)}},e)}))))},e,this)})),function(e){return n.apply(this,arguments)})},{key:"from",value:function(e){var t=this;if(!function(e){return!(!e||"string"!=typeof e)&&!(0===e.length||e.length>100)&&e.trim()===e&&!e.includes("/")&&!e.includes("\\")&&/^[\w!.\*'() &$@=;:+,?-]+$/.test(e)}(e))throw new Oe("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");var n,r=new Ee({baseUrl:this.url,catalogName:e,auth:{type:"custom",getHeaders:(n=f(d().m(function e(){return d().w(function(e){for(;;)if(0===e.n)return e.a(2,t.headers)},e)})),function(){return n.apply(this,arguments)})},fetch:this.fetch}),i=this.shouldThrowOnError;return new Proxy(r,{get:function(e,t){var n=e[t];return"function"!=typeof n?n:f(d().m(function t(){var r,a,s,o,u,c=arguments;return d().w(function(t){for(;;)switch(t.p=t.n){case 0:for(t.p=0,r=c.length,a=new Array(r),s=0;s<r;s++)a[s]=c[s];return t.n=1,n.apply(e,a);case 1:return o=t.v,t.a(2,{data:o,error:null});case 2:if(t.p=2,u=t.v,!i){t.n=3;break}throw u;case 3:return t.a(2,{data:null,error:u})}},t,null,[[0,2]])}))}})}}]);var n,r,i}($e),at=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;return g(this,t),b(this,t,[e.replace(/\/$/,""),Ue(Ue({},nt),{},{"Content-Type":"application/json"},n),r,"vectors"])}return w(t,e),y(t,[{key:"createIndex",value:(a=f(d().m(function e(t){var n;return d().w(function(e){for(;;)if(0===e.n)return n=this,e.a(2,n.handleOperation(f(d().m(function e(){var r;return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Ye.post(n.fetch,"".concat(n.url,"/CreateIndex"),t,{headers:n.headers});case 1:if(r=e.v){e.n=2;break}r={};case 2:return e.a(2,r)}},e)}))))},e,this)})),function(e){return a.apply(this,arguments)})},{key:"getIndex",value:(i=f(d().m(function e(t,n){var r;return d().w(function(e){for(;;)if(0===e.n)return r=this,e.a(2,r.handleOperation(f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Ye.post(r.fetch,"".concat(r.url,"/GetIndex"),{vectorBucketName:t,indexName:n},{headers:r.headers});case 1:return e.a(2,e.v)}},e)}))))},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"listIndexes",value:(r=f(d().m(function e(t){var n;return d().w(function(e){for(;;)if(0===e.n)return n=this,e.a(2,n.handleOperation(f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Ye.post(n.fetch,"".concat(n.url,"/ListIndexes"),t,{headers:n.headers});case 1:return e.a(2,e.v)}},e)}))))},e,this)})),function(e){return r.apply(this,arguments)})},{key:"deleteIndex",value:(n=f(d().m(function e(t,n){var r;return d().w(function(e){for(;;)if(0===e.n)return r=this,e.a(2,r.handleOperation(f(d().m(function e(){var i;return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Ye.post(r.fetch,"".concat(r.url,"/DeleteIndex"),{vectorBucketName:t,indexName:n},{headers:r.headers});case 1:if(i=e.v){e.n=2;break}i={};case 2:return e.a(2,i)}},e)}))))},e,this)})),function(e,t){return n.apply(this,arguments)})}]);var n,r,i,a}($e),st=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;return g(this,t),b(this,t,[e.replace(/\/$/,""),Ue(Ue({},nt),{},{"Content-Type":"application/json"},n),r,"vectors"])}return w(t,e),y(t,[{key:"putVectors",value:(s=f(d().m(function e(t){var n;return d().w(function(e){for(;;)switch(e.n){case 0:if(n=this,!(t.vectors.length<1||t.vectors.length>500)){e.n=1;break}throw new Error("Vector batch size must be between 1 and 500 items");case 1:return e.a(2,n.handleOperation(f(d().m(function e(){var r;return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Ye.post(n.fetch,"".concat(n.url,"/PutVectors"),t,{headers:n.headers});case 1:if(r=e.v){e.n=2;break}r={};case 2:return e.a(2,r)}},e)}))))}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"getVectors",value:(a=f(d().m(function e(t){var n;return d().w(function(e){for(;;)if(0===e.n)return n=this,e.a(2,n.handleOperation(f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Ye.post(n.fetch,"".concat(n.url,"/GetVectors"),t,{headers:n.headers});case 1:return e.a(2,e.v)}},e)}))))},e,this)})),function(e){return a.apply(this,arguments)})},{key:"listVectors",value:(i=f(d().m(function e(t){var n;return d().w(function(e){for(;;)switch(e.n){case 0:if(n=this,void 0===t.segmentCount){e.n=2;break}if(!(t.segmentCount<1||t.segmentCount>16)){e.n=1;break}throw new Error("segmentCount must be between 1 and 16");case 1:if(void 0===t.segmentIndex){e.n=2;break}if(!(t.segmentIndex<0||t.segmentIndex>=t.segmentCount)){e.n=2;break}throw new Error("segmentIndex must be between 0 and ".concat(t.segmentCount-1));case 2:return e.a(2,n.handleOperation(f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Ye.post(n.fetch,"".concat(n.url,"/ListVectors"),t,{headers:n.headers});case 1:return e.a(2,e.v)}},e)}))))}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"queryVectors",value:(r=f(d().m(function e(t){var n;return d().w(function(e){for(;;)if(0===e.n)return n=this,e.a(2,n.handleOperation(f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Ye.post(n.fetch,"".concat(n.url,"/QueryVectors"),t,{headers:n.headers});case 1:return e.a(2,e.v)}},e)}))))},e,this)})),function(e){return r.apply(this,arguments)})},{key:"deleteVectors",value:(n=f(d().m(function e(t){var n;return d().w(function(e){for(;;)switch(e.n){case 0:if(n=this,!(t.keys.length<1||t.keys.length>500)){e.n=1;break}throw new Error("Keys batch size must be between 1 and 500 items");case 1:return e.a(2,n.handleOperation(f(d().m(function e(){var r;return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Ye.post(n.fetch,"".concat(n.url,"/DeleteVectors"),t,{headers:n.headers});case 1:if(r=e.v){e.n=2;break}r={};case 2:return e.a(2,r)}},e)}))))}},e,this)})),function(e){return n.apply(this,arguments)})}]);var n,r,i,a,s}($e),ot=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;return g(this,t),b(this,t,[e.replace(/\/$/,""),Ue(Ue({},nt),{},{"Content-Type":"application/json"},n),r,"vectors"])}return w(t,e),y(t,[{key:"createBucket",value:(a=f(d().m(function e(t){var n;return d().w(function(e){for(;;)if(0===e.n)return n=this,e.a(2,n.handleOperation(f(d().m(function e(){var r;return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Ye.post(n.fetch,"".concat(n.url,"/CreateVectorBucket"),{vectorBucketName:t},{headers:n.headers});case 1:if(r=e.v){e.n=2;break}r={};case 2:return e.a(2,r)}},e)}))))},e,this)})),function(e){return a.apply(this,arguments)})},{key:"getBucket",value:(i=f(d().m(function e(t){var n;return d().w(function(e){for(;;)if(0===e.n)return n=this,e.a(2,n.handleOperation(f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Ye.post(n.fetch,"".concat(n.url,"/GetVectorBucket"),{vectorBucketName:t},{headers:n.headers});case 1:return e.a(2,e.v)}},e)}))))},e,this)})),function(e){return i.apply(this,arguments)})},{key:"listBuckets",value:(r=f(d().m(function e(){var t,n,r=arguments;return d().w(function(e){for(;;)if(0===e.n)return t=r.length>0&&void 0!==r[0]?r[0]:{},n=this,e.a(2,n.handleOperation(f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Ye.post(n.fetch,"".concat(n.url,"/ListVectorBuckets"),t,{headers:n.headers});case 1:return e.a(2,e.v)}},e)}))))},e,this)})),function(){return r.apply(this,arguments)})},{key:"deleteBucket",value:(n=f(d().m(function e(t){var n;return d().w(function(e){for(;;)if(0===e.n)return n=this,e.a(2,n.handleOperation(f(d().m(function e(){var r;return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Ye.post(n.fetch,"".concat(n.url,"/DeleteVectorBucket"),{vectorBucketName:t},{headers:n.headers});case 1:if(r=e.v){e.n=2;break}r={};case 2:return e.a(2,r)}},e)}))))},e,this)})),function(e){return n.apply(this,arguments)})}]);var n,r,i,a}($e),ut=function(e){function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return g(this,n),b(this,n,[e,t.headers||{},t.fetch])}return w(n,e),y(n,[{key:"from",value:function(e){return new ct(this.url,this.headers,e,this.fetch)}},{key:"createBucket",value:(s=f(d().m(function e(r){var i,a,s=this;return d().w(function(e){for(;;)if(0===e.n)return i=function(){return t(n,"createBucket",s,1)},a=this,e.a(2,i().call(a,r))},e,this)})),function(e){return s.apply(this,arguments)})},{key:"getBucket",value:(a=f(d().m(function e(r){var i,a,s=this;return d().w(function(e){for(;;)if(0===e.n)return i=function(){return t(n,"getBucket",s,1)},a=this,e.a(2,i().call(a,r))},e,this)})),function(e){return a.apply(this,arguments)})},{key:"listBuckets",value:(i=f(d().m(function e(){var r,i,a,s=this,o=arguments;return d().w(function(e){for(;;)if(0===e.n)return r=o.length>0&&void 0!==o[0]?o[0]:{},i=function(){return t(n,"listBuckets",s,1)},a=this,e.a(2,i().call(a,r))},e,this)})),function(){return i.apply(this,arguments)})},{key:"deleteBucket",value:(r=f(d().m(function e(r){var i,a,s=this;return d().w(function(e){for(;;)if(0===e.n)return i=function(){return t(n,"deleteBucket",s,1)},a=this,e.a(2,i().call(a,r))},e,this)})),function(e){return r.apply(this,arguments)})}]);var r,i,a,s}(ot),ct=function(e){function n(e,t,r,i){var a;return g(this,n),(a=b(this,n,[e,t,i])).vectorBucketName=r,a}return w(n,e),y(n,[{key:"createIndex",value:(s=f(d().m(function e(r){var i,a,s=this;return d().w(function(e){for(;;)if(0===e.n)return i=function(){return t(n,"createIndex",s,1)},a=this,e.a(2,i().call(a,Ue(Ue({},r),{},{vectorBucketName:a.vectorBucketName})))},e,this)})),function(e){return s.apply(this,arguments)})},{key:"listIndexes",value:(a=f(d().m(function e(){var r,i,a,s=this,o=arguments;return d().w(function(e){for(;;)if(0===e.n)return r=o.length>0&&void 0!==o[0]?o[0]:{},i=function(){return t(n,"listIndexes",s,1)},a=this,e.a(2,i().call(a,Ue(Ue({},r),{},{vectorBucketName:a.vectorBucketName})))},e,this)})),function(){return a.apply(this,arguments)})},{key:"getIndex",value:(i=f(d().m(function e(r){var i,a,s=this;return d().w(function(e){for(;;)if(0===e.n)return i=function(){return t(n,"getIndex",s,1)},a=this,e.a(2,i().call(a,a.vectorBucketName,r))},e,this)})),function(e){return i.apply(this,arguments)})},{key:"deleteIndex",value:(r=f(d().m(function e(r){var i,a,s=this;return d().w(function(e){for(;;)if(0===e.n)return i=function(){return t(n,"deleteIndex",s,1)},a=this,e.a(2,i().call(a,a.vectorBucketName,r))},e,this)})),function(e){return r.apply(this,arguments)})},{key:"index",value:function(e){return new lt(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}]);var r,i,a,s}(at),lt=function(e){function n(e,t,r,i,a){var s;return g(this,n),(s=b(this,n,[e,t,a])).vectorBucketName=r,s.indexName=i,s}return w(n,e),y(n,[{key:"putVectors",value:(o=f(d().m(function e(r){var i,a,s=this;return d().w(function(e){for(;;)if(0===e.n)return i=function(){return t(n,"putVectors",s,1)},a=this,e.a(2,i().call(a,Ue(Ue({},r),{},{vectorBucketName:a.vectorBucketName,indexName:a.indexName})))},e,this)})),function(e){return o.apply(this,arguments)})},{key:"getVectors",value:(s=f(d().m(function e(r){var i,a,s=this;return d().w(function(e){for(;;)if(0===e.n)return i=function(){return t(n,"getVectors",s,1)},a=this,e.a(2,i().call(a,Ue(Ue({},r),{},{vectorBucketName:a.vectorBucketName,indexName:a.indexName})))},e,this)})),function(e){return s.apply(this,arguments)})},{key:"listVectors",value:(a=f(d().m(function e(){var r,i,a,s=this,o=arguments;return d().w(function(e){for(;;)if(0===e.n)return r=o.length>0&&void 0!==o[0]?o[0]:{},i=function(){return t(n,"listVectors",s,1)},a=this,e.a(2,i().call(a,Ue(Ue({},r),{},{vectorBucketName:a.vectorBucketName,indexName:a.indexName})))},e,this)})),function(){return a.apply(this,arguments)})},{key:"queryVectors",value:(i=f(d().m(function e(r){var i,a,s=this;return d().w(function(e){for(;;)if(0===e.n)return i=function(){return t(n,"queryVectors",s,1)},a=this,e.a(2,i().call(a,Ue(Ue({},r),{},{vectorBucketName:a.vectorBucketName,indexName:a.indexName})))},e,this)})),function(e){return i.apply(this,arguments)})},{key:"deleteVectors",value:(r=f(d().m(function e(r){var i,a,s=this;return d().w(function(e){for(;;)if(0===e.n)return i=function(){return t(n,"deleteVectors",s,1)},a=this,e.a(2,i().call(a,Ue(Ue({},r),{},{vectorBucketName:a.vectorBucketName,indexName:a.indexName})))},e,this)})),function(e){return r.apply(this,arguments)})}]);var r,i,a,s,o}(st),ht=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;return g(this,t),b(this,t,[e,n,r,i])}return w(t,e),y(t,[{key:"from",value:function(e){return new tt(this.url,this.headers,e,this.fetch)}},{key:"vectors",get:function(){return new ut(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}},{key:"analytics",get:function(){return new it(this.url+"/iceberg",this.headers,this.fetch)}}])}(rt),ft="2.95.3",dt=3e4,pt=9e4,vt={"X-Client-Info":"gotrue-js/".concat(ft)},yt="X-Supabase-Api-Version",mt={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},gt=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,bt=function(e){function t(e,n,r){var i;return g(this,t),(i=b(this,t,[e])).__isAuthError=!0,i.name="AuthError",i.status=n,i.code=r,i}return w(t,e),y(t)}(k(Error));function wt(e){return"object"===s(e)&&null!==e&&"__isAuthError"in e}var kt=function(e){function t(e,n,r){var i;return g(this,t),(i=b(this,t,[e,n,r])).name="AuthApiError",i.status=n,i.code=r,i}return w(t,e),y(t)}(bt);function _t(e){return wt(e)&&"AuthApiError"===e.name}var St=function(e){function t(e,n){var r;return g(this,t),(r=b(this,t,[e])).name="AuthUnknownError",r.originalError=n,r}return w(t,e),y(t)}(bt),Tt=function(e){function t(e,n,r,i){var a;return g(this,t),(a=b(this,t,[e,r,i])).name=n,a.status=r,a}return w(t,e),y(t)}(bt),Et=function(e){function t(){return g(this,t),b(this,t,["Auth session missing!","AuthSessionMissingError",400,void 0])}return w(t,e),y(t)}(Tt);function Ot(e){return wt(e)&&"AuthSessionMissingError"===e.name}var Rt=function(e){function t(){return g(this,t),b(this,t,["Auth session or user missing","AuthInvalidTokenResponseError",500,void 0])}return w(t,e),y(t)}(Tt),At=function(e){function t(e){return g(this,t),b(this,t,[e,"AuthInvalidCredentialsError",400,void 0])}return w(t,e),y(t)}(Tt),jt=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return g(this,t),(n=b(this,t,[e,"AuthImplicitGrantRedirectError",500,void 0])).details=null,n.details=r,n}return w(t,e),y(t,[{key:"toJSON",value:function(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}])}(Tt);function Pt(e){return wt(e)&&"AuthImplicitGrantRedirectError"===e.name}var It=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return g(this,t),(n=b(this,t,[e,"AuthPKCEGrantCodeExchangeError",500,void 0])).details=null,n.details=r,n}return w(t,e),y(t,[{key:"toJSON",value:function(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}])}(Tt),Ct=function(e){function t(){return g(this,t),b(this,t,["PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found"])}return w(t,e),y(t)}(Tt),Nt=function(e){function t(e,n){return g(this,t),b(this,t,[e,"AuthRetryableFetchError",n,void 0])}return w(t,e),y(t)}(Tt);function xt(e){return wt(e)&&"AuthRetryableFetchError"===e.name}var Ut=function(e){function t(e,n,r){var i;return g(this,t),(i=b(this,t,[e,"AuthWeakPasswordError",n,"weak_password"])).reasons=r,i}return w(t,e),y(t)}(Tt),Lt=function(e){function t(e){return g(this,t),b(this,t,[e,"AuthInvalidJwtError",400,"invalid_jwt"])}return w(t,e),y(t)}(Tt),Dt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Bt=" \t\n\r=".split(""),qt=function(){for(var e=new Array(128),t=0;t<e.length;t+=1)e[t]=-1;for(var n=0;n<Bt.length;n+=1)e[Bt[n].charCodeAt(0)]=-2;for(var r=0;r<Dt.length;r+=1)e[Dt[r].charCodeAt(0)]=r;return e}();function Kt(e,t,n){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){var r=t.queue>>t.queuedBits-6&63;n(Dt[r]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){var i=t.queue>>t.queuedBits-6&63;n(Dt[i]),t.queuedBits-=6}}function Wt(e,t,n){var r=qt[e];if(!(r>-1)){if(-2===r)return;throw new Error('Invalid Base64-URL character "'.concat(String.fromCharCode(e),'"'))}for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)n(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function Mt(e){for(var t=[],n=function(e){t.push(String.fromCodePoint(e))},r={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},a=function(e){!function(e,t,n){if(0===t.utf8seq){if(e<=127)return void n(e);for(var r=1;r<6;r+=1)if(!(e>>7-r&1)){t.utf8seq=r;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&n(t.codepoint)}}(e,r,n)},s=0;s<e.length;s+=1)Wt(e.charCodeAt(s),i,a);return t.join("")}function Ft(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error("Unrecognized Unicode codepoint: ".concat(e.toString(16)))}t(e)}function Gt(e){for(var t=[],n={queue:0,queuedBits:0},r=function(e){t.push(e)},i=0;i<e.length;i+=1)Wt(e.charCodeAt(i),n,r);return new Uint8Array(t)}function Ht(e){var t=[];return function(e,t){for(var n=0;n<e.length;n+=1){var r=e.charCodeAt(n);if(r>55295&&r<=56319){var i=1024*(r-55296)&65535;r=65536+(e.charCodeAt(n+1)-56320&65535|i),n+=1}Ft(r,t)}}(e,function(e){return t.push(e)}),new Uint8Array(t)}function Jt(e){var t=[],n={queue:0,queuedBits:0},r=function(e){t.push(e)};return e.forEach(function(e){return Kt(e,n,r)}),Kt(null,n,r),t.join("")}var Vt=function(){return"undefined"!=typeof window&&"undefined"!=typeof document},zt={tested:!1,writable:!1},Yt=function(){if(!Vt())return!1;try{if("object"!==s(globalThis.localStorage))return!1}catch(t){return!1}if(zt.tested)return zt.writable;var e="lswt-".concat(Math.random()).concat(Math.random());try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),zt.tested=!0,zt.writable=!0}catch(t){zt.tested=!0,zt.writable=!1}return zt.writable};function $t(e){var t={},n=new URL(e);if(n.hash&&"#"===n.hash[0])try{new URLSearchParams(n.hash.substring(1)).forEach(function(e,n){t[n]=e})}catch(r){}return n.searchParams.forEach(function(e,n){t[n]=e}),t}var Xt=function(e){return e?function(){return e.apply(void 0,arguments)}:function(){return fetch.apply(void 0,arguments)}},Qt=function(e){return"object"===s(e)&&null!==e&&"status"in e&&"ok"in e&&"json"in e&&"function"==typeof e.json},Zt=function(){var e=f(d().m(function e(t,n,r){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.setItem(n,JSON.stringify(r));case 1:return e.a(2)}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),en=function(){var e=f(d().m(function e(t,n){var r;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.n=1,t.getItem(n);case 1:if(r=e.v){e.n=2;break}return e.a(2,null);case 2:return e.p=2,e.a(2,JSON.parse(r));case 3:return e.p=3,e.v,e.a(2,r)}},e,null,[[2,3]])}));return function(t,n){return e.apply(this,arguments)}}(),tn=function(){var e=f(d().m(function e(t,n){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.removeItem(n);case 1:return e.a(2)}},e)}));return function(t,n){return e.apply(this,arguments)}}(),nn=y(function e(){var t=this;g(this,e),this.promise=new e.promiseConstructor(function(e,n){t.resolve=e,t.reject=n})});function rn(e){var t=e.split(".");if(3!==t.length)throw new Lt("Invalid JWT structure");for(var n=0;n<t.length;n++)if(!gt.test(t[n]))throw new Lt("JWT not in base64url format");return{header:JSON.parse(Mt(t[0])),payload:JSON.parse(Mt(t[1])),signature:Gt(t[2]),raw:{header:t[0],payload:t[1]}}}function an(e){return sn.apply(this,arguments)}function sn(){return(sn=f(d().m(function e(t){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,new Promise(function(e){setTimeout(function(){return e(null)},t)});case 1:return e.a(2,e.v)}},e)}))).apply(this,arguments)}function on(e,t){return new Promise(function(n,r){f(d().m(function i(){var a,s,o;return d().w(function(i){for(;;)switch(i.p=i.n){case 0:a=0;case 1:if(!(a<1/0)){i.n=7;break}return i.p=2,i.n=3,e(a);case 3:if(s=i.v,t(a,null,s)){i.n=4;break}return n(s),i.a(2);case 4:i.n=6;break;case 5:if(i.p=5,o=i.v,t(a,o)){i.n=6;break}return r(o),i.a(2);case 6:a++,i.n=1;break;case 7:return i.a(2)}},i,null,[[2,5]])}))()})}function un(e){return("0"+e.toString(16)).substr(-2)}function cn(){var e=new Uint32Array(56);if("undefined"==typeof crypto){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n="",r=0;r<56;r++)n+=t.charAt(Math.floor(66*Math.random()));return n}return crypto.getRandomValues(e),Array.from(e,un).join("")}function ln(e){return hn.apply(this,arguments)}function hn(){return(hn=f(d().m(function e(t){var n,r,i,a;return d().w(function(e){for(;;)switch(e.n){case 0:return n=new TextEncoder,r=n.encode(t),e.n=1,crypto.subtle.digest("SHA-256",r);case 1:return i=e.v,a=new Uint8Array(i),e.a(2,Array.from(a).map(function(e){return String.fromCharCode(e)}).join(""))}},e)}))).apply(this,arguments)}function fn(e){return dn.apply(this,arguments)}function dn(){return(dn=f(d().m(function e(t){var n;return d().w(function(e){for(;;)switch(e.n){case 0:if("undefined"!=typeof crypto&&void 0!==crypto.subtle&&"undefined"!=typeof TextEncoder){e.n=1;break}return e.a(2,t);case 1:return e.n=2,ln(t);case 2:return n=e.v,e.a(2,btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""))}},e)}))).apply(this,arguments)}function pn(e,t){return vn.apply(this,arguments)}function vn(){return vn=f(d().m(function e(t,n){var r,i,a,s,o,u=arguments;return d().w(function(e){for(;;)switch(e.n){case 0:return r=u.length>2&&void 0!==u[2]&&u[2],i=cn(),a=i,r&&(a+="/PASSWORD_RECOVERY"),e.n=1,Zt(t,"".concat(n,"-code-verifier"),a);case 1:return e.n=2,fn(i);case 2:return s=e.v,o=i===s?"plain":"s256",e.a(2,[s,o])}},e)})),vn.apply(this,arguments)}nn.promiseConstructor=Promise;var yn=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function mn(e){var t=e.headers.get(yt);if(!t)return null;if(!t.match(yn))return null;try{return new Date("".concat(t,"T00:00:00.0Z"))}catch(n){return null}}function gn(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}function bn(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var wn=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function kn(e){if(!wn.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function _n(){return new Proxy({},{get:function(e,t){if("__isUserNotAvailableProxy"===t)return!0;if("symbol"===s(t)){var n=t.toString();if("Symbol(Symbol.toPrimitive)"===n||"Symbol(Symbol.toStringTag)"===n||"Symbol(util.inspect.custom)"===n)return}throw new Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "'.concat(t,'" property of the session object is not supported. Please use getUser() instead.'))},set:function(e,t){throw new Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "'.concat(t,'" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.'))},deleteProperty:function(e,t){throw new Error('@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "'.concat(t,'" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.'))}})}function Sn(e,t){return new Proxy(e,{get:function(e,n,r){if("__isInsecureUserWarningProxy"===n)return!0;if("symbol"===s(n)){var i=n.toString();if("Symbol(Symbol.toPrimitive)"===i||"Symbol(Symbol.toStringTag)"===i||"Symbol(util.inspect.custom)"===i||"Symbol(nodejs.util.inspect.custom)"===i)return Reflect.get(e,n,r)}return t.value||"string"!=typeof n||(t.value=!0),Reflect.get(e,n,r)}})}function Tn(e){return JSON.parse(JSON.stringify(e))}var En=function(e){return e.msg||e.message||e.error_description||e.error||JSON.stringify(e)},On=[502,503,504];function Rn(e){return An.apply(this,arguments)}function An(){return(An=f(d().m(function e(t){var n,r,i,a,o;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:if(Qt(t)){e.n=1;break}throw new Nt(En(t),0);case 1:if(!On.includes(t.status)){e.n=2;break}throw new Nt(En(t),t.status);case 2:return e.p=2,e.n=3,t.json();case 3:r=e.v,e.n=5;break;case 4:throw e.p=4,o=e.v,new St(En(o),o);case 5:if(i=void 0,(a=mn(t))&&a.getTime()>=mt.timestamp&&"object"===s(r)&&r&&"string"==typeof r.code?i=r.code:"object"===s(r)&&r&&"string"==typeof r.error_code&&(i=r.error_code),i){e.n=7;break}if(!("object"===s(r)&&r&&"object"===s(r.weak_password)&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce(function(e,t){return e&&"string"==typeof t},!0))){e.n=6;break}throw new Ut(En(r),t.status,r.weak_password.reasons);case 6:e.n=9;break;case 7:if("weak_password"!==i){e.n=8;break}throw new Ut(En(r),t.status,(null===(n=r.weak_password)||void 0===n?void 0:n.reasons)||[]);case 8:if("session_not_found"!==i){e.n=9;break}throw new Et;case 9:throw new kt(En(r),t.status||500,i);case 10:return e.a(2)}},e,null,[[2,4]])}))).apply(this,arguments)}var jn=function(e,t,n,r){var i={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),i.body=JSON.stringify(r),Object.assign(Object.assign({},i),n))};function Pn(e,t,n,r){return In.apply(this,arguments)}function In(){return(In=f(d().m(function e(t,n,r,i){var a,s,o,u,c;return d().w(function(e){for(;;)switch(e.n){case 0:return(s=Object.assign({},null==i?void 0:i.headers))[yt]||(s[yt]=mt.name),(null==i?void 0:i.jwt)&&(s.Authorization="Bearer ".concat(i.jwt)),o=null!==(a=null==i?void 0:i.query)&&void 0!==a?a:{},(null==i?void 0:i.redirectTo)&&(o.redirect_to=i.redirectTo),u=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",e.n=1,Cn(t,n,r+u,{headers:s,noResolveJson:null==i?void 0:i.noResolveJson},{},null==i?void 0:i.body);case 1:return c=e.v,e.a(2,(null==i?void 0:i.xform)?null==i?void 0:i.xform(c):{data:Object.assign({},c),error:null})}},e)}))).apply(this,arguments)}function Cn(e,t,n,r,i,a){return Nn.apply(this,arguments)}function Nn(){return(Nn=f(d().m(function e(t,n,r,i,a,s){var o,u,c,l;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return o=jn(n,i,a,s),e.p=1,e.n=2,t(r,Object.assign({},o));case 2:u=e.v,e.n=4;break;case 3:throw e.p=3,c=e.v,new Nt(En(c),0);case 4:if(u.ok){e.n=5;break}return e.n=5,Rn(u);case 5:if(!(null==i?void 0:i.noResolveJson)){e.n=6;break}return e.a(2,u);case 6:return e.p=6,e.n=7,u.json();case 7:return e.a(2,e.v);case 8:return e.p=8,l=e.v,e.n=9,Rn(l);case 9:return e.a(2)}},e,null,[[6,8],[1,3]])}))).apply(this,arguments)}function xn(e){var t,n,r=null;return function(e){return e.access_token&&e.refresh_token&&e.expires_in}(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=(n=e.expires_in,Math.round(Date.now()/1e3)+n))),{data:{session:r,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Un(e){var t=xn(e);return!t.error&&e.weak_password&&"object"===s(e.weak_password)&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce(function(e,t){return e&&"string"==typeof t},!0)&&(t.data.weak_password=e.weak_password),t}function Ln(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Dn(e){return{data:e,error:null}}function Bn(e){var t=e.action_link,n=e.email_otp,i=e.hashed_token,a=e.redirect_to,s=e.verification_type,o=r(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:n,hashed_token:i,redirect_to:a,verification_type:s},user:Object.assign({},o)},error:null}}function qn(e){return e}var Kn=["global","local","others"],Wn=function(){return y(function e(t){var n=t.url,r=void 0===n?"":n,i=t.headers,a=void 0===i?{}:i,s=t.fetch;g(this,e),this.url=r,this.headers=a,this.fetch=Xt(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}},[{key:"signOut",value:(w=f(d().m(function e(t){var n,r,i=arguments;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:Kn[0],!(Kn.indexOf(n)<0)){e.n=1;break}throw new Error("@supabase/auth-js: Parameter scope must be one of ".concat(Kn.join(", ")));case 1:return e.p=1,e.n=2,Pn(this.fetch,"POST","".concat(this.url,"/logout?scope=").concat(n),{headers:this.headers,jwt:t,noResolveJson:!0});case 2:return e.a(2,{data:null,error:null});case 3:if(e.p=3,!wt(r=e.v)){e.n=4;break}return e.a(2,{data:null,error:r});case 4:throw r;case 5:return e.a(2)}},e,this,[[1,3]])})),function(e){return w.apply(this,arguments)})},{key:"inviteUserByEmail",value:(b=f(d().m(function e(t){var n,r,i=arguments;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:{},e.p=1,e.n=2,Pn(this.fetch,"POST","".concat(this.url,"/invite"),{body:{email:t,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:Ln});case 2:return e.a(2,e.v);case 3:if(e.p=3,!wt(r=e.v)){e.n=4;break}return e.a(2,{data:{user:null},error:r});case 4:throw r;case 5:return e.a(2)}},e,this,[[1,3]])})),function(e){return b.apply(this,arguments)})},{key:"generateLink",value:(m=f(d().m(function e(t){var n,i,a,s;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,n=t.options,i=r(t,["options"]),a=Object.assign(Object.assign({},i),n),"newEmail"in i&&(a.new_email=null==i?void 0:i.newEmail,delete a.newEmail),e.n=1,Pn(this.fetch,"POST","".concat(this.url,"/admin/generate_link"),{body:a,headers:this.headers,xform:Bn,redirectTo:null==n?void 0:n.redirectTo});case 1:return e.a(2,e.v);case 2:if(e.p=2,!wt(s=e.v)){e.n=3;break}return e.a(2,{data:{properties:null,user:null},error:s});case 3:throw s;case 4:return e.a(2)}},e,this,[[0,2]])})),function(e){return m.apply(this,arguments)})},{key:"createUser",value:(v=f(d().m(function e(t){var n;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Pn(this.fetch,"POST","".concat(this.url,"/admin/users"),{body:t,headers:this.headers,xform:Ln});case 1:return e.a(2,e.v);case 2:if(e.p=2,!wt(n=e.v)){e.n=3;break}return e.a(2,{data:{user:null},error:n});case 3:throw n;case 4:return e.a(2)}},e,this,[[0,2]])})),function(e){return v.apply(this,arguments)})},{key:"listUsers",value:(p=f(d().m(function e(t){var n,r,i,a,s,o,u,c,l,h,f,p,v;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,c={nextPage:null,lastPage:0,total:0},e.n=1,Pn(this.fetch,"GET","".concat(this.url,"/admin/users"),{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(n=null==t?void 0:t.page)||void 0===n?void 0:n.toString())&&void 0!==r?r:"",per_page:null!==(a=null===(i=null==t?void 0:t.perPage)||void 0===i?void 0:i.toString())&&void 0!==a?a:""},xform:qn});case 1:if(!(l=e.v).error){e.n=2;break}throw l.error;case 2:return e.n=3,l.json();case 3:return h=e.v,f=null!==(s=l.headers.get("x-total-count"))&&void 0!==s?s:0,(p=null!==(u=null===(o=l.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==u?u:[]).length>0&&(p.forEach(function(e){var t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),n=JSON.parse(e.split(";")[1].split("=")[1]);c["".concat(n,"Page")]=t}),c.total=parseInt(f)),e.a(2,{data:Object.assign(Object.assign({},h),c),error:null});case 4:if(e.p=4,!wt(v=e.v)){e.n=5;break}return e.a(2,{data:{users:[]},error:v});case 5:throw v;case 6:return e.a(2)}},e,this,[[0,4]])})),function(e){return p.apply(this,arguments)})},{key:"getUserById",value:(h=f(d().m(function e(t){var n;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return kn(t),e.p=1,e.n=2,Pn(this.fetch,"GET","".concat(this.url,"/admin/users/").concat(t),{headers:this.headers,xform:Ln});case 2:return e.a(2,e.v);case 3:if(e.p=3,!wt(n=e.v)){e.n=4;break}return e.a(2,{data:{user:null},error:n});case 4:throw n;case 5:return e.a(2)}},e,this,[[1,3]])})),function(e){return h.apply(this,arguments)})},{key:"updateUserById",value:(l=f(d().m(function e(t,n){var r;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return kn(t),e.p=1,e.n=2,Pn(this.fetch,"PUT","".concat(this.url,"/admin/users/").concat(t),{body:n,headers:this.headers,xform:Ln});case 2:return e.a(2,e.v);case 3:if(e.p=3,!wt(r=e.v)){e.n=4;break}return e.a(2,{data:{user:null},error:r});case 4:throw r;case 5:return e.a(2)}},e,this,[[1,3]])})),function(e,t){return l.apply(this,arguments)})},{key:"deleteUser",value:(c=f(d().m(function e(t){var n,r,i=arguments;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=i.length>1&&void 0!==i[1]&&i[1],kn(t),e.p=1,e.n=2,Pn(this.fetch,"DELETE","".concat(this.url,"/admin/users/").concat(t),{headers:this.headers,body:{should_soft_delete:n},xform:Ln});case 2:return e.a(2,e.v);case 3:if(e.p=3,!wt(r=e.v)){e.n=4;break}return e.a(2,{data:{user:null},error:r});case 4:throw r;case 5:return e.a(2)}},e,this,[[1,3]])})),function(e){return c.apply(this,arguments)})},{key:"_listFactors",value:(u=f(d().m(function e(t){var n,r,i,a;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return kn(t.userId),e.p=1,e.n=2,Pn(this.fetch,"GET","".concat(this.url,"/admin/users/").concat(t.userId,"/factors"),{headers:this.headers,xform:function(e){return{data:{factors:e},error:null}}});case 2:return n=e.v,r=n.data,i=n.error,e.a(2,{data:r,error:i});case 3:if(e.p=3,!wt(a=e.v)){e.n=4;break}return e.a(2,{data:null,error:a});case 4:throw a;case 5:return e.a(2)}},e,this,[[1,3]])})),function(e){return u.apply(this,arguments)})},{key:"_deleteFactor",value:(o=f(d().m(function e(t){var n,r;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return kn(t.userId),kn(t.id),e.p=1,e.n=2,Pn(this.fetch,"DELETE","".concat(this.url,"/admin/users/").concat(t.userId,"/factors/").concat(t.id),{headers:this.headers});case 2:return n=e.v,e.a(2,{data:n,error:null});case 3:if(e.p=3,!wt(r=e.v)){e.n=4;break}return e.a(2,{data:null,error:r});case 4:throw r;case 5:return e.a(2)}},e,this,[[1,3]])})),function(e){return o.apply(this,arguments)})},{key:"_listOAuthClients",value:(s=f(d().m(function e(t){var n,r,i,a,s,o,u,c,l,h,f,p,v;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,c={nextPage:null,lastPage:0,total:0},e.n=1,Pn(this.fetch,"GET","".concat(this.url,"/admin/oauth/clients"),{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(n=null==t?void 0:t.page)||void 0===n?void 0:n.toString())&&void 0!==r?r:"",per_page:null!==(a=null===(i=null==t?void 0:t.perPage)||void 0===i?void 0:i.toString())&&void 0!==a?a:""},xform:qn});case 1:if(!(l=e.v).error){e.n=2;break}throw l.error;case 2:return e.n=3,l.json();case 3:return h=e.v,f=null!==(s=l.headers.get("x-total-count"))&&void 0!==s?s:0,(p=null!==(u=null===(o=l.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==u?u:[]).length>0&&(p.forEach(function(e){var t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),n=JSON.parse(e.split(";")[1].split("=")[1]);c["".concat(n,"Page")]=t}),c.total=parseInt(f)),e.a(2,{data:Object.assign(Object.assign({},h),c),error:null});case 4:if(e.p=4,!wt(v=e.v)){e.n=5;break}return e.a(2,{data:{clients:[]},error:v});case 5:throw v;case 6:return e.a(2)}},e,this,[[0,4]])})),function(e){return s.apply(this,arguments)})},{key:"_createOAuthClient",value:(a=f(d().m(function e(t){var n;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Pn(this.fetch,"POST","".concat(this.url,"/admin/oauth/clients"),{body:t,headers:this.headers,xform:function(e){return{data:e,error:null}}});case 1:return e.a(2,e.v);case 2:if(e.p=2,!wt(n=e.v)){e.n=3;break}return e.a(2,{data:null,error:n});case 3:throw n;case 4:return e.a(2)}},e,this,[[0,2]])})),function(e){return a.apply(this,arguments)})},{key:"_getOAuthClient",value:(i=f(d().m(function e(t){var n;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Pn(this.fetch,"GET","".concat(this.url,"/admin/oauth/clients/").concat(t),{headers:this.headers,xform:function(e){return{data:e,error:null}}});case 1:return e.a(2,e.v);case 2:if(e.p=2,!wt(n=e.v)){e.n=3;break}return e.a(2,{data:null,error:n});case 3:throw n;case 4:return e.a(2)}},e,this,[[0,2]])})),function(e){return i.apply(this,arguments)})},{key:"_updateOAuthClient",value:(n=f(d().m(function e(t,n){var r;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Pn(this.fetch,"PUT","".concat(this.url,"/admin/oauth/clients/").concat(t),{body:n,headers:this.headers,xform:function(e){return{data:e,error:null}}});case 1:return e.a(2,e.v);case 2:if(e.p=2,!wt(r=e.v)){e.n=3;break}return e.a(2,{data:null,error:r});case 3:throw r;case 4:return e.a(2)}},e,this,[[0,2]])})),function(e,t){return n.apply(this,arguments)})},{key:"_deleteOAuthClient",value:(t=f(d().m(function e(t){var n;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Pn(this.fetch,"DELETE","".concat(this.url,"/admin/oauth/clients/").concat(t),{headers:this.headers,noResolveJson:!0});case 1:return e.a(2,{data:null,error:null});case 2:if(e.p=2,!wt(n=e.v)){e.n=3;break}return e.a(2,{data:null,error:n});case 3:throw n;case 4:return e.a(2)}},e,this,[[0,2]])})),function(e){return t.apply(this,arguments)})},{key:"_regenerateOAuthClientSecret",value:(e=f(d().m(function e(t){var n;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Pn(this.fetch,"POST","".concat(this.url,"/admin/oauth/clients/").concat(t,"/regenerate_secret"),{headers:this.headers,xform:function(e){return{data:e,error:null}}});case 1:return e.a(2,e.v);case 2:if(e.p=2,!wt(n=e.v)){e.n=3;break}return e.a(2,{data:null,error:n});case 3:throw n;case 4:return e.a(2)}},e,this,[[0,2]])})),function(t){return e.apply(this,arguments)})}]);var e,t,n,i,a,s,o,u,c,l,h,p,v,m,b,w}();function Mn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{getItem:function(t){return e[t]||null},setItem:function(t,n){e[t]=n},removeItem:function(t){delete e[t]}}}var Fn=!!(globalThis&&Yt()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")),Gn=function(e){function t(e){var n;return g(this,t),(n=b(this,t,[e])).isAcquireTimeout=!0,n}return w(t,e),y(t)}(k(Error)),Hn=function(e){function t(){return g(this,t),b(this,t,arguments)}return w(t,e),y(t)}(Gn);function Jn(e,t,n){return Vn.apply(this,arguments)}function Vn(){return Vn=f(d().m(function e(t,n,r){var i;return d().w(function(e){for(;;)switch(e.n){case 0:return i=new globalThis.AbortController,n>0&&setTimeout(function(){i.abort()},n),e.n=1,Promise.resolve().then(function(){return globalThis.navigator.locks.request(t,0===n?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:i.signal},function(){var e=f(d().m(function e(i){return d().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!i){e.n=5;break}return e.p=1,e.n=2,r();case 2:return e.a(2,e.v);case 3:return e.p=3,e.f(3);case 4:e.n=12;break;case 5:if(0!==n){e.n=6;break}throw new Hn('Acquiring an exclusive Navigator LockManager lock "'.concat(t,'" immediately failed'));case 6:if(!Fn){e.n=10;break}return e.p=7,e.n=8,globalThis.navigator.locks.query();case 8:e.v,e.n=10;break;case 9:e.p=9,e.v;case 10:return e.n=11,r();case 11:return e.a(2,e.v);case 12:return e.a(2)}},e,null,[[7,9],[1,,3,4]])}));return function(t){return e.apply(this,arguments)}}())});case 1:return e.a(2,e.v)}},e)})),Vn.apply(this,arguments)}function zn(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error('@supabase/auth-js: Address "'.concat(e,'" is invalid.'));return e.toLowerCase()}function Yn(e){return parseInt(e,16)}function $n(e){var t=(new TextEncoder).encode(e);return"0x"+Array.from(t,function(e){return e.toString(16).padStart(2,"0")}).join("")}function Xn(t){var n,r=t.chainId,i=t.domain,a=t.expirationTime,s=t.issuedAt,o=void 0===s?new Date:s,u=t.nonce,c=t.notBefore,l=t.requestId,h=t.resources,f=t.scheme,d=t.uri,p=t.version;if(!Number.isInteger(r))throw new Error('@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: '.concat(r));if(!i)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(u&&u.length<8)throw new Error('@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: '.concat(u));if(!d)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if("1"!==p)throw new Error("@supabase/auth-js: Invalid SIWE message field \"version\". Version must be '1'. Provided value: ".concat(p));if(null===(n=t.statement)||void 0===n?void 0:n.includes("\n"))throw new Error("@supabase/auth-js: Invalid SIWE message field \"statement\". Statement must not include '\\n'. Provided value: ".concat(t.statement));var v=zn(t.address),y=f?"".concat(f,"://").concat(i):i,m=t.statement?"".concat(t.statement,"\n"):"",g="".concat(y," wants you to sign in with your Ethereum account:\n").concat(v,"\n\n").concat(m),b="URI: ".concat(d,"\nVersion: ").concat(p,"\nChain ID: ").concat(r).concat(u?"\nNonce: ".concat(u):"","\nIssued At: ").concat(o.toISOString());if(a&&(b+="\nExpiration Time: ".concat(a.toISOString())),c&&(b+="\nNot Before: ".concat(c.toISOString())),l&&(b+="\nRequest ID: ".concat(l)),h){var w,k="\nResources:",_=e(h);try{for(_.s();!(w=_.n()).done;){var S=w.value;if(!S||"string"!=typeof S)throw new Error('@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: '.concat(S));k+="\n- ".concat(S)}}catch(T){_.e(T)}finally{_.f()}b+=k}return"".concat(g,"\n").concat(b)}var Qn=function(e){function t(e){var n,r,i=e.message,a=e.code,s=e.cause,o=e.name;return g(this,t),(n=b(this,t,[i,{cause:s}])).__isWebAuthnError=!0,n.name=null!==(r=null!=o?o:s instanceof Error?s.name:void 0)&&void 0!==r?r:"Unknown Error",n.code=a,n}return w(t,e),y(t)}(k(Error)),Zn=function(e){function t(e,n){var r;return g(this,t),(r=b(this,t,[{code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n,message:e}])).name="WebAuthnUnknownError",r.originalError=n,r}return w(t,e),y(t)}(Qn);function er(e){var t,n,r,i=e.error,a=e.options,s=a.publicKey;if(!s)throw Error("options was missing required publicKey property");if("AbortError"===i.name){if(a.signal instanceof AbortSignal)return new Qn({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:i})}else if("ConstraintError"===i.name){if(!0===(null===(t=s.authenticatorSelection)||void 0===t?void 0:t.requireResidentKey))return new Qn({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:i});if("conditional"===a.mediation&&"required"===(null===(n=s.authenticatorSelection)||void 0===n?void 0:n.userVerification))return new Qn({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:i});if("required"===(null===(r=s.authenticatorSelection)||void 0===r?void 0:r.userVerification))return new Qn({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:i})}else{if("InvalidStateError"===i.name)return new Qn({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:i});if("NotAllowedError"===i.name)return new Qn({message:i.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i});if("NotSupportedError"===i.name)return 0===s.pubKeyCredParams.filter(function(e){return"public-key"===e.type}).length?new Qn({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:i}):new Qn({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:i});if("SecurityError"===i.name){var o=window.location.hostname;if(!or(o))return new Qn({message:"".concat(window.location.hostname," is an invalid domain"),code:"ERROR_INVALID_DOMAIN",cause:i});if(s.rp.id!==o)return new Qn({message:'The RP ID "'.concat(s.rp.id,'" is invalid for this domain'),code:"ERROR_INVALID_RP_ID",cause:i})}else if("TypeError"===i.name){if(s.user.id.byteLength<1||s.user.id.byteLength>64)return new Qn({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:i})}else if("UnknownError"===i.name)return new Qn({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:i})}return new Qn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i})}function tr(e){var t=e.error,n=e.options,r=n.publicKey;if(!r)throw Error("options was missing required publicKey property");if("AbortError"===t.name){if(n.signal instanceof AbortSignal)return new Qn({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if("NotAllowedError"===t.name)return new Qn({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if("SecurityError"===t.name){var i=window.location.hostname;if(!or(i))return new Qn({message:"".concat(window.location.hostname," is an invalid domain"),code:"ERROR_INVALID_DOMAIN",cause:t});if(r.rpId!==i)return new Qn({message:'The RP ID "'.concat(r.rpId,'" is invalid for this domain'),code:"ERROR_INVALID_RP_ID",cause:t})}else if("UnknownError"===t.name)return new Qn({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Qn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}var nr=new(function(){return y(function e(){g(this,e)},[{key:"createNewAbortSignal",value:function(){if(this.controller){var e=new Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}var t=new AbortController;return this.controller=t,t.signal}},{key:"cancelCeremony",value:function(){if(this.controller){var e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}])}());function rr(e){if(!e)throw new Error("Credential creation options are required");if("undefined"!=typeof PublicKeyCredential&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseCreationOptionsFromJSON)return PublicKeyCredential.parseCreationOptionsFromJSON(e);var t=e.challenge,n=e.user,i=e.excludeCredentials,a=r(e,["challenge","user","excludeCredentials"]),s=Gt(t).buffer,o=Object.assign(Object.assign({},n),{id:Gt(n.id).buffer}),u=Object.assign(Object.assign({},a),{challenge:s,user:o});if(i&&i.length>0){u.excludeCredentials=new Array(i.length);for(var c=0;c<i.length;c++){var l=i[c];u.excludeCredentials[c]=Object.assign(Object.assign({},l),{id:Gt(l.id).buffer,type:l.type||"public-key",transports:l.transports})}}return u}function ir(e){if(!e)throw new Error("Credential request options are required");if("undefined"!=typeof PublicKeyCredential&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseRequestOptionsFromJSON)return PublicKeyCredential.parseRequestOptionsFromJSON(e);var t=e.challenge,n=e.allowCredentials,i=r(e,["challenge","allowCredentials"]),a=Gt(t).buffer,s=Object.assign(Object.assign({},i),{challenge:a});if(n&&n.length>0){s.allowCredentials=new Array(n.length);for(var o=0;o<n.length;o++){var u=n[o];s.allowCredentials[o]=Object.assign(Object.assign({},u),{id:Gt(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return s}function ar(e){var t;if("toJSON"in e&&"function"==typeof e.toJSON)return e.toJSON();var n=e;return{id:e.id,rawId:e.id,response:{attestationObject:Jt(new Uint8Array(e.response.attestationObject)),clientDataJSON:Jt(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:null!==(t=n.authenticatorAttachment)&&void 0!==t?t:void 0}}function sr(e){var t;if("toJSON"in e&&"function"==typeof e.toJSON)return e.toJSON();var n=e,r=e.getClientExtensionResults(),i=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:Jt(new Uint8Array(i.authenticatorData)),clientDataJSON:Jt(new Uint8Array(i.clientDataJSON)),signature:Jt(new Uint8Array(i.signature)),userHandle:i.userHandle?Jt(new Uint8Array(i.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:null!==(t=n.authenticatorAttachment)&&void 0!==t?t:void 0}}function or(e){return"localhost"===e||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function ur(){var e,t;return!!(Vt()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&"function"==typeof(null===(e=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===e?void 0:e.create)&&"function"==typeof(null===(t=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===t?void 0:t.get))}function cr(e){return lr.apply(this,arguments)}function lr(){return(lr=f(d().m(function e(t){var n,r;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,navigator.credentials.create(t);case 1:if(n=e.v){e.n=2;break}return e.a(2,{data:null,error:new Zn("Empty credential response",n)});case 2:if(n instanceof PublicKeyCredential){e.n=3;break}return e.a(2,{data:null,error:new Zn("Browser returned unexpected credential type",n)});case 3:return e.a(2,{data:n,error:null});case 4:return e.p=4,r=e.v,e.a(2,{data:null,error:er({error:r,options:t})})}},e,null,[[0,4]])}))).apply(this,arguments)}function hr(e){return fr.apply(this,arguments)}function fr(){return(fr=f(d().m(function e(t){var n,r;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,navigator.credentials.get(t);case 1:if(n=e.v){e.n=2;break}return e.a(2,{data:null,error:new Zn("Empty credential response",n)});case 2:if(n instanceof PublicKeyCredential){e.n=3;break}return e.a(2,{data:null,error:new Zn("Browser returned unexpected credential type",n)});case 3:return e.a(2,{data:n,error:null});case 4:return e.p=4,r=e.v,e.a(2,{data:null,error:tr({error:r,options:t})})}},e,null,[[0,4]])}))).apply(this,arguments)}var dr={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},pr={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function vr(){for(var e=function(e){return null!==e&&"object"===s(e)&&!Array.isArray(e)},t=function(e){return e instanceof ArrayBuffer||ArrayBuffer.isView(e)},n={},r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];for(var o=0,u=i;o<u.length;o++){var c=u[o];if(c)for(var l in c){var h=c[l];if(void 0!==h)if(Array.isArray(h))n[l]=h;else if(t(h))n[l]=h;else if(e(h)){var f=n[l];e(f)?n[l]=vr(f,h):n[l]=vr(h)}else n[l]=h}}return n}function yr(e,t){return vr(dr,e,t||{})}function mr(e,t){return vr(pr,e,t||{})}var gr=function(){return y(function e(t){g(this,e),this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)},[{key:"_enroll",value:(i=f(d().m(function e(t){return d().w(function(e){for(;;)if(0===e.n)return e.a(2,this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"})))},e,this)})),function(e){return i.apply(this,arguments)})},{key:"_challenge",value:(r=f(d().m(function e(t,n){var r,i,a,s,o,u,c,l,h,f,p,v,y,m,g,b,w,k,_,S,T,E,O,R;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return r=t.factorId,i=t.webauthn,a=t.friendlyName,s=t.signal,e.p=1,e.n=2,this.client.mfa.challenge({factorId:r,webauthn:i});case 2:if(u=e.v,c=u.data,l=u.error,c){e.n=3;break}return e.a(2,{data:null,error:l});case 3:if(h=null!=s?s:nr.createNewAbortSignal(),"create"!==c.webauthn.type){e.n=7;break}if((f=c.webauthn.credential_options.publicKey.user).name){e.n=6;break}if(p=a){e.n=5;break}return e.n=4,this.client.getUser();case 4:v=e.v,y=v.data.user,m=(null===(o=null==y?void 0:y.user_metadata)||void 0===o?void 0:o.name)||(null==y?void 0:y.email)||(null==y?void 0:y.id)||"User",f.name="".concat(f.id,":").concat(m),e.n=6;break;case 5:f.name="".concat(f.id,":").concat(p);case 6:f.displayName||(f.displayName=f.name);case 7:O=c.webauthn.type,e.n="create"===O?8:"request"===O?11:14;break;case 8:return g=yr(c.webauthn.credential_options.publicKey,null==n?void 0:n.create),e.n=9,cr({publicKey:g,signal:h});case 9:if(b=e.v,w=b.data,k=b.error,!w){e.n=10;break}return e.a(2,{data:{factorId:r,challengeId:c.id,webauthn:{type:c.webauthn.type,credential_response:w}},error:null});case 10:return e.a(2,{data:null,error:k});case 11:return _=mr(c.webauthn.credential_options.publicKey,null==n?void 0:n.request),e.n=12,hr(Object.assign(Object.assign({},c.webauthn.credential_options),{publicKey:_,signal:h}));case 12:if(S=e.v,T=S.data,E=S.error,!T){e.n=13;break}return e.a(2,{data:{factorId:r,challengeId:c.id,webauthn:{type:c.webauthn.type,credential_response:T}},error:null});case 13:return e.a(2,{data:null,error:E});case 14:e.n=17;break;case 15:if(e.p=15,!wt(R=e.v)){e.n=16;break}return e.a(2,{data:null,error:R});case 16:return e.a(2,{data:null,error:new St("Unexpected error in challenge",R)});case 17:return e.a(2)}},e,this,[[1,15]])})),function(e,t){return r.apply(this,arguments)})},{key:"_verify",value:(n=f(d().m(function e(t){var n,r,i;return d().w(function(e){for(;;)if(0===e.n)return n=t.challengeId,r=t.factorId,i=t.webauthn,e.a(2,this.client.mfa.verify({factorId:r,challengeId:n,webauthn:i}))},e,this)})),function(e){return n.apply(this,arguments)})},{key:"_authenticate",value:(t=f(d().m(function e(t,n){var r,i,a,s,o,u,c,l,h,f,p,v,y;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r=t.factorId,i=t.webauthn,s=(a=void 0===i?{}:i).rpId,o=void 0===s?"undefined"!=typeof window?window.location.hostname:void 0:s,u=a.rpOrigins,c=void 0===u?"undefined"!=typeof window?[window.location.origin]:void 0:u,l=a.signal,o){e.n=1;break}return e.a(2,{data:null,error:new bt("rpId is required for WebAuthn authentication")});case 1:if(e.p=1,ur()){e.n=2;break}return e.a(2,{data:null,error:new St("Browser does not support WebAuthn",null)});case 2:return e.n=3,this.challenge({factorId:r,webauthn:{rpId:o,rpOrigins:c},signal:l},{request:n});case 3:if(h=e.v,f=h.data,p=h.error,f){e.n=4;break}return e.a(2,{data:null,error:p});case 4:return v=f.webauthn,e.a(2,this._verify({factorId:r,challengeId:f.challengeId,webauthn:{type:v.type,rpId:o,rpOrigins:c,credential_response:v.credential_response}}));case 5:if(e.p=5,!wt(y=e.v)){e.n=6;break}return e.a(2,{data:null,error:y});case 6:return e.a(2,{data:null,error:new St("Unexpected error in authenticate",y)})}},e,this,[[1,5]])})),function(e,n){return t.apply(this,arguments)})},{key:"_register",value:(e=f(d().m(function e(t,n){var r,i,a,s,o,u,c,l,h,f,p,v,y,m,g,b=this;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r=t.friendlyName,i=t.webauthn,s=(a=void 0===i?{}:i).rpId,o=void 0===s?"undefined"!=typeof window?window.location.hostname:void 0:s,u=a.rpOrigins,c=void 0===u?"undefined"!=typeof window?[window.location.origin]:void 0:u,l=a.signal,o){e.n=1;break}return e.a(2,{data:null,error:new bt("rpId is required for WebAuthn registration")});case 1:if(e.p=1,ur()){e.n=2;break}return e.a(2,{data:null,error:new St("Browser does not support WebAuthn",null)});case 2:return e.n=3,this._enroll({friendlyName:r});case 3:if(h=e.v,f=h.data,p=h.error,f){e.n=5;break}return e.n=4,this.client.mfa.listFactors().then(function(e){var t;return null===(t=e.data)||void 0===t?void 0:t.all.find(function(e){return"webauthn"===e.factor_type&&e.friendly_name===r&&"unverified"!==e.status})}).then(function(e){return e?b.client.mfa.unenroll({factorId:null==e?void 0:e.id}):void 0});case 4:return e.a(2,{data:null,error:p});case 5:return e.n=6,this._challenge({factorId:f.id,friendlyName:f.friendly_name,webauthn:{rpId:o,rpOrigins:c},signal:l},{create:n});case 6:if(v=e.v,y=v.data,m=v.error,y){e.n=7;break}return e.a(2,{data:null,error:m});case 7:return e.a(2,this._verify({factorId:f.id,challengeId:y.challengeId,webauthn:{rpId:o,rpOrigins:c,type:y.webauthn.type,credential_response:y.webauthn.credential_response}}));case 8:if(e.p=8,!wt(g=e.v)){e.n=9;break}return e.a(2,{data:null,error:g});case 9:return e.a(2,{data:null,error:new St("Unexpected error in register",g)})}},e,this,[[1,8]])})),function(t,n){return e.apply(this,arguments)})}]);var e,t,n,r,i}();!function(){if("object"!==("undefined"==typeof globalThis?"undefined":s(globalThis)))try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();var br={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:vt,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};function wr(e,t,n){return kr.apply(this,arguments)}function kr(){return(kr=f(d().m(function e(t,n,r){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,r();case 1:return e.a(2,e.v)}},e)}))).apply(this,arguments)}var _r={},Sr=function(){return y(function e(t){var n,r,i,a=this;g(this,e),this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;var s=Object.assign(Object.assign({},br),t);if(this.storageKey=s.storageKey,this.instanceID=null!==(n=e.nextInstanceID[this.storageKey])&&void 0!==n?n:0,e.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!s.debug,"function"==typeof s.debug&&(this.logger=s.debug),this.instanceID>0&&Vt()){"".concat(this._logPrefix()," Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");this.logDebugMessages}if(this.persistSession=s.persistSession,this.autoRefreshToken=s.autoRefreshToken,this.admin=new Wn({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=Xt(s.fetch),this.lock=s.lock||wr,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,this.throwOnError=s.throwOnError,this.lockAcquireTimeout=s.lockAcquireTimeout,s.lock?this.lock=s.lock:this.persistSession&&Vt()&&(null===(r=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===r?void 0:r.locks)?this.lock=Jn:this.lock=wr,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new gr(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:Yt()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Mn(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=Mn(this.memoryStorage)),Vt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){}null===(i=this.broadcastChannel)||void 0===i||i.addEventListener("message",function(){var e=f(d().m(function e(t){var n;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return a._debug("received broadcast notification from other tab or client",t),e.p=1,e.n=2,a._notifyAllSubscribers(t.data.event,t.data.session,!1);case 2:e.n=4;break;case 3:e.p=3,n=e.v,a._debug("#broadcastChannel","error",n);case 4:return e.a(2)}},e,null,[[1,3]])}));return function(t){return e.apply(this,arguments)}}())}this.initialize().catch(function(e){a._debug("#initialize()","error",e)})},[{key:"jwks",get:function(){var e,t;return null!==(t=null===(e=_r[this.storageKey])||void 0===e?void 0:e.jwks)&&void 0!==t?t:{keys:[]}},set:function(e){_r[this.storageKey]=Object.assign(Object.assign({},_r[this.storageKey]),{jwks:e})}},{key:"jwks_cached_at",get:function(){var e,t;return null!==(t=null===(e=_r[this.storageKey])||void 0===e?void 0:e.cachedAt)&&void 0!==t?t:Number.MIN_SAFE_INTEGER},set:function(e){_r[this.storageKey]=Object.assign(Object.assign({},_r[this.storageKey]),{cachedAt:e})}},{key:"isThrowOnErrorEnabled",value:function(){return this.throwOnError}},{key:"_returnResult",value:function(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}},{key:"_logPrefix",value:function(){return"GoTrueClient@"+"".concat(this.storageKey,":").concat(this.instanceID," (").concat(ft,") ").concat((new Date).toISOString())}},{key:"_debug",value:function(){if(this.logDebugMessages){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.apply(this,[this._logPrefix()].concat(t))}return this}},{key:"initialize",value:(Se=f(d().m(function e(){var t=this;return d().w(function(e){for(;;)switch(e.n){case 0:if(!this.initializePromise){e.n=2;break}return e.n=1,this.initializePromise;case 1:case 3:return e.a(2,e.v);case 2:return this.initializePromise=f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t._acquireLock(t.lockAcquireTimeout,f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t._initialize();case 1:return e.a(2,e.v)}},e)})));case 1:return e.a(2,e.v)}},e)}))(),e.n=3,this.initializePromise}},e,this)})),function(){return Se.apply(this,arguments)})},{key:"_initialize",value:(_e=f(d().m(function e(){var t,n,r,i,a,s,o,u,c,l,h=this;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,n={},r="none",!Vt()){e.n=3;break}if(n=$t(window.location.href),!this._isImplicitGrantCallback(n)){e.n=1;break}r="implicit",e.n=3;break;case 1:return e.n=2,this._isPKCECallback(n);case 2:if(!e.v){e.n=3;break}r="pkce";case 3:if(!Vt()||!this.detectSessionInUrl||"none"===r){e.n=8;break}return e.n=4,this._getSessionFromURL(n,r);case 4:if(i=e.v,a=i.data,!(s=i.error)){e.n=6;break}if(this._debug("#_initialize()","error detecting session from URL",s),!Pt(s)){e.n=5;break}if("identity_already_exists"!==(o=null===(t=s.details)||void 0===t?void 0:t.code)&&"identity_not_found"!==o&&"single_identity_not_deletable"!==o){e.n=5;break}return e.a(2,{error:s});case 5:return e.a(2,{error:s});case 6:return u=a.session,c=a.redirectType,this._debug("#_initialize()","detected session in URL",u,"redirect type",c),e.n=7,this._saveSession(u);case 7:return setTimeout(f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:if("recovery"!==c){e.n=2;break}return e.n=1,h._notifyAllSubscribers("PASSWORD_RECOVERY",u);case 1:e.n=3;break;case 2:return e.n=3,h._notifyAllSubscribers("SIGNED_IN",u);case 3:return e.a(2)}},e)})),0),e.a(2,{error:null});case 8:return e.n=9,this._recoverAndRefresh();case 9:return e.a(2,{error:null});case 10:if(e.p=10,!wt(l=e.v)){e.n=11;break}return e.a(2,this._returnResult({error:l}));case 11:return e.a(2,this._returnResult({error:new St("Unexpected error during initialization",l)}));case 12:return e.p=12,e.n=13,this._handleVisibilityChange();case 13:return this._debug("#_initialize()","end"),e.f(12);case 14:return e.a(2)}},e,this,[[0,10,12,14]])})),function(){return _e.apply(this,arguments)})},{key:"signInAnonymously",value:(ke=f(d().m(function e(t){var n,r,i,a,s,o,u,c,l;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Pn(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,body:{data:null!==(r=null===(n=null==t?void 0:t.options)||void 0===n?void 0:n.data)&&void 0!==r?r:{},gotrue_meta_security:{captcha_token:null===(i=null==t?void 0:t.options)||void 0===i?void 0:i.captchaToken}},xform:xn});case 1:if(a=e.v,s=a.data,!(o=a.error)&&s){e.n=2;break}return e.a(2,this._returnResult({data:{user:null,session:null},error:o}));case 2:if(u=s.session,c=s.user,!s.session){e.n=4;break}return e.n=3,this._saveSession(s.session);case 3:return e.n=4,this._notifyAllSubscribers("SIGNED_IN",u);case 4:return e.a(2,this._returnResult({data:{user:c,session:u},error:null}));case 5:if(e.p=5,!wt(l=e.v)){e.n=6;break}return e.a(2,this._returnResult({data:{user:null,session:null},error:l}));case 6:throw l;case 7:return e.a(2)}},e,this,[[0,5]])})),function(e){return ke.apply(this,arguments)})},{key:"signUp",value:(we=f(d().m(function e(t){var n,r,i,a,s,o,c,l,h,f,p,v,y,m,g,b,w,k,_,S;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!("email"in t)){e.n=4;break}if(s=t.email,o=t.password,c=t.options,l=null,h=null,"pkce"!==this.flowType){e.n=2;break}return e.n=1,pn(this.storage,this.storageKey);case 1:f=e.v,p=u(f,2),l=p[0],h=p[1];case 2:return e.n=3,Pn(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,redirectTo:null==c?void 0:c.emailRedirectTo,body:{email:s,password:o,data:null!==(n=null==c?void 0:c.data)&&void 0!==n?n:{},gotrue_meta_security:{captcha_token:null==c?void 0:c.captchaToken},code_challenge:l,code_challenge_method:h},xform:xn});case 3:a=e.v,e.n=7;break;case 4:if(!("phone"in t)){e.n=6;break}return v=t.phone,y=t.password,m=t.options,e.n=5,Pn(this.fetch,"POST","".concat(this.url,"/signup"),{headers:this.headers,body:{phone:v,password:y,data:null!==(r=null==m?void 0:m.data)&&void 0!==r?r:{},channel:null!==(i=null==m?void 0:m.channel)&&void 0!==i?i:"sms",gotrue_meta_security:{captcha_token:null==m?void 0:m.captchaToken}},xform:xn});case 5:a=e.v,e.n=7;break;case 6:throw new At("You must provide either an email or phone number and a password");case 7:if(b=(g=a).data,!(w=g.error)&&b){e.n=9;break}return e.n=8,tn(this.storage,"".concat(this.storageKey,"-code-verifier"));case 8:return e.a(2,this._returnResult({data:{user:null,session:null},error:w}));case 9:if(k=b.session,_=b.user,!b.session){e.n=11;break}return e.n=10,this._saveSession(b.session);case 10:return e.n=11,this._notifyAllSubscribers("SIGNED_IN",k);case 11:return e.a(2,this._returnResult({data:{user:_,session:k},error:null}));case 12:return e.p=12,S=e.v,e.n=13,tn(this.storage,"".concat(this.storageKey,"-code-verifier"));case 13:if(!wt(S)){e.n=14;break}return e.a(2,this._returnResult({data:{user:null,session:null},error:S}));case 14:throw S;case 15:return e.a(2)}},e,this,[[0,12]])})),function(e){return we.apply(this,arguments)})},{key:"signInWithPassword",value:(be=f(d().m(function e(t){var n,r,i,a,s,o,u,c,l,h,f,p;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!("email"in t)){e.n=2;break}return r=t.email,i=t.password,a=t.options,e.n=1,Pn(this.fetch,"POST","".concat(this.url,"/token?grant_type=password"),{headers:this.headers,body:{email:r,password:i,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},xform:Un});case 1:case 3:n=e.v,e.n=5;break;case 2:if(!("phone"in t)){e.n=4;break}return s=t.phone,o=t.password,u=t.options,e.n=3,Pn(this.fetch,"POST","".concat(this.url,"/token?grant_type=password"),{headers:this.headers,body:{phone:s,password:o,gotrue_meta_security:{captcha_token:null==u?void 0:u.captchaToken}},xform:Un});case 4:throw new At("You must provide either an email or phone number and a password");case 5:if(l=(c=n).data,!(h=c.error)){e.n=6;break}return e.a(2,this._returnResult({data:{user:null,session:null},error:h}));case 6:if(l&&l.session&&l.user){e.n=7;break}return f=new Rt,e.a(2,this._returnResult({data:{user:null,session:null},error:f}));case 7:if(!l.session){e.n=9;break}return e.n=8,this._saveSession(l.session);case 8:return e.n=9,this._notifyAllSubscribers("SIGNED_IN",l.session);case 9:return e.a(2,this._returnResult({data:Object.assign({user:l.user,session:l.session},l.weak_password?{weakPassword:l.weak_password}:null),error:h}));case 10:if(e.p=10,!wt(p=e.v)){e.n=11;break}return e.a(2,this._returnResult({data:{user:null,session:null},error:p}));case 11:throw p;case 12:return e.a(2)}},e,this,[[0,10]])})),function(e){return be.apply(this,arguments)})},{key:"signInWithOAuth",value:(ge=f(d().m(function e(t){var n,r,i,a;return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this._handleProviderSignIn(t.provider,{redirectTo:null===(n=t.options)||void 0===n?void 0:n.redirectTo,scopes:null===(r=t.options)||void 0===r?void 0:r.scopes,queryParams:null===(i=t.options)||void 0===i?void 0:i.queryParams,skipBrowserRedirect:null===(a=t.options)||void 0===a?void 0:a.skipBrowserRedirect});case 1:return e.a(2,e.v)}},e,this)})),function(e){return ge.apply(this,arguments)})},{key:"exchangeCodeForSession",value:(me=f(d().m(function e(t){var n=this;return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.initializePromise;case 1:return e.a(2,this._acquireLock(this.lockAcquireTimeout,f(d().m(function e(){return d().w(function(e){for(;;)if(0===e.n)return e.a(2,n._exchangeCodeForSession(t))},e)}))))}},e,this)})),function(e){return me.apply(this,arguments)})},{key:"signInWithWeb3",value:(ye=f(d().m(function e(t){var n,r;return d().w(function(e){for(;;)switch(e.n){case 0:n=t.chain,r=n,e.n="ethereum"===r?1:"solana"===r?3:5;break;case 1:return e.n=2,this.signInWithEthereum(t);case 2:case 4:return e.a(2,e.v);case 3:return e.n=4,this.signInWithSolana(t);case 5:throw new Error('@supabase/auth-js: Unsupported chain "'.concat(n,'"'));case 6:return e.a(2)}},e,this)})),function(e){return ye.apply(this,arguments)})},{key:"signInWithEthereum",value:(ve=f(d().m(function e(t){var n,r,i,a,o,u,c,l,h,f,p,v,y,m,g,b,w,k,_,S,T,E,O,R,A,j,P,I,C;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!("message"in t)){e.n=1;break}v=t.message,y=t.signature,e.n=12;break;case 1:if(t.chain,m=t.wallet,g=t.statement,b=t.options,Vt()){e.n=3;break}if("object"===s(m)&&(null==b?void 0:b.url)){e.n=2;break}throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");case 2:w=m,e.n=6;break;case 3:if("object"!==s(m)){e.n=4;break}w=m,e.n=6;break;case 4:if(!("ethereum"in(k=window))||"object"!==s(k.ethereum)||!("request"in k.ethereum)||"function"!=typeof k.ethereum.request){e.n=5;break}w=k.ethereum,e.n=6;break;case 5:throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.");case 6:return _=new URL(null!==(n=null==b?void 0:b.url)&&void 0!==n?n:window.location.href),e.n=7,w.request({method:"eth_requestAccounts"}).then(function(e){return e}).catch(function(){throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});case 7:if((S=e.v)&&0!==S.length){e.n=8;break}throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");case 8:if(T=zn(S[0]),E=null===(r=null==b?void 0:b.signInWithEthereum)||void 0===r?void 0:r.chainId){e.n=10;break}return e.n=9,w.request({method:"eth_chainId"});case 9:O=e.v,E=Yn(O);case 10:return R={domain:_.host,address:T,statement:g,uri:_.href,version:"1",chainId:E,nonce:null===(i=null==b?void 0:b.signInWithEthereum)||void 0===i?void 0:i.nonce,issuedAt:null!==(o=null===(a=null==b?void 0:b.signInWithEthereum)||void 0===a?void 0:a.issuedAt)&&void 0!==o?o:new Date,expirationTime:null===(u=null==b?void 0:b.signInWithEthereum)||void 0===u?void 0:u.expirationTime,notBefore:null===(c=null==b?void 0:b.signInWithEthereum)||void 0===c?void 0:c.notBefore,requestId:null===(l=null==b?void 0:b.signInWithEthereum)||void 0===l?void 0:l.requestId,resources:null===(h=null==b?void 0:b.signInWithEthereum)||void 0===h?void 0:h.resources},v=Xn(R),e.n=11,w.request({method:"personal_sign",params:[$n(v),T]});case 11:y=e.v;case 12:return e.p=12,e.n=13,Pn(this.fetch,"POST","".concat(this.url,"/token?grant_type=web3"),{headers:this.headers,body:Object.assign({chain:"ethereum",message:v,signature:y},(null===(f=t.options)||void 0===f?void 0:f.captchaToken)?{gotrue_meta_security:{captcha_token:null===(p=t.options)||void 0===p?void 0:p.captchaToken}}:null),xform:xn});case 13:if(A=e.v,j=A.data,!(P=A.error)){e.n=14;break}throw P;case 14:if(j&&j.session&&j.user){e.n=15;break}return I=new Rt,e.a(2,this._returnResult({data:{user:null,session:null},error:I}));case 15:if(!j.session){e.n=17;break}return e.n=16,this._saveSession(j.session);case 16:return e.n=17,this._notifyAllSubscribers("SIGNED_IN",j.session);case 17:return e.a(2,this._returnResult({data:Object.assign({},j),error:P}));case 18:if(e.p=18,!wt(C=e.v)){e.n=19;break}return e.a(2,this._returnResult({data:{user:null,session:null},error:C}));case 19:throw C;case 20:return e.a(2)}},e,this,[[12,18]])})),function(e){return ve.apply(this,arguments)})},{key:"signInWithSolana",value:(pe=f(d().m(function e(t){var n,r,i,a,u,c,l,h,f,p,v,y,m,g,b,w,k,_,S,T,E,O,R,A,j,P,I,C;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!("message"in t)){e.n=1;break}m=t.message,g=t.signature,e.n=17;break;case 1:if(t.chain,b=t.wallet,w=t.statement,k=t.options,Vt()){e.n=3;break}if("object"===s(b)&&(null==k?void 0:k.url)){e.n=2;break}throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");case 2:_=b,e.n=6;break;case 3:if("object"!==s(b)){e.n=4;break}_=b,e.n=6;break;case 4:if(!("solana"in(S=window))||"object"!==s(S.solana)||!("signIn"in S.solana&&"function"==typeof S.solana.signIn||"signMessage"in S.solana&&"function"==typeof S.solana.signMessage)){e.n=5;break}_=S.solana,e.n=6;break;case 5:throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");case 6:if(T=new URL(null!==(n=null==k?void 0:k.url)&&void 0!==n?n:window.location.href),!("signIn"in _)||!_.signIn){e.n=13;break}return e.n=7,_.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==k?void 0:k.signInWithSolana),{version:"1",domain:T.host,uri:T.href}),w?{statement:w}:null));case 7:if(E=e.v,!Array.isArray(E)||!E[0]||"object"!==s(E[0])){e.n=8;break}O=E[0],e.n=10;break;case 8:if(!(E&&"object"===s(E)&&"signedMessage"in E&&"signature"in E)){e.n=9;break}O=E,e.n=10;break;case 9:throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");case 10:if(!("signedMessage"in O&&"signature"in O&&("string"==typeof O.signedMessage||O.signedMessage instanceof Uint8Array)&&O.signature instanceof Uint8Array)){e.n=11;break}m="string"==typeof O.signedMessage?O.signedMessage:(new TextDecoder).decode(O.signedMessage),g=O.signature,e.n=12;break;case 11:throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");case 12:e.n=17;break;case 13:if("signMessage"in _&&"function"==typeof _.signMessage&&"publicKey"in _&&"object"===s(_)&&_.publicKey&&"toBase58"in _.publicKey&&"function"==typeof _.publicKey.toBase58){e.n=14;break}throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");case 14:return m=["".concat(T.host," wants you to sign in with your Solana account:"),_.publicKey.toBase58()].concat(o(w?["",w,""]:[""]),["Version: 1","URI: ".concat(T.href),"Issued At: ".concat(null!==(i=null===(r=null==k?void 0:k.signInWithSolana)||void 0===r?void 0:r.issuedAt)&&void 0!==i?i:(new Date).toISOString())],o((null===(a=null==k?void 0:k.signInWithSolana)||void 0===a?void 0:a.notBefore)?["Not Before: ".concat(k.signInWithSolana.notBefore)]:[]),o((null===(u=null==k?void 0:k.signInWithSolana)||void 0===u?void 0:u.expirationTime)?["Expiration Time: ".concat(k.signInWithSolana.expirationTime)]:[]),o((null===(c=null==k?void 0:k.signInWithSolana)||void 0===c?void 0:c.chainId)?["Chain ID: ".concat(k.signInWithSolana.chainId)]:[]),o((null===(l=null==k?void 0:k.signInWithSolana)||void 0===l?void 0:l.nonce)?["Nonce: ".concat(k.signInWithSolana.nonce)]:[]),o((null===(h=null==k?void 0:k.signInWithSolana)||void 0===h?void 0:h.requestId)?["Request ID: ".concat(k.signInWithSolana.requestId)]:[]),o((null===(p=null===(f=null==k?void 0:k.signInWithSolana)||void 0===f?void 0:f.resources)||void 0===p?void 0:p.length)?["Resources"].concat(o(k.signInWithSolana.resources.map(function(e){return"- ".concat(e)}))):[])).join("\n"),e.n=15,_.signMessage((new TextEncoder).encode(m),"utf8");case 15:if((R=e.v)&&R instanceof Uint8Array){e.n=16;break}throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");case 16:g=R;case 17:return e.p=17,e.n=18,Pn(this.fetch,"POST","".concat(this.url,"/token?grant_type=web3"),{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:Jt(g)},(null===(v=t.options)||void 0===v?void 0:v.captchaToken)?{gotrue_meta_security:{captcha_token:null===(y=t.options)||void 0===y?void 0:y.captchaToken}}:null),xform:xn});case 18:if(A=e.v,j=A.data,!(P=A.error)){e.n=19;break}throw P;case 19:if(j&&j.session&&j.user){e.n=20;break}return I=new Rt,e.a(2,this._returnResult({data:{user:null,session:null},error:I}));case 20:if(!j.session){e.n=22;break}return e.n=21,this._saveSession(j.session);case 21:return e.n=22,this._notifyAllSubscribers("SIGNED_IN",j.session);case 22:return e.a(2,this._returnResult({data:Object.assign({},j),error:P}));case 23:if(e.p=23,!wt(C=e.v)){e.n=24;break}return e.a(2,this._returnResult({data:{user:null,session:null},error:C}));case 24:throw C;case 25:return e.a(2)}},e,this,[[17,23]])})),function(e){return pe.apply(this,arguments)})},{key:"_exchangeCodeForSession",value:(de=f(d().m(function e(t){var n,r,i,a,s,o,c,l,h,f;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.n=1,en(this.storage,"".concat(this.storageKey,"-code-verifier"));case 1:if(n=e.v,r=(null!=n?n:"").split("/"),i=u(r,2),a=i[0],s=i[1],e.p=2,a||"pkce"!==this.flowType){e.n=3;break}throw new Ct;case 3:return e.n=4,Pn(this.fetch,"POST","".concat(this.url,"/token?grant_type=pkce"),{headers:this.headers,body:{auth_code:t,code_verifier:a},xform:xn});case 4:return o=e.v,c=o.data,l=o.error,e.n=5,tn(this.storage,"".concat(this.storageKey,"-code-verifier"));case 5:if(!l){e.n=6;break}throw l;case 6:if(c&&c.session&&c.user){e.n=7;break}return h=new Rt,e.a(2,this._returnResult({data:{user:null,session:null,redirectType:null},error:h}));case 7:if(!c.session){e.n=9;break}return e.n=8,this._saveSession(c.session);case 8:return e.n=9,this._notifyAllSubscribers("SIGNED_IN",c.session);case 9:return e.a(2,this._returnResult({data:Object.assign(Object.assign({},c),{redirectType:null!=s?s:null}),error:l}));case 10:return e.p=10,f=e.v,e.n=11,tn(this.storage,"".concat(this.storageKey,"-code-verifier"));case 11:if(!wt(f)){e.n=12;break}return e.a(2,this._returnResult({data:{user:null,session:null,redirectType:null},error:f}));case 12:throw f;case 13:return e.a(2)}},e,this,[[2,10]])})),function(e){return de.apply(this,arguments)})},{key:"signInWithIdToken",value:(fe=f(d().m(function e(t){var n,r,i,a,s,o,u,c,l,h;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,n=t.options,r=t.provider,i=t.token,a=t.access_token,s=t.nonce,e.n=1,Pn(this.fetch,"POST","".concat(this.url,"/token?grant_type=id_token"),{headers:this.headers,body:{provider:r,id_token:i,access_token:a,nonce:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:xn});case 1:if(o=e.v,u=o.data,!(c=o.error)){e.n=2;break}return e.a(2,this._returnResult({data:{user:null,session:null},error:c}));case 2:if(u&&u.session&&u.user){e.n=3;break}return l=new Rt,e.a(2,this._returnResult({data:{user:null,session:null},error:l}));case 3:if(!u.session){e.n=5;break}return e.n=4,this._saveSession(u.session);case 4:return e.n=5,this._notifyAllSubscribers("SIGNED_IN",u.session);case 5:return e.a(2,this._returnResult({data:u,error:c}));case 6:if(e.p=6,!wt(h=e.v)){e.n=7;break}return e.a(2,this._returnResult({data:{user:null,session:null},error:h}));case 7:throw h;case 8:return e.a(2)}},e,this,[[0,6]])})),function(e){return fe.apply(this,arguments)})},{key:"signInWithOtp",value:(he=f(d().m(function e(t){var n,r,i,a,s,o,c,l,h,f,p,v,y,m,g,b,w,k,_;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!("email"in t)){e.n=4;break}if(o=t.email,c=t.options,l=null,h=null,"pkce"!==this.flowType){e.n=2;break}return e.n=1,pn(this.storage,this.storageKey);case 1:f=e.v,p=u(f,2),l=p[0],h=p[1];case 2:return e.n=3,Pn(this.fetch,"POST","".concat(this.url,"/otp"),{headers:this.headers,body:{email:o,data:null!==(n=null==c?void 0:c.data)&&void 0!==n?n:{},create_user:null===(r=null==c?void 0:c.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null==c?void 0:c.captchaToken},code_challenge:l,code_challenge_method:h},redirectTo:null==c?void 0:c.emailRedirectTo});case 3:return v=e.v,y=v.error,e.a(2,this._returnResult({data:{user:null,session:null},error:y}));case 4:if(!("phone"in t)){e.n=6;break}return m=t.phone,g=t.options,e.n=5,Pn(this.fetch,"POST","".concat(this.url,"/otp"),{headers:this.headers,body:{phone:m,data:null!==(i=null==g?void 0:g.data)&&void 0!==i?i:{},create_user:null===(a=null==g?void 0:g.shouldCreateUser)||void 0===a||a,gotrue_meta_security:{captcha_token:null==g?void 0:g.captchaToken},channel:null!==(s=null==g?void 0:g.channel)&&void 0!==s?s:"sms"}});case 5:return b=e.v,w=b.data,k=b.error,e.a(2,this._returnResult({data:{user:null,session:null,messageId:null==w?void 0:w.message_id},error:k}));case 6:throw new At("You must provide either an email or phone number.");case 7:return e.p=7,_=e.v,e.n=8,tn(this.storage,"".concat(this.storageKey,"-code-verifier"));case 8:if(!wt(_)){e.n=9;break}return e.a(2,this._returnResult({data:{user:null,session:null},error:_}));case 9:throw _;case 10:return e.a(2)}},e,this,[[0,7]])})),function(e){return he.apply(this,arguments)})},{key:"verifyOtp",value:(le=f(d().m(function e(t){var n,r,i,a,s,o,u,c,l,h;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,i=void 0,a=void 0,"options"in t&&(i=null===(n=t.options)||void 0===n?void 0:n.redirectTo,a=null===(r=t.options)||void 0===r?void 0:r.captchaToken),e.n=1,Pn(this.fetch,"POST","".concat(this.url,"/verify"),{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:a}}),redirectTo:i,xform:xn});case 1:if(s=e.v,o=s.data,!(u=s.error)){e.n=2;break}throw u;case 2:if(o){e.n=3;break}throw new Error("An error occurred on token verification.");case 3:if(c=o.session,l=o.user,!(null==c?void 0:c.access_token)){e.n=5;break}return e.n=4,this._saveSession(c);case 4:return e.n=5,this._notifyAllSubscribers("recovery"==t.type?"PASSWORD_RECOVERY":"SIGNED_IN",c);case 5:return e.a(2,this._returnResult({data:{user:l,session:c},error:null}));case 6:if(e.p=6,!wt(h=e.v)){e.n=7;break}return e.a(2,this._returnResult({data:{user:null,session:null},error:h}));case 7:throw h;case 8:return e.a(2)}},e,this,[[0,6]])})),function(e){return le.apply(this,arguments)})},{key:"signInWithSSO",value:(ce=f(d().m(function e(t){var n,r,i,a,s,o,c,l,h,f,p;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,o=null,c=null,"pkce"!==this.flowType){e.n=2;break}return e.n=1,pn(this.storage,this.storageKey);case 1:l=e.v,h=u(l,2),o=h[0],c=h[1];case 2:return e.n=3,Pn(this.fetch,"POST","".concat(this.url,"/sso"),{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:null!==(r=null===(n=t.options)||void 0===n?void 0:n.redirectTo)&&void 0!==r?r:void 0}),(null===(i=null==t?void 0:t.options)||void 0===i?void 0:i.captchaToken)?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:c}),headers:this.headers,xform:Dn});case 3:return f=e.v,(null===(a=f.data)||void 0===a?void 0:a.url)&&Vt()&&!(null===(s=t.options)||void 0===s?void 0:s.skipBrowserRedirect)&&window.location.assign(f.data.url),e.a(2,this._returnResult(f));case 4:return e.p=4,p=e.v,e.n=5,tn(this.storage,"".concat(this.storageKey,"-code-verifier"));case 5:if(!wt(p)){e.n=6;break}return e.a(2,this._returnResult({data:null,error:p}));case 6:throw p;case 7:return e.a(2)}},e,this,[[0,4]])})),function(e){return ce.apply(this,arguments)})},{key:"reauthenticate",value:(ue=f(d().m(function e(){var t=this;return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.initializePromise;case 1:return e.n=2,this._acquireLock(this.lockAcquireTimeout,f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t._reauthenticate();case 1:return e.a(2,e.v)}},e)})));case 2:return e.a(2,e.v)}},e,this)})),function(){return ue.apply(this,arguments)})},{key:"_reauthenticate",value:(oe=f(d().m(function e(){var t,n=this;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this._useSession(function(){var e=f(d().m(function e(t){var r,i,a,s;return d().w(function(e){for(;;)switch(e.n){case 0:if(r=t.data.session,!(i=t.error)){e.n=1;break}throw i;case 1:if(r){e.n=2;break}throw new Et;case 2:return e.n=3,Pn(n.fetch,"GET","".concat(n.url,"/reauthenticate"),{headers:n.headers,jwt:r.access_token});case 3:return a=e.v,s=a.error,e.a(2,n._returnResult({data:{user:null,session:null},error:s}))}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2,e.v);case 2:if(e.p=2,!wt(t=e.v)){e.n=3;break}return e.a(2,this._returnResult({data:{user:null,session:null},error:t}));case 3:throw t;case 4:return e.a(2)}},e,this,[[0,2]])})),function(){return oe.apply(this,arguments)})},{key:"resend",value:(se=f(d().m(function e(t){var n,r,i,a,s,o,u,c,l,h,f,p,v;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,n="".concat(this.url,"/resend"),!("email"in t)){e.n=2;break}return r=t.email,i=t.type,a=t.options,e.n=1,Pn(this.fetch,"POST",n,{headers:this.headers,body:{email:r,type:i,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},redirectTo:null==a?void 0:a.emailRedirectTo});case 1:return s=e.v,o=s.error,e.a(2,this._returnResult({data:{user:null,session:null},error:o}));case 2:if(!("phone"in t)){e.n=4;break}return u=t.phone,c=t.type,l=t.options,e.n=3,Pn(this.fetch,"POST",n,{headers:this.headers,body:{phone:u,type:c,gotrue_meta_security:{captcha_token:null==l?void 0:l.captchaToken}}});case 3:return h=e.v,f=h.data,p=h.error,e.a(2,this._returnResult({data:{user:null,session:null,messageId:null==f?void 0:f.message_id},error:p}));case 4:throw new At("You must provide either an email or phone number and a type");case 5:if(e.p=5,!wt(v=e.v)){e.n=6;break}return e.a(2,this._returnResult({data:{user:null,session:null},error:v}));case 6:throw v;case 7:return e.a(2)}},e,this,[[0,5]])})),function(e){return se.apply(this,arguments)})},{key:"getSession",value:(ae=f(d().m(function e(){var t,n=this;return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.initializePromise;case 1:return e.n=2,this._acquireLock(this.lockAcquireTimeout,f(d().m(function e(){return d().w(function(e){for(;;)if(0===e.n)return e.a(2,n._useSession(function(){var e=f(d().m(function e(t){return d().w(function(e){for(;;)if(0===e.n)return e.a(2,t)},e)}));return function(t){return e.apply(this,arguments)}}()))},e)})));case 2:return t=e.v,e.a(2,t)}},e,this)})),function(){return ae.apply(this,arguments)})},{key:"_acquireLock",value:(ie=f(d().m(function e(t,n){var r,i,a=this;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this._debug("#_acquireLock","begin",t),e.p=1,!this.lockAcquired){e.n=2;break}return r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,r;case 1:return e.n=2,n();case 2:return e.a(2,e.v)}},e)}))(),this.pendingInLock.push(f(d().m(function e(){return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,i;case 1:e.n=3;break;case 2:e.p=2,e.v;case 3:return e.a(2)}},e,null,[[0,2]])}))()),e.a(2,i);case 2:return e.n=3,this.lock("lock:".concat(this.storageKey),t,f(d().m(function e(){var t,r;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return a._debug("#_acquireLock","lock acquired for storage key",a.storageKey),e.p=1,a.lockAcquired=!0,t=n(),a.pendingInLock.push(f(d().m(function e(){return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,t;case 1:e.n=3;break;case 2:e.p=2,e.v;case 3:return e.a(2)}},e,null,[[0,2]])}))()),e.n=2,t;case 2:if(!a.pendingInLock.length){e.n=4;break}return r=o(a.pendingInLock),e.n=3,Promise.all(r);case 3:a.pendingInLock.splice(0,r.length),e.n=2;break;case 4:return e.n=5,t;case 5:return e.a(2,e.v);case 6:return e.p=6,a._debug("#_acquireLock","lock released for storage key",a.storageKey),a.lockAcquired=!1,e.f(6);case 7:return e.a(2)}},e,null,[[1,,6,7]])})));case 3:return e.a(2,e.v);case 4:return e.p=4,this._debug("#_acquireLock","end"),e.f(4);case 5:return e.a(2)}},e,this,[[1,,4,5]])})),function(e,t){return ie.apply(this,arguments)})},{key:"_useSession",value:(re=f(d().m(function e(t){var n;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return this._debug("#_useSession","begin"),e.p=1,e.n=2,this.__loadSession();case 2:return n=e.v,e.n=3,t(n);case 3:return e.a(2,e.v);case 4:return e.p=4,this._debug("#_useSession","end"),e.f(4);case 5:return e.a(2)}},e,this,[[1,,4,5]])})),function(e){return re.apply(this,arguments)})},{key:"__loadSession",value:(ne=f(d().m(function e(){var t,n,r,i,a,s,o,u;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack),e.p=1,t=null,e.n=2,en(this.storage,this.storageKey);case 2:if(n=e.v,this._debug("#getSession()","session from storage",n),null===n){e.n=4;break}if(!this._isValidSession(n)){e.n=3;break}t=n,e.n=4;break;case 3:return this._debug("#getSession()","session from storage is not valid"),e.n=4,this._removeSession();case 4:if(t){e.n=5;break}return e.a(2,{data:{session:null},error:null});case 5:if(r=!!t.expires_at&&1e3*t.expires_at-Date.now()<pt,this._debug("#__loadSession()","session has".concat(r?"":" not"," expired"),"expires_at",t.expires_at),r){e.n=8;break}if(!this.userStorage){e.n=7;break}return e.n=6,en(this.userStorage,this.storageKey+"-user");case 6:(null==(i=e.v)?void 0:i.user)?t.user=i.user:t.user=_n();case 7:return this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy&&(a={value:this.suppressGetSessionWarning},t.user=Sn(t.user,a),a.value&&(this.suppressGetSessionWarning=!0)),e.a(2,{data:{session:t},error:null});case 8:return e.n=9,this._callRefreshToken(t.refresh_token);case 9:if(s=e.v,o=s.data,!(u=s.error)){e.n=10;break}return e.a(2,this._returnResult({data:{session:null},error:u}));case 10:return e.a(2,this._returnResult({data:{session:o},error:null}));case 11:return e.p=11,this._debug("#__loadSession()","end"),e.f(11);case 12:return e.a(2)}},e,this,[[1,,11,12]])})),function(){return ne.apply(this,arguments)})},{key:"getUser",value:(te=f(d().m(function e(t){var n,r=this;return d().w(function(e){for(;;)switch(e.n){case 0:if(!t){e.n=2;break}return e.n=1,this._getUser(t);case 1:return e.a(2,e.v);case 2:return e.n=3,this.initializePromise;case 3:return e.n=4,this._acquireLock(this.lockAcquireTimeout,f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,r._getUser();case 1:return e.a(2,e.v)}},e)})));case 4:return(n=e.v).data.user&&(this.suppressGetSessionWarning=!0),e.a(2,n)}},e,this)})),function(e){return te.apply(this,arguments)})},{key:"_getUser",value:(ee=f(d().m(function e(t){var n,r=this;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!t){e.n=2;break}return e.n=1,Pn(this.fetch,"GET","".concat(this.url,"/user"),{headers:this.headers,jwt:t,xform:Ln});case 1:case 3:return e.a(2,e.v);case 2:return e.n=3,this._useSession(function(){var e=f(d().m(function e(t){var n,i,a,s,o;return d().w(function(e){for(;;)switch(e.n){case 0:if(s=t.data,!(o=t.error)){e.n=1;break}throw o;case 1:if((null===(n=s.session)||void 0===n?void 0:n.access_token)||r.hasCustomAuthorizationHeader){e.n=2;break}return e.a(2,{data:{user:null},error:new Et});case 2:return e.n=3,Pn(r.fetch,"GET","".concat(r.url,"/user"),{headers:r.headers,jwt:null!==(a=null===(i=s.session)||void 0===i?void 0:i.access_token)&&void 0!==a?a:void 0,xform:Ln});case 3:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}());case 4:if(e.p=4,!wt(n=e.v)){e.n=7;break}if(!Ot(n)){e.n=6;break}return e.n=5,this._removeSession();case 5:return e.n=6,tn(this.storage,"".concat(this.storageKey,"-code-verifier"));case 6:return e.a(2,this._returnResult({data:{user:null},error:n}));case 7:throw n;case 8:return e.a(2)}},e,this,[[0,4]])})),function(e){return ee.apply(this,arguments)})},{key:"updateUser",value:(Z=f(d().m(function e(t){var n,r=this,i=arguments;return d().w(function(e){for(;;)switch(e.n){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:{},e.n=1,this.initializePromise;case 1:return e.n=2,this._acquireLock(this.lockAcquireTimeout,f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,r._updateUser(t,n);case 1:return e.a(2,e.v)}},e)})));case 2:return e.a(2,e.v)}},e,this)})),function(e){return Z.apply(this,arguments)})},{key:"_updateUser",value:(Q=f(d().m(function e(t){var n,r,i=this,a=arguments;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:{},e.p=1,e.n=2,this._useSession(function(){var e=f(d().m(function e(r){var a,s,o,c,l,h,f,p,v,y;return d().w(function(e){for(;;)switch(e.n){case 0:if(a=r.data,!(s=r.error)){e.n=1;break}throw s;case 1:if(a.session){e.n=2;break}throw new Et;case 2:if(o=a.session,c=null,l=null,"pkce"!==i.flowType||null==t.email){e.n=4;break}return e.n=3,pn(i.storage,i.storageKey);case 3:h=e.v,f=u(h,2),c=f[0],l=f[1];case 4:return e.n=5,Pn(i.fetch,"PUT","".concat(i.url,"/user"),{headers:i.headers,redirectTo:null==n?void 0:n.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:c,code_challenge_method:l}),jwt:o.access_token,xform:Ln});case 5:if(p=e.v,v=p.data,!(y=p.error)){e.n=6;break}throw y;case 6:return o.user=v.user,e.n=7,i._saveSession(o);case 7:return e.n=8,i._notifyAllSubscribers("USER_UPDATED",o);case 8:return e.a(2,i._returnResult({data:{user:o.user},error:null}))}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:return e.a(2,e.v);case 3:return e.p=3,r=e.v,e.n=4,tn(this.storage,"".concat(this.storageKey,"-code-verifier"));case 4:if(!wt(r)){e.n=5;break}return e.a(2,this._returnResult({data:{user:null},error:r}));case 5:throw r;case 6:return e.a(2)}},e,this,[[1,3]])})),function(e){return Q.apply(this,arguments)})},{key:"setSession",value:(X=f(d().m(function e(t){var n=this;return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.initializePromise;case 1:return e.n=2,this._acquireLock(this.lockAcquireTimeout,f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,n._setSession(t);case 1:return e.a(2,e.v)}},e)})));case 2:return e.a(2,e.v)}},e,this)})),function(e){return X.apply(this,arguments)})},{key:"_setSession",value:($=f(d().m(function e(t){var n,r,i,a,s,o,u,c,l,h,f,p,v;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,t.access_token&&t.refresh_token){e.n=1;break}throw new Et;case 1:if(n=Date.now()/1e3,r=n,i=!0,a=null,s=rn(t.access_token),(o=s.payload).exp&&(r=o.exp,i=r<=n),!i){e.n=5;break}return e.n=2,this._callRefreshToken(t.refresh_token);case 2:if(u=e.v,c=u.data,!(l=u.error)){e.n=3;break}return e.a(2,this._returnResult({data:{user:null,session:null},error:l}));case 3:if(c){e.n=4;break}return e.a(2,{data:{user:null,session:null},error:null});case 4:a=c,e.n=9;break;case 5:return e.n=6,this._getUser(t.access_token);case 6:if(h=e.v,f=h.data,!(p=h.error)){e.n=7;break}return e.a(2,this._returnResult({data:{user:null,session:null},error:p}));case 7:return a={access_token:t.access_token,refresh_token:t.refresh_token,user:f.user,token_type:"bearer",expires_in:r-n,expires_at:r},e.n=8,this._saveSession(a);case 8:return e.n=9,this._notifyAllSubscribers("SIGNED_IN",a);case 9:return e.a(2,this._returnResult({data:{user:a.user,session:a},error:null}));case 10:if(e.p=10,!wt(v=e.v)){e.n=11;break}return e.a(2,this._returnResult({data:{session:null,user:null},error:v}));case 11:throw v;case 12:return e.a(2)}},e,this,[[0,10]])})),function(e){return $.apply(this,arguments)})},{key:"refreshSession",value:(Y=f(d().m(function e(t){var n=this;return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.initializePromise;case 1:return e.n=2,this._acquireLock(this.lockAcquireTimeout,f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,n._refreshSession(t);case 1:return e.a(2,e.v)}},e)})));case 2:return e.a(2,e.v)}},e,this)})),function(e){return Y.apply(this,arguments)})},{key:"_refreshSession",value:(z=f(d().m(function e(t){var n,r=this;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this._useSession(function(){var e=f(d().m(function e(n){var i,a,s,o,u,c;return d().w(function(e){for(;;)switch(e.n){case 0:if(t){e.n=2;break}if(a=n.data,!(s=n.error)){e.n=1;break}throw s;case 1:t=null!==(i=a.session)&&void 0!==i?i:void 0;case 2:if(null==t?void 0:t.refresh_token){e.n=3;break}throw new Et;case 3:return e.n=4,r._callRefreshToken(t.refresh_token);case 4:if(o=e.v,u=o.data,!(c=o.error)){e.n=5;break}return e.a(2,r._returnResult({data:{user:null,session:null},error:c}));case 5:if(u){e.n=6;break}return e.a(2,r._returnResult({data:{user:null,session:null},error:null}));case 6:return e.a(2,r._returnResult({data:{user:u.user,session:u},error:null}))}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2,e.v);case 2:if(e.p=2,!wt(n=e.v)){e.n=3;break}return e.a(2,this._returnResult({data:{user:null,session:null},error:n}));case 3:throw n;case 4:return e.a(2)}},e,this,[[0,2]])})),function(e){return z.apply(this,arguments)})},{key:"_getSessionFromURL",value:(V=f(d().m(function e(t,n){var r,i,a,s,o,u,c,l,h,f,p,v,y,m,g,b,w,k,_,S;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,Vt()){e.n=1;break}throw new jt("No browser detected.");case 1:if(!(t.error||t.error_description||t.error_code)){e.n=2;break}throw new jt(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});case 2:_=n,e.n="implicit"===_?3:"pkce"===_?5:7;break;case 3:if("pkce"!==this.flowType){e.n=4;break}throw new It("Not a valid PKCE flow url.");case 4:case 6:return e.a(3,7);case 5:if("implicit"!==this.flowType){e.n=6;break}throw new jt("Not a valid implicit grant flow url.");case 7:if("pkce"!==n){e.n=11;break}if(this._debug("#_initialize()","begin","is PKCE flow",!0),t.code){e.n=8;break}throw new It("No code detected.");case 8:return e.n=9,this._exchangeCodeForSession(t.code);case 9:if(r=e.v,i=r.data,!(a=r.error)){e.n=10;break}throw a;case 10:return(s=new URL(window.location.href)).searchParams.delete("code"),window.history.replaceState(window.history.state,"",s.toString()),e.a(2,{data:{session:i.session,redirectType:null},error:null});case 11:if(o=t.provider_token,u=t.provider_refresh_token,c=t.access_token,l=t.refresh_token,h=t.expires_in,f=t.expires_at,p=t.token_type,c&&h&&l&&p){e.n=12;break}throw new jt("No session defined in URL");case 12:return v=Math.round(Date.now()/1e3),y=parseInt(h),m=v+y,f&&(m=parseInt(f)),e.n=13,this._getUser(c);case 13:if(g=e.v,b=g.data,!(w=g.error)){e.n=14;break}throw w;case 14:return k={provider_token:o,provider_refresh_token:u,access_token:c,expires_in:y,expires_at:m,refresh_token:l,token_type:p,user:b.user},window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),e.a(2,this._returnResult({data:{session:k,redirectType:t.type},error:null}));case 15:if(e.p=15,!wt(S=e.v)){e.n=16;break}return e.a(2,this._returnResult({data:{session:null,redirectType:null},error:S}));case 16:throw S;case 17:return e.a(2)}},e,this,[[0,15]])})),function(e,t){return V.apply(this,arguments)})},{key:"_isImplicitGrantCallback",value:function(e){return"function"==typeof this.detectSessionInUrl?this.detectSessionInUrl(new URL(window.location.href),e):Boolean(e.access_token||e.error_description)}},{key:"_isPKCECallback",value:(J=f(d().m(function e(t){var n;return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,en(this.storage,"".concat(this.storageKey,"-code-verifier"));case 1:return n=e.v,e.a(2,!(!t.code||!n))}},e,this)})),function(e){return J.apply(this,arguments)})},{key:"signOut",value:(H=f(d().m(function e(){var t,n=this,r=arguments;return d().w(function(e){for(;;)switch(e.n){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{scope:"global"},e.n=1,this.initializePromise;case 1:return e.n=2,this._acquireLock(this.lockAcquireTimeout,f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,n._signOut(t);case 1:return e.a(2,e.v)}},e)})));case 2:return e.a(2,e.v)}},e,this)})),function(){return H.apply(this,arguments)})},{key:"_signOut",value:(G=f(d().m(function e(){var t,n=this,r=arguments;return d().w(function(e){for(;;)switch(e.n){case 0:return t=(r.length>0&&void 0!==r[0]?r[0]:{scope:"global"}).scope,e.n=1,this._useSession(function(){var e=f(d().m(function e(r){var i,a,s,o,u,c;return d().w(function(e){for(;;)switch(e.n){case 0:if(a=r.data,!(s=r.error)||Ot(s)){e.n=1;break}return e.a(2,n._returnResult({error:s}));case 1:if(!(o=null===(i=a.session)||void 0===i?void 0:i.access_token)){e.n=3;break}return e.n=2,n.admin.signOut(o,t);case 2:if(u=e.v,!(c=u.error)){e.n=3;break}if(_t(c)&&(404===c.status||401===c.status||403===c.status)||Ot(c)){e.n=3;break}return e.a(2,n._returnResult({error:c}));case 3:if("others"===t){e.n=5;break}return e.n=4,n._removeSession();case 4:return e.n=5,tn(n.storage,"".concat(n.storageKey,"-code-verifier"));case 5:return e.a(2,n._returnResult({error:null}))}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2,e.v)}},e,this)})),function(){return G.apply(this,arguments)})},{key:"onAuthStateChange",value:function(e){var t=this,n=Symbol("auth-callback"),r={id:n,callback:e,unsubscribe:function(){t._debug("#unsubscribe()","state change callback with id removed",n),t.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,r),f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t.initializePromise;case 1:return e.n=2,t._acquireLock(t.lockAcquireTimeout,f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:t._emitInitialSession(n);case 1:return e.a(2)}},e)})));case 2:return e.a(2)}},e)}))(),{data:{subscription:r}}}},{key:"_emitInitialSession",value:(F=f(d().m(function e(t){var n=this;return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this._useSession(function(){var e=f(d().m(function e(r){var i,a,s,o,u;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,s=r.data.session,!(o=r.error)){e.n=1;break}throw o;case 1:return e.n=2,null===(i=n.stateChangeEmitters.get(t))||void 0===i?void 0:i.callback("INITIAL_SESSION",s);case 2:n._debug("INITIAL_SESSION","callback id",t,"session",s),e.n=5;break;case 3:return e.p=3,u=e.v,e.n=4,null===(a=n.stateChangeEmitters.get(t))||void 0===a?void 0:a.callback("INITIAL_SESSION",null);case 4:n._debug("INITIAL_SESSION","callback id",t,"error",u);case 5:return e.a(2)}},e,null,[[0,3]])}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2,e.v)}},e,this)})),function(e){return F.apply(this,arguments)})},{key:"resetPasswordForEmail",value:(M=f(d().m(function e(t){var n,r,i,a,s,o,c=arguments;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=c.length>1&&void 0!==c[1]?c[1]:{},r=null,i=null,"pkce"!==this.flowType){e.n=2;break}return e.n=1,pn(this.storage,this.storageKey,!0);case 1:a=e.v,s=u(a,2),r=s[0],i=s[1];case 2:return e.p=2,e.n=3,Pn(this.fetch,"POST","".concat(this.url,"/recover"),{body:{email:t,code_challenge:r,code_challenge_method:i,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo});case 3:return e.a(2,e.v);case 4:return e.p=4,o=e.v,e.n=5,tn(this.storage,"".concat(this.storageKey,"-code-verifier"));case 5:if(!wt(o)){e.n=6;break}return e.a(2,this._returnResult({data:null,error:o}));case 6:throw o;case 7:return e.a(2)}},e,this,[[2,4]])})),function(e){return M.apply(this,arguments)})},{key:"getUserIdentities",value:(W=f(d().m(function e(){var t,n,r,i,a;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this.getUser();case 1:if(n=e.v,r=n.data,!(i=n.error)){e.n=2;break}throw i;case 2:return e.a(2,this._returnResult({data:{identities:null!==(t=r.user.identities)&&void 0!==t?t:[]},error:null}));case 3:if(e.p=3,!wt(a=e.v)){e.n=4;break}return e.a(2,this._returnResult({data:null,error:a}));case 4:throw a;case 5:return e.a(2)}},e,this,[[0,3]])})),function(){return W.apply(this,arguments)})},{key:"linkIdentity",value:(K=f(d().m(function e(t){return d().w(function(e){for(;;)switch(e.n){case 0:if(!("token"in t)){e.n=1;break}return e.a(2,this.linkIdentityIdToken(t));case 1:return e.a(2,this.linkIdentityOAuth(t))}},e,this)})),function(e){return K.apply(this,arguments)})},{key:"linkIdentityOAuth",value:(q=f(d().m(function e(t){var n,r,i,a,s,o=this;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this._useSession(function(){var e=f(d().m(function e(n){var r,i,a,s,u,c,l,h;return d().w(function(e){for(;;)switch(e.n){case 0:if(c=n.data,!(l=n.error)){e.n=1;break}throw l;case 1:return e.n=2,o._getUrlForProvider("".concat(o.url,"/user/identities/authorize"),t.provider,{redirectTo:null===(r=t.options)||void 0===r?void 0:r.redirectTo,scopes:null===(i=t.options)||void 0===i?void 0:i.scopes,queryParams:null===(a=t.options)||void 0===a?void 0:a.queryParams,skipBrowserRedirect:!0});case 2:return h=e.v,e.n=3,Pn(o.fetch,"GET",h,{headers:o.headers,jwt:null!==(u=null===(s=c.session)||void 0===s?void 0:s.access_token)&&void 0!==u?u:void 0});case 3:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:if(r=e.v,i=r.data,!(a=r.error)){e.n=2;break}throw a;case 2:return Vt()&&!(null===(n=t.options)||void 0===n?void 0:n.skipBrowserRedirect)&&window.location.assign(null==i?void 0:i.url),e.a(2,this._returnResult({data:{provider:t.provider,url:null==i?void 0:i.url},error:null}));case 3:if(e.p=3,!wt(s=e.v)){e.n=4;break}return e.a(2,this._returnResult({data:{provider:t.provider,url:null},error:s}));case 4:throw s;case 5:return e.a(2)}},e,this,[[0,3]])})),function(e){return q.apply(this,arguments)})},{key:"linkIdentityIdToken",value:(B=f(d().m(function e(t){var n=this;return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this._useSession(function(){var e=f(d().m(function e(r){var i,a,s,o,u,c,l,h,f,p,v,y;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,a=r.error,s=r.data.session,!a){e.n=1;break}throw a;case 1:return o=t.options,u=t.provider,c=t.token,l=t.access_token,h=t.nonce,e.n=2,Pn(n.fetch,"POST","".concat(n.url,"/token?grant_type=id_token"),{headers:n.headers,jwt:null!==(i=null==s?void 0:s.access_token)&&void 0!==i?i:void 0,body:{provider:u,id_token:c,access_token:l,nonce:h,link_identity:!0,gotrue_meta_security:{captcha_token:null==o?void 0:o.captchaToken}},xform:xn});case 2:if(f=e.v,p=f.data,!(v=f.error)){e.n=3;break}return e.a(2,n._returnResult({data:{user:null,session:null},error:v}));case 3:if(p&&p.session&&p.user){e.n=4;break}return e.a(2,n._returnResult({data:{user:null,session:null},error:new Rt}));case 4:if(!p.session){e.n=6;break}return e.n=5,n._saveSession(p.session);case 5:return e.n=6,n._notifyAllSubscribers("USER_UPDATED",p.session);case 6:return e.a(2,n._returnResult({data:p,error:v}));case 7:return e.p=7,y=e.v,e.n=8,tn(n.storage,"".concat(n.storageKey,"-code-verifier"));case 8:if(!wt(y)){e.n=9;break}return e.a(2,n._returnResult({data:{user:null,session:null},error:y}));case 9:throw y;case 10:return e.a(2)}},e,null,[[0,7]])}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2,e.v)}},e,this)})),function(e){return B.apply(this,arguments)})},{key:"unlinkIdentity",value:(D=f(d().m(function e(t){var n,r=this;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this._useSession(function(){var e=f(d().m(function e(n){var i,a,s,o;return d().w(function(e){for(;;)switch(e.n){case 0:if(s=n.data,!(o=n.error)){e.n=1;break}throw o;case 1:return e.n=2,Pn(r.fetch,"DELETE","".concat(r.url,"/user/identities/").concat(t.identity_id),{headers:r.headers,jwt:null!==(a=null===(i=s.session)||void 0===i?void 0:i.access_token)&&void 0!==a?a:void 0});case 2:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2,e.v);case 2:if(e.p=2,!wt(n=e.v)){e.n=3;break}return e.a(2,this._returnResult({data:null,error:n}));case 3:throw n;case 4:return e.a(2)}},e,this,[[0,2]])})),function(e){return D.apply(this,arguments)})},{key:"_refreshAccessToken",value:(L=f(d().m(function e(t){var n,r,i,a=this;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return n="#_refreshAccessToken(".concat(t.substring(0,5),"...)"),this._debug(n,"begin"),e.p=1,r=Date.now(),e.n=2,on(function(){var e=f(d().m(function e(r){return d().w(function(e){for(;;)switch(e.n){case 0:if(!(r>0)){e.n=1;break}return e.n=1,an(200*Math.pow(2,r-1));case 1:return a._debug(n,"refreshing attempt",r),e.n=2,Pn(a.fetch,"POST","".concat(a.url,"/token?grant_type=refresh_token"),{body:{refresh_token:t},headers:a.headers,xform:xn});case 2:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}(),function(e,t){var n=200*Math.pow(2,e);return t&&xt(t)&&Date.now()+n-r<dt});case 2:return e.a(2,e.v);case 3:if(e.p=3,i=e.v,this._debug(n,"error",i),!wt(i)){e.n=4;break}return e.a(2,this._returnResult({data:{session:null,user:null},error:i}));case 4:throw i;case 5:return e.p=5,this._debug(n,"end"),e.f(5);case 6:return e.a(2)}},e,this,[[1,3,5,6]])})),function(e){return L.apply(this,arguments)})},{key:"_isValidSession",value:function(e){return"object"===s(e)&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}},{key:"_handleProviderSignIn",value:(U=f(d().m(function e(t,n){var r;return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this._getUrlForProvider("".concat(this.url,"/authorize"),t,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});case 1:return r=e.v,this._debug("#_handleProviderSignIn()","provider",t,"options",n,"url",r),Vt()&&!n.skipBrowserRedirect&&window.location.assign(r),e.a(2,{data:{provider:t,url:r},error:null})}},e,this)})),function(e,t){return U.apply(this,arguments)})},{key:"_recoverAndRefresh",value:(x=f(d().m(function e(){var t,n,r,i,a,s,o,u,c,l,h,f,p;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return r="#_recoverAndRefresh()",this._debug(r,"begin"),e.p=1,e.n=2,en(this.storage,this.storageKey);case 2:if(!(i=e.v)||!this.userStorage){e.n=5;break}return e.n=3,en(this.userStorage,this.storageKey+"-user");case 3:if(a=e.v,this.storage.isServer||!Object.is(this.storage,this.userStorage)||a){e.n=4;break}return a={user:i.user},e.n=4,Zt(this.userStorage,this.storageKey+"-user",a);case 4:i.user=null!==(t=null==a?void 0:a.user)&&void 0!==t?t:_n(),e.n=10;break;case 5:if(!i||i.user){e.n=10;break}if(i.user){e.n=10;break}return e.n=6,en(this.storage,this.storageKey+"-user");case 6:if(!(s=e.v)||!(null==s?void 0:s.user)){e.n=9;break}return i.user=s.user,e.n=7,tn(this.storage,this.storageKey+"-user");case 7:return e.n=8,Zt(this.storage,this.storageKey,i);case 8:e.n=10;break;case 9:i.user=_n();case 10:if(this._debug(r,"session from storage",i),this._isValidSession(i)){e.n=12;break}if(this._debug(r,"session is not valid"),null===i){e.n=11;break}return e.n=11,this._removeSession();case 11:return e.a(2);case 12:if(o=1e3*(null!==(n=i.expires_at)&&void 0!==n?n:1/0)-Date.now()<pt,this._debug(r,"session has".concat(o?"":" not"," expired with margin of ").concat(pt,"s")),!o){e.n=15;break}if(!this.autoRefreshToken||!i.refresh_token){e.n=14;break}return e.n=13,this._callRefreshToken(i.refresh_token);case 13:if(u=e.v,!(c=u.error)){e.n=14;break}if(xt(c)){e.n=14;break}return this._debug(r,"refresh failed with a non-retryable error, removing the session",c),e.n=14,this._removeSession();case 14:e.n=25;break;case 15:if(!i.user||!0!==i.user.__isUserNotAvailableProxy){e.n=24;break}return e.p=16,e.n=17,this._getUser(i.access_token);case 17:if(l=e.v,h=l.data,l.error||!(null==h?void 0:h.user)){e.n=20;break}return i.user=h.user,e.n=18,this._saveSession(i);case 18:return e.n=19,this._notifyAllSubscribers("SIGNED_IN",i);case 19:e.n=21;break;case 20:this._debug(r,"could not get user data, skipping SIGNED_IN notification");case 21:e.n=23;break;case 22:e.p=22,f=e.v,this._debug(r,"error getting user data, skipping SIGNED_IN notification",f);case 23:e.n=25;break;case 24:return e.n=25,this._notifyAllSubscribers("SIGNED_IN",i);case 25:e.n=27;break;case 26:return e.p=26,p=e.v,this._debug(r,"error",p),e.a(2);case 27:return e.p=27,this._debug(r,"end"),e.f(27);case 28:return e.a(2)}},e,this,[[16,22],[1,26,27,28]])})),function(){return x.apply(this,arguments)})},{key:"_callRefreshToken",value:(N=f(d().m(function e(t){var n,r,i,a,s,o,u,c,l;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t){e.n=1;break}throw new Et;case 1:if(!this.refreshingDeferred){e.n=2;break}return e.a(2,this.refreshingDeferred.promise);case 2:return i="#_callRefreshToken(".concat(t.substring(0,5),"...)"),this._debug(i,"begin"),e.p=3,this.refreshingDeferred=new nn,e.n=4,this._refreshAccessToken(t);case 4:if(a=e.v,s=a.data,!(o=a.error)){e.n=5;break}throw o;case 5:if(s.session){e.n=6;break}throw new Et;case 6:return e.n=7,this._saveSession(s.session);case 7:return e.n=8,this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);case 8:return u={data:s.session,error:null},this.refreshingDeferred.resolve(u),e.a(2,u);case 9:if(e.p=9,l=e.v,this._debug(i,"error",l),!wt(l)){e.n=11;break}if(c={data:null,error:l},xt(l)){e.n=10;break}return e.n=10,this._removeSession();case 10:return null===(n=this.refreshingDeferred)||void 0===n||n.resolve(c),e.a(2,c);case 11:throw null===(r=this.refreshingDeferred)||void 0===r||r.reject(l),l;case 12:return e.p=12,this.refreshingDeferred=null,this._debug(i,"end"),e.f(12);case 13:return e.a(2)}},e,this,[[3,9,12,13]])})),function(e){return N.apply(this,arguments)})},{key:"_notifyAllSubscribers",value:(C=f(d().m(function e(t,n){var r,i,a,s,o,u=arguments;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return r=!(u.length>2&&void 0!==u[2])||u[2],i="#_notifyAllSubscribers(".concat(t,")"),this._debug(i,"begin",n,"broadcast = ".concat(r)),e.p=1,this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:t,session:n}),a=[],s=Array.from(this.stateChangeEmitters.values()).map(function(){var e=f(d().m(function e(r){var i;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,r.callback(t,n);case 1:e.n=3;break;case 2:e.p=2,i=e.v,a.push(i);case 3:return e.a(2)}},e,null,[[0,2]])}));return function(t){return e.apply(this,arguments)}}()),e.n=2,Promise.all(s);case 2:if(!(a.length>0)){e.n=3;break}for(o=0;o<a.length;o+=1);throw a[0];case 3:return e.p=3,this._debug(i,"end"),e.f(3);case 4:return e.a(2)}},e,this,[[1,,3,4]])})),function(e,t){return C.apply(this,arguments)})},{key:"_saveSession",value:(I=f(d().m(function e(t){var n,r,i,a,s;return d().w(function(e){for(;;)switch(e.n){case 0:return this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,e.n=1,tn(this.storage,"".concat(this.storageKey,"-code-verifier"));case 1:if(n=Object.assign({},t),r=n.user&&!0===n.user.__isUserNotAvailableProxy,!this.userStorage){e.n=4;break}if(r||!n.user){e.n=2;break}return e.n=2,Zt(this.userStorage,this.storageKey+"-user",{user:n.user});case 2:return delete(i=Object.assign({},n)).user,a=Tn(i),e.n=3,Zt(this.storage,this.storageKey,a);case 3:e.n=5;break;case 4:return s=Tn(n),e.n=5,Zt(this.storage,this.storageKey,s);case 5:return e.a(2)}},e,this)})),function(e){return I.apply(this,arguments)})},{key:"_removeSession",value:(P=f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,e.n=1,tn(this.storage,this.storageKey);case 1:return e.n=2,tn(this.storage,this.storageKey+"-code-verifier");case 2:return e.n=3,tn(this.storage,this.storageKey+"-user");case 3:if(!this.userStorage){e.n=4;break}return e.n=4,tn(this.userStorage,this.storageKey+"-user");case 4:return e.n=5,this._notifyAllSubscribers("SIGNED_OUT",null);case 5:return e.a(2)}},e,this)})),function(){return P.apply(this,arguments)})},{key:"_removeVisibilityChangedCallback",value:function(){this._debug("#_removeVisibilityChangedCallback()");var e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Vt()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){}}},{key:"_startAutoRefresh",value:(j=f(d().m(function e(){var t,n,r=this;return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this._stopAutoRefresh();case 1:this._debug("#_startAutoRefresh()"),t=setInterval(function(){return r._autoRefreshTokenTick()},dt),this.autoRefreshTicker=t,t&&"object"===s(t)&&"function"==typeof t.unref?t.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(t),n=setTimeout(f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,r.initializePromise;case 1:return e.n=2,r._autoRefreshTokenTick();case 2:return e.a(2)}},e)})),0),this.autoRefreshTickTimeout=n,n&&"object"===s(n)&&"function"==typeof n.unref?n.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(n);case 2:return e.a(2)}},e,this)})),function(){return j.apply(this,arguments)})},{key:"_stopAutoRefresh",value:(A=f(d().m(function e(){var t,n;return d().w(function(e){for(;;)switch(e.n){case 0:this._debug("#_stopAutoRefresh()"),t=this.autoRefreshTicker,this.autoRefreshTicker=null,t&&clearInterval(t),n=this.autoRefreshTickTimeout,this.autoRefreshTickTimeout=null,n&&clearTimeout(n);case 1:return e.a(2)}},e,this)})),function(){return A.apply(this,arguments)})},{key:"startAutoRefresh",value:(R=f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return this._removeVisibilityChangedCallback(),e.n=1,this._startAutoRefresh();case 1:return e.a(2)}},e,this)})),function(){return R.apply(this,arguments)})},{key:"stopAutoRefresh",value:(O=f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:return this._removeVisibilityChangedCallback(),e.n=1,this._stopAutoRefresh();case 1:return e.a(2)}},e,this)})),function(){return O.apply(this,arguments)})},{key:"_autoRefreshTokenTick",value:(E=f(d().m(function e(){var t,n=this;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return this._debug("#_autoRefreshTokenTick()","begin"),e.p=1,e.n=2,this._acquireLock(0,f(d().m(function e(){var t;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,t=Date.now(),e.p=1,e.n=2,n._useSession(function(){var e=f(d().m(function e(r){var i,a;return d().w(function(e){for(;;)switch(e.n){case 0:if((i=r.data.session)&&i.refresh_token&&i.expires_at){e.n=1;break}return n._debug("#_autoRefreshTokenTick()","no session"),e.a(2);case 1:if(a=Math.floor((1e3*i.expires_at-t)/dt),n._debug("#_autoRefreshTokenTick()","access token expires in ".concat(a," ticks, a tick lasts ").concat(dt,"ms, refresh threshold is ").concat(3," ticks")),!(a<=3)){e.n=2;break}return e.n=2,n._callRefreshToken(i.refresh_token);case 2:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 2:return e.a(2,e.v);case 3:e.p=3,e.v;case 4:return e.p=4,n._debug("#_autoRefreshTokenTick()","end"),e.f(4);case 5:return e.a(2)}},e,null,[[1,3],[0,,4,5]])})));case 2:e.n=5;break;case 3:if(e.p=3,!((t=e.v).isAcquireTimeout||t instanceof Gn)){e.n=4;break}this._debug("auto refresh token tick lock not available"),e.n=5;break;case 4:throw t;case 5:return e.a(2)}},e,this,[[1,3]])})),function(){return E.apply(this,arguments)})},{key:"_handleVisibilityChange",value:(T=f(d().m(function e(){var t=this;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this._debug("#_handleVisibilityChange()"),Vt()&&(null===window||void 0===window?void 0:window.addEventListener)){e.n=1;break}return this.autoRefreshToken&&this.startAutoRefresh(),e.a(2,!1);case 1:return e.p=1,this.visibilityChangedCallback=f(d().m(function e(){var n;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,t._onVisibilityChanged(!1);case 1:e.n=3;break;case 2:e.p=2,n=e.v,t._debug("#visibilityChangedCallback","error",n);case 3:return e.a(2)}},e,null,[[0,2]])})),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),e.n=2,this._onVisibilityChanged(!0);case 2:e.n=4;break;case 3:e.p=3,e.v;case 4:return e.a(2)}},e,this,[[1,3]])})),function(){return T.apply(this,arguments)})},{key:"_onVisibilityChanged",value:(S=f(d().m(function e(t){var n,r=this;return d().w(function(e){for(;;)switch(e.n){case 0:if(n="#_onVisibilityChanged(".concat(t,")"),this._debug(n,"visibilityState",document.visibilityState),"visible"!==document.visibilityState){e.n=3;break}if(this.autoRefreshToken&&this._startAutoRefresh(),t){e.n=2;break}return e.n=1,this.initializePromise;case 1:return e.n=2,this._acquireLock(this.lockAcquireTimeout,f(d().m(function e(){return d().w(function(e){for(;;)switch(e.n){case 0:if("visible"===document.visibilityState){e.n=1;break}return r._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting"),e.a(2);case 1:return e.n=2,r._recoverAndRefresh();case 2:return e.a(2)}},e)})));case 2:e.n=4;break;case 3:"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh();case 4:return e.a(2)}},e,this)})),function(e){return S.apply(this,arguments)})},{key:"_getUrlForProvider",value:(_=f(d().m(function e(t,n,r){var i,a,s,o,c,l,h;return d().w(function(e){for(;;)switch(e.n){case 0:if(i=["provider=".concat(encodeURIComponent(n))],(null==r?void 0:r.redirectTo)&&i.push("redirect_to=".concat(encodeURIComponent(r.redirectTo))),(null==r?void 0:r.scopes)&&i.push("scopes=".concat(encodeURIComponent(r.scopes))),"pkce"!==this.flowType){e.n=2;break}return e.n=1,pn(this.storage,this.storageKey);case 1:a=e.v,s=u(a,2),o=s[0],c=s[1],l=new URLSearchParams({code_challenge:"".concat(encodeURIComponent(o)),code_challenge_method:"".concat(encodeURIComponent(c))}),i.push(l.toString());case 2:return(null==r?void 0:r.queryParams)&&(h=new URLSearchParams(r.queryParams),i.push(h.toString())),(null==r?void 0:r.skipBrowserRedirect)&&i.push("skip_http_redirect=".concat(r.skipBrowserRedirect)),e.a(2,"".concat(t,"?").concat(i.join("&")))}},e,this)})),function(e,t,n){return _.apply(this,arguments)})},{key:"_unenroll",value:(k=f(d().m(function e(t){var n,r=this;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this._useSession(function(){var e=f(d().m(function e(n){var i,a,s;return d().w(function(e){for(;;)switch(e.n){case 0:if(a=n.data,!(s=n.error)){e.n=1;break}return e.a(2,r._returnResult({data:null,error:s}));case 1:return e.n=2,Pn(r.fetch,"DELETE","".concat(r.url,"/factors/").concat(t.factorId),{headers:r.headers,jwt:null===(i=null==a?void 0:a.session)||void 0===i?void 0:i.access_token});case 2:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2,e.v);case 2:if(e.p=2,!wt(n=e.v)){e.n=3;break}return e.a(2,this._returnResult({data:null,error:n}));case 3:throw n;case 4:return e.a(2)}},e,this,[[0,2]])})),function(e){return k.apply(this,arguments)})},{key:"_enroll",value:(w=f(d().m(function e(t){var n,r=this;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this._useSession(function(){var e=f(d().m(function e(n){var i,a,s,o,u,c,l,h;return d().w(function(e){for(;;)switch(e.n){case 0:if(s=n.data,!(o=n.error)){e.n=1;break}return e.a(2,r._returnResult({data:null,error:o}));case 1:return u=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},"phone"===t.factorType?{phone:t.phone}:"totp"===t.factorType?{issuer:t.issuer}:{}),e.n=2,Pn(r.fetch,"POST","".concat(r.url,"/factors"),{body:u,headers:r.headers,jwt:null===(i=null==s?void 0:s.session)||void 0===i?void 0:i.access_token});case 2:if(c=e.v,l=c.data,!(h=c.error)){e.n=3;break}return e.a(2,r._returnResult({data:null,error:h}));case 3:return"totp"===t.factorType&&"totp"===l.type&&(null===(a=null==l?void 0:l.totp)||void 0===a?void 0:a.qr_code)&&(l.totp.qr_code="data:image/svg+xml;utf-8,".concat(l.totp.qr_code)),e.a(2,r._returnResult({data:l,error:null}))}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2,e.v);case 2:if(e.p=2,!wt(n=e.v)){e.n=3;break}return e.a(2,this._returnResult({data:null,error:n}));case 3:throw n;case 4:return e.a(2)}},e,this,[[0,2]])})),function(e){return w.apply(this,arguments)})},{key:"_verify",value:(b=f(d().m(function e(t){var n=this;return d().w(function(e){for(;;)if(0===e.n)return e.a(2,this._acquireLock(this.lockAcquireTimeout,f(d().m(function e(){var r;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,n._useSession(function(){var e=f(d().m(function e(r){var i,a,s,o,u,c,l;return d().w(function(e){for(;;)switch(e.n){case 0:if(a=r.data,!(s=r.error)){e.n=1;break}return e.a(2,n._returnResult({data:null,error:s}));case 1:return o=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:"create"===t.webauthn.type?ar(t.webauthn.credential_response):sr(t.webauthn.credential_response)})}:{code:t.code}),e.n=2,Pn(n.fetch,"POST","".concat(n.url,"/factors/").concat(t.factorId,"/verify"),{body:o,headers:n.headers,jwt:null===(i=null==a?void 0:a.session)||void 0===i?void 0:i.access_token});case 2:if(u=e.v,c=u.data,!(l=u.error)){e.n=3;break}return e.a(2,n._returnResult({data:null,error:l}));case 3:return e.n=4,n._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+c.expires_in},c));case 4:return e.n=5,n._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",c);case 5:return e.a(2,n._returnResult({data:c,error:l}))}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2,e.v);case 2:if(e.p=2,!wt(r=e.v)){e.n=3;break}return e.a(2,n._returnResult({data:null,error:r}));case 3:throw r;case 4:return e.a(2)}},e,null,[[0,2]])}))))},e,this)})),function(e){return b.apply(this,arguments)})},{key:"_challenge",value:(m=f(d().m(function e(t){var n=this;return d().w(function(e){for(;;)if(0===e.n)return e.a(2,this._acquireLock(this.lockAcquireTimeout,f(d().m(function e(){var r;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,n._useSession(function(){var e=f(d().m(function e(r){var i,a,s,o,u,c;return d().w(function(e){for(;;)switch(e.n){case 0:if(a=r.data,!(s=r.error)){e.n=1;break}return e.a(2,n._returnResult({data:null,error:s}));case 1:return e.n=2,Pn(n.fetch,"POST","".concat(n.url,"/factors/").concat(t.factorId,"/challenge"),{body:t,headers:n.headers,jwt:null===(i=null==a?void 0:a.session)||void 0===i?void 0:i.access_token});case 2:if(!(o=e.v).error){e.n=3;break}return e.a(2,o);case 3:if("webauthn"===(u=o.data).type){e.n=4;break}return e.a(2,{data:u,error:null});case 4:c=u.webauthn.type,e.n="create"===c?5:"request"===c?6:7;break;case 5:return e.a(2,{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:rr(u.webauthn.credential_options.publicKey)})})}),error:null});case 6:return e.a(2,{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:ir(u.webauthn.credential_options.publicKey)})})}),error:null});case 7:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2,e.v);case 2:if(e.p=2,!wt(r=e.v)){e.n=3;break}return e.a(2,n._returnResult({data:null,error:r}));case 3:throw r;case 4:return e.a(2)}},e,null,[[0,2]])}))))},e,this)})),function(e){return m.apply(this,arguments)})},{key:"_challengeAndVerify",value:(v=f(d().m(function e(t){var n,r,i;return d().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this._challenge({factorId:t.factorId});case 1:if(n=e.v,r=n.data,!(i=n.error)){e.n=2;break}return e.a(2,this._returnResult({data:null,error:i}));case 2:return e.n=3,this._verify({factorId:t.factorId,challengeId:r.id,code:t.code});case 3:return e.a(2,e.v)}},e,this)})),function(e){return v.apply(this,arguments)})},{key:"_listFactors",value:(p=f(d().m(function t(){var n,r,i,a,s,o,u,c;return d().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.getUser();case 1:if(r=t.v,i=r.data.user,!(a=r.error)){t.n=2;break}return t.a(2,{data:null,error:a});case 2:s={all:[],phone:[],totp:[],webauthn:[]},o=e(null!==(n=null==i?void 0:i.factors)&&void 0!==n?n:[]);try{for(o.s();!(u=o.n()).done;)c=u.value,s.all.push(c),"verified"===c.status&&s[c.factor_type].push(c)}catch(l){o.e(l)}finally{o.f()}return t.a(2,{data:s,error:null})}},t,this)})),function(){return p.apply(this,arguments)})},{key:"_getAuthenticatorAssuranceLevel",value:(h=f(d().m(function e(t){var n,r,i,a,s,o,u,c,l,h,f,p,v,y,m,g,b,w,k,_,S;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!t){e.n=6;break}return e.p=1,s=rn(t),o=s.payload,u=null,o.aal&&(u=o.aal),c=u,e.n=2,this.getUser(t);case 2:if(l=e.v,h=l.data.user,!(f=l.error)){e.n=3;break}return e.a(2,this._returnResult({data:null,error:f}));case 3:return(null!==(r=null===(n=null==h?void 0:h.factors)||void 0===n?void 0:n.filter(function(e){return"verified"===e.status}))&&void 0!==r?r:[]).length>0&&(c="aal2"),p=o.amr||[],e.a(2,{data:{currentLevel:u,nextLevel:c,currentAuthenticationMethods:p},error:null});case 4:if(e.p=4,!wt(S=e.v)){e.n=5;break}return e.a(2,this._returnResult({data:null,error:S}));case 5:throw S;case 6:return e.n=7,this.getSession();case 7:if(v=e.v,y=v.data.session,!(m=v.error)){e.n=8;break}return e.a(2,this._returnResult({data:null,error:m}));case 8:if(y){e.n=9;break}return e.a(2,{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null});case 9:return g=rn(y.access_token),b=g.payload,w=null,b.aal&&(w=b.aal),k=w,(null!==(a=null===(i=y.user.factors)||void 0===i?void 0:i.filter(function(e){return"verified"===e.status}))&&void 0!==a?a:[]).length>0&&(k="aal2"),_=b.amr||[],e.a(2,{data:{currentLevel:w,nextLevel:k,currentAuthenticationMethods:_},error:null})}},e,this,[[1,4]])})),function(e){return h.apply(this,arguments)})},{key:"_getAuthorizationDetails",value:(l=f(d().m(function e(t){var n,r=this;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this._useSession(function(){var e=f(d().m(function e(n){var i,a;return d().w(function(e){for(;;)switch(e.n){case 0:if(i=n.data.session,!(a=n.error)){e.n=1;break}return e.a(2,r._returnResult({data:null,error:a}));case 1:if(i){e.n=2;break}return e.a(2,r._returnResult({data:null,error:new Et}));case 2:return e.n=3,Pn(r.fetch,"GET","".concat(r.url,"/oauth/authorizations/").concat(t),{headers:r.headers,jwt:i.access_token,xform:function(e){return{data:e,error:null}}});case 3:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2,e.v);case 2:if(e.p=2,!wt(n=e.v)){e.n=3;break}return e.a(2,this._returnResult({data:null,error:n}));case 3:throw n;case 4:return e.a(2)}},e,this,[[0,2]])})),function(e){return l.apply(this,arguments)})},{key:"_approveAuthorization",value:(c=f(d().m(function e(t,n){var r,i=this;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this._useSession(function(){var e=f(d().m(function e(r){var a,s,o;return d().w(function(e){for(;;)switch(e.n){case 0:if(a=r.data.session,!(s=r.error)){e.n=1;break}return e.a(2,i._returnResult({data:null,error:s}));case 1:if(a){e.n=2;break}return e.a(2,i._returnResult({data:null,error:new Et}));case 2:return e.n=3,Pn(i.fetch,"POST","".concat(i.url,"/oauth/authorizations/").concat(t,"/consent"),{headers:i.headers,jwt:a.access_token,body:{action:"approve"},xform:function(e){return{data:e,error:null}}});case 3:return(o=e.v).data&&o.data.redirect_url&&Vt()&&!(null==n?void 0:n.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),e.a(2,o)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2,e.v);case 2:if(e.p=2,!wt(r=e.v)){e.n=3;break}return e.a(2,this._returnResult({data:null,error:r}));case 3:throw r;case 4:return e.a(2)}},e,this,[[0,2]])})),function(e,t){return c.apply(this,arguments)})},{key:"_denyAuthorization",value:(a=f(d().m(function e(t,n){var r,i=this;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this._useSession(function(){var e=f(d().m(function e(r){var a,s,o;return d().w(function(e){for(;;)switch(e.n){case 0:if(a=r.data.session,!(s=r.error)){e.n=1;break}return e.a(2,i._returnResult({data:null,error:s}));case 1:if(a){e.n=2;break}return e.a(2,i._returnResult({data:null,error:new Et}));case 2:return e.n=3,Pn(i.fetch,"POST","".concat(i.url,"/oauth/authorizations/").concat(t,"/consent"),{headers:i.headers,jwt:a.access_token,body:{action:"deny"},xform:function(e){return{data:e,error:null}}});case 3:return(o=e.v).data&&o.data.redirect_url&&Vt()&&!(null==n?void 0:n.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),e.a(2,o)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2,e.v);case 2:if(e.p=2,!wt(r=e.v)){e.n=3;break}return e.a(2,this._returnResult({data:null,error:r}));case 3:throw r;case 4:return e.a(2)}},e,this,[[0,2]])})),function(e,t){return a.apply(this,arguments)})},{key:"_listOAuthGrants",value:(i=f(d().m(function e(){var t,n=this;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this._useSession(function(){var e=f(d().m(function e(t){var r,i;return d().w(function(e){for(;;)switch(e.n){case 0:if(r=t.data.session,!(i=t.error)){e.n=1;break}return e.a(2,n._returnResult({data:null,error:i}));case 1:if(r){e.n=2;break}return e.a(2,n._returnResult({data:null,error:new Et}));case 2:return e.n=3,Pn(n.fetch,"GET","".concat(n.url,"/user/oauth/grants"),{headers:n.headers,jwt:r.access_token,xform:function(e){return{data:e,error:null}}});case 3:return e.a(2,e.v)}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2,e.v);case 2:if(e.p=2,!wt(t=e.v)){e.n=3;break}return e.a(2,this._returnResult({data:null,error:t}));case 3:throw t;case 4:return e.a(2)}},e,this,[[0,2]])})),function(){return i.apply(this,arguments)})},{key:"_revokeOAuthGrant",value:(r=f(d().m(function e(t){var n,r=this;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this._useSession(function(){var e=f(d().m(function e(n){var i,a;return d().w(function(e){for(;;)switch(e.n){case 0:if(i=n.data.session,!(a=n.error)){e.n=1;break}return e.a(2,r._returnResult({data:null,error:a}));case 1:if(i){e.n=2;break}return e.a(2,r._returnResult({data:null,error:new Et}));case 2:return e.n=3,Pn(r.fetch,"DELETE","".concat(r.url,"/user/oauth/grants"),{headers:r.headers,jwt:i.access_token,query:{client_id:t.clientId},noResolveJson:!0});case 3:return e.a(2,{data:{},error:null})}},e)}));return function(t){return e.apply(this,arguments)}}());case 1:return e.a(2,e.v);case 2:if(e.p=2,!wt(n=e.v)){e.n=3;break}return e.a(2,this._returnResult({data:null,error:n}));case 3:throw n;case 4:return e.a(2)}},e,this,[[0,2]])})),function(e){return r.apply(this,arguments)})},{key:"fetchJwk",value:(n=f(d().m(function e(t){var n,r,i,a,s,o=arguments;return d().w(function(e){for(;;)switch(e.n){case 0:if(!(n=(o.length>1&&void 0!==o[1]?o[1]:{keys:[]}).keys.find(function(e){return e.kid===t}))){e.n=1;break}return e.a(2,n);case 1:if(r=Date.now(),!((n=this.jwks.keys.find(function(e){return e.kid===t}))&&this.jwks_cached_at+6e5>r)){e.n=2;break}return e.a(2,n);case 2:return e.n=3,Pn(this.fetch,"GET","".concat(this.url,"/.well-known/jwks.json"),{headers:this.headers});case 3:if(i=e.v,a=i.data,!(s=i.error)){e.n=4;break}throw s;case 4:if(a.keys&&0!==a.keys.length){e.n=5;break}return e.a(2,null);case 5:if(this.jwks=a,this.jwks_cached_at=r,n=a.keys.find(function(e){return e.kid===t})){e.n=6;break}return e.a(2,null);case 6:return e.a(2,n)}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"getClaims",value:(t=f(d().m(function e(t){var n,r,i,a,s,o,u,c,l,h,f,p,v,y,m,g,b,w,k,_=arguments;return d().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=_.length>1&&void 0!==_[1]?_[1]:{},e.p=1,r=t){e.n=4;break}return e.n=2,this.getSession();case 2:if(i=e.v,a=i.data,!(s=i.error)&&a.session){e.n=3;break}return e.a(2,this._returnResult({data:null,error:s}));case 3:r=a.session.access_token;case 4:if(o=rn(r),u=o.header,c=o.payload,l=o.signature,h=o.raw,f=h.header,p=h.payload,(null==n?void 0:n.allowExpired)||gn(c.exp),u.alg&&!u.alg.startsWith("HS")&&u.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto){e.n=5;break}w=null,e.n=7;break;case 5:return e.n=6,this.fetchJwk(u.kid,(null==n?void 0:n.keys)?{keys:n.keys}:null==n?void 0:n.jwks);case 6:w=e.v;case 7:if(v=w){e.n=10;break}return e.n=8,this.getUser(r);case 8:if(y=e.v,!(m=y.error)){e.n=9;break}throw m;case 9:return e.a(2,{data:{claims:c,header:u,signature:l},error:null});case 10:return g=bn(u.alg),e.n=11,crypto.subtle.importKey("jwk",v,g,!0,["verify"]);case 11:return b=e.v,e.n=12,crypto.subtle.verify(g,b,l,Ht("".concat(f,".").concat(p)));case 12:if(e.v){e.n=13;break}throw new Lt("Invalid JWT signature");case 13:return e.a(2,{data:{claims:c,header:u,signature:l},error:null});case 14:if(e.p=14,!wt(k=e.v)){e.n=15;break}return e.a(2,this._returnResult({data:null,error:k}));case 15:throw k;case 16:return e.a(2)}},e,this,[[1,14]])})),function(e){return t.apply(this,arguments)})}]);var t,n,r,i,a,c,l,h,p,v,m,b,w,k,_,S,T,E,O,R,A,j,P,I,C,N,x,U,L,D,B,q,K,W,M,F,G,H,J,V,z,Y,$,X,Q,Z,ee,te,ne,re,ie,ae,se,oe,ue,ce,le,he,fe,de,pe,ve,ye,me,ge,be,we,ke,_e,Se}();Sr.nextInstanceID={};var Tr=Sr,Er="";Er="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";var Or={headers:{"X-Client-Info":"supabase-js-".concat(Er,"/").concat("2.95.3")}},Rr={schema:"public"},Ar={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},jr={};function Pr(e){return(Pr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ir(e){var t=function(e,t){if("object"!=Pr(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=Pr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Pr(t)?t:t+""}function Cr(e,t,n){return(t=Ir(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Nr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function xr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Nr(Object(n),!0).forEach(function(t){Cr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Nr(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Ur=function(e,t,n){var r=function(e){return e?function(){return e.apply(void 0,arguments)}:function(){return fetch.apply(void 0,arguments)}}(n),i=Headers;return function(){var n=f(d().m(function n(a,s){var o,u,c,l,h,f;return d().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,t();case 1:if(h=o=n.v,!(l=null!==h)){n.n=2;break}l=void 0!==o;case 2:if(!l){n.n=3;break}f=o,n.n=4;break;case 3:f=e;case 4:return u=f,(c=new i(null==s?void 0:s.headers)).has("apikey")||c.set("apikey",e),c.has("Authorization")||c.set("Authorization","Bearer ".concat(u)),n.a(2,r(a,xr(xr({},s),{},{headers:c})))}},n)}));return function(e,t){return n.apply(this,arguments)}}()};var Lr=function(e){function t(e){return g(this,t),b(this,t,[e])}return w(t,e),y(t)}(Tr),Dr=function(){return y(function e(t,n,r){var i,a,s=this;g(this,e),this.supabaseUrl=t,this.supabaseKey=n;var o=function(e){var t,n=null==e?void 0:e.trim();if(!n)throw new Error("supabaseUrl is required.");if(!n.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL((t=n).endsWith("/")?t:t+"/")}catch(r){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}(t);if(!n)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",o),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",o),this.storageUrl=new URL("storage/v1",o),this.functionsUrl=new URL("functions/v1",o);var u,c="sb-".concat(o.hostname.split(".")[0],"-auth-token"),l=function(e,t){var n,r,i,a=e.db,s=e.auth,o=e.realtime,u=e.global,c=t.db,l=t.auth,h=t.realtime,p=t.global,v={db:xr(xr({},c),a),auth:xr(xr({},l),s),realtime:xr(xr({},h),o),storage:{},global:xr(xr(xr({},p),u),{},{headers:xr(xr({},null!==(n=null==p?void 0:p.headers)&&void 0!==n?n:{}),null!==(r=null==u?void 0:u.headers)&&void 0!==r?r:{})}),accessToken:(i=f(d().m(function e(){return d().w(function(e){for(;;)if(0===e.n)return e.a(2,"")},e)})),function(){return i.apply(this,arguments)})};return e.accessToken?v.accessToken=e.accessToken:delete v.accessToken,v}(null!=r?r:{},{db:Rr,realtime:jr,auth:xr(xr({},Ar),{},{storageKey:c}),global:Or});this.storageKey=null!==(i=l.auth.storageKey)&&void 0!==i?i:"",this.headers=null!==(a=l.global.headers)&&void 0!==a?a:{},l.accessToken?(this.accessToken=l.accessToken,this.auth=new Proxy({},{get:function(e,t){throw new Error("@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.".concat(String(t)," is not possible"))}})):this.auth=this._initSupabaseAuthClient(null!==(u=l.auth)&&void 0!==u?u:{},this.headers,l.global.fetch),this.fetch=Ur(n,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(xr({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(function(e){return s.realtime.setAuth(e)}).catch(function(e){}),this.rest=new q(new URL("rest/v1",o).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch,timeout:l.db.timeout,urlLengthLimit:l.db.urlLengthLimit}),this.storage=new ht(this.storageUrl.href,this.headers,this.fetch,null==r?void 0:r.storage),l.accessToken||this._listenForAuthEvents()},[{key:"functions",get:function(){return new _(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}},{key:"from",value:function(e){return this.rest.from(e)}},{key:"schema",value:function(e){return this.rest.schema(e)}},{key:"rpc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{head:!1,get:!1,count:void 0};return this.rest.rpc(e,t,n)}},{key:"channel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{config:{}};return this.realtime.channel(e,t)}},{key:"getChannels",value:function(){return this.realtime.getChannels()}},{key:"removeChannel",value:function(e){return this.realtime.removeChannel(e)}},{key:"removeAllChannels",value:function(){return this.realtime.removeAllChannels()}},{key:"_getAccessToken",value:(e=f(d().m(function e(){var t,n,r,i,a;return d().w(function(e){for(;;)switch(e.n){case 0:if(!(t=this).accessToken){e.n=2;break}return e.n=1,t.accessToken();case 1:return e.a(2,e.v);case 2:return e.n=3,t.auth.getSession();case 3:return i=e.v,a=i.data,e.a(2,null!==(n=null===(r=a.session)||void 0===r?void 0:r.access_token)&&void 0!==n?n:t.supabaseKey)}},e,this)})),function(){return e.apply(this,arguments)})},{key:"_initSupabaseAuthClient",value:function(e,t,n){var r=e.autoRefreshToken,i=e.persistSession,a=e.detectSessionInUrl,s=e.storage,o=e.userStorage,u=e.storageKey,c=e.flowType,l=e.lock,h=e.debug,f=e.throwOnError,d={Authorization:"Bearer ".concat(this.supabaseKey),apikey:"".concat(this.supabaseKey)};return new Lr({url:this.authUrl.href,headers:xr(xr({},d),t),storageKey:u,autoRefreshToken:r,persistSession:i,detectSessionInUrl:a,storage:s,userStorage:o,flowType:c,lock:l,debug:h,throwOnError:f,fetch:n,hasCustomAuthorizationHeader:Object.keys(this.headers).some(function(e){return"authorization"===e.toLowerCase()})})}},{key:"_initRealtimeClient",value:function(e){return new ye(this.realtimeUrl.href,xr(xr({},e),{},{params:xr(xr({},{apikey:this.supabaseKey}),null==e?void 0:e.params)}))}},{key:"_listenForAuthEvents",value:function(){var e=this;return this.auth.onAuthStateChange(function(t,n){e._handleTokenChanged(t,"CLIENT",null==n?void 0:n.access_token)})}},{key:"_handleTokenChanged",value:function(e,t,n){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===n?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):(this.changedAccessToken=n,this.realtime.setAuth(n))}}]);var e}();n("c",function(e,t,n){return new Dr(e,t,n)});!function(){if("undefined"!=typeof window)return!1;var e=globalThis.process;if(!e)return!1;var t=e.version;if(null==t)return!1;var n=t.match(/^v(\d+)\./);!!n&&parseInt(n[1],10)}()}}})}();
