<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ANEXO COBRO v5.3.6</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <link rel="icon" type="image/png" href="/favicon.png">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');

    :root {
      --app-height: 100%;
    }

    html,
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f8fafc;
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior-y: contain;
    }

    #root {
      min-height: 100%;
      display: flex;
      flex-direction: column;
    }

    button,
    a,
    input,
    select {
      touch-action: manipulation;
    }

    input,
    select,
    textarea {
      font-size: 16px !important;
    }

    input[type="date"]::-webkit-calendar-picker-indicator {
      cursor: pointer;
      filter: brightness(0);
      opacity: 0.9;
    }

    .leaflet-container {
      height: 100%;
      width: 100%;
      border-radius: 1.5rem;
      z-index: 10;
    }

    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: #e2e8f0;
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #cbd5e1;
    }

    @keyframes border-blink {

      0%,
      100% {
        border-color: #ef4444;
        box-shadow: 0 0 10px rgba(239, 68, 68, 0.2);
      }

      50% {
        border-color: #fca5a5;
        box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
      }
    }

    .animate-border-blink {
      animation: border-blink 1.5s infinite ease-in-out;
      border-width: 2px !important;
    }

    @keyframes jump-animation {

      0%,
      20%,
      50%,
      80%,
      100% {
        transform: translateY(0);
      }

      40% {
        transform: translateY(-50px);
      }

      60% {
        transform: translateY(-25px);
      }
    }

    .jump-3s {
      animation: jump-animation 0.8s ease infinite;
    }

    .mobile-scroll-container {
      overflow-y: auto;
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
    }
  </style>
  <link rel="stylesheet" href="/index.css">
</head>

<body>
  <!-- VERSION_V5_2_0_FORCE_REDEPLOY -->
  <div id="error-trap"
    style="display:none; color:red; padding:20px; font-family:monospace; background:white; position:fixed; top:0; left:0; width:100%; height:100%; z-index:9999;">
  </div>
  <script>
    (function () {
      const BUILD_ID = 'VERSION_V5_3_6_FINAL';
      console.log("%c >>> SYSTEM " + BUILD_ID + " <<< ", "background: #f43f5e; color: white; font-size: 20px; font-weight: bold; padding: 10px;");
      const lastId = localStorage.getItem('LAST_DEPLOY_ID');

      if (lastId !== BUILD_ID) {
        console.warn("Update Detected. Synchronizing local environment...");
        localStorage.clear();
        sessionStorage.clear();
        localStorage.setItem('LAST_DEPLOY_ID', BUILD_ID);

        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.getRegistrations().then(regs => {
            for (let r of regs) r.unregister();
            window.location.reload(true);
          });
          return;
        }
        window.location.reload(true);
      }
    })();

    // Asset Loading Error Handler (Integrity Check)
    window.addEventListener('error', function (event) {
      const element = event.target || event.srcElement;
      if (element.tagName === 'LINK' || element.tagName === 'SCRIPT') {
        const src = element.src || element.href;
        console.error('Falla crítica al cargar recurso:', src);

        // Si falla el CSS principal o el index.tsx, forzamos un reload sin caché
        if (src && (src.includes('index.css') || src.includes('.js') || src.includes('.tsx'))) {
          const reloadCount = parseInt(sessionStorage.getItem('asset_reload_count') || '0');
          if (reloadCount < 5) {
            console.log('Intentando recarga de emergencia...');
            sessionStorage.setItem('asset_reload_count', (reloadCount + 1).toString());

            // Clean SW if possible before reload
            if ('serviceWorker' in navigator) {
              navigator.serviceWorker.getRegistrations().then(function (regs) {
                for (let r of regs) r.unregister();
                window.location.reload(true);
              });
            } else {
              window.location.reload(true);
            }
          }
        }
      }
    }, true);

    // WSOD Self-Repair: If app doesn't mount after 8s
    setTimeout(function () {
      var root = document.getElementById('root');
      if (root && !root.hasChildNodes()) {
        console.warn("WSOD detected. Forcing clean reload...");
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.getRegistrations().then(function (regs) {
            for (let r of regs) r.unregister();
            localStorage.setItem('FORCE_FRESH_CLEAN', 'true');
            window.location.reload(true);
          });
        } else {
          window.location.reload(true);
        }
      }
    }, 8000);

    window.onerror = function (msg, url, line, col, error) {
      var trap = document.getElementById('error-trap');
      if (trap) {
        trap.style.display = 'block';
        trap.innerHTML += '<h3>Fatal Error:</h3><p>' + msg + '</p><p>' + url + ':' + line + '</p><hr>';
      }
    };
    window.addEventListener('unhandledrejection', function (event) {
      var trap = document.getElementById('error-trap');
      if (trap) {
        trap.style.display = 'block';
        trap.innerHTML += '<h3>Unhandled Promise Rejection:</h3><pre>' + JSON.stringify(event.reason?.message || event.reason, null, 2) + '</pre><hr>';
      }
    });

    // Reset reload counter if everything loads fine after 10s
    setTimeout(() => sessionStorage.removeItem('asset_reload_count'), 10000);
  </script>
  <div id="root"></div>
  <script type="module" src="/index.tsx"></script>
</body>

</html>