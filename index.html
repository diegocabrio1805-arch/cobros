<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Anexo Cobro v6.1.25 ARMAGEDON</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <link rel="icon" type="image/png" href="/favicon.png">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <link rel="stylesheet" href="/index.css">
</head>

<body>
  <!-- VERSION_V5_2_0_FORCE_REDEPLOY -->
  <div id="error-trap"
    style="display:none; color:red; padding:20px; font-family:monospace; background:white; position:fixed; top:0; left:0; width:100%; height:100%; z-index:9999;">
  </div>
  <script>
    (function () {
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(function (registrations) {
          for (let registration of registrations) {
            console.log("Unregistering Service Worker:", registration);
            registration.unregister();
          }
        });
      }
    })();

    // --- PANIC RELOAD MECHANISM (Anti-WSOD) ---
    (function () {
      const BOOT_TIMEOUT = 5000; // 5 segundos cr√≠ticos de arranque
      let bootFinished = false;

      window.addEventListener('load', () => {
        setTimeout(() => {
          bootFinished = true;
          sessionStorage.removeItem('panic_reload_count');
          console.log("Boot finished successfully.");
        }, BOOT_TIMEOUT);
      });

      const handlePanic = (msg) => {
        if (bootFinished) return;
        console.error("Critical boot error detected:", msg);

        var trap = document.getElementById('error-trap');
        if (trap) {
          trap.style.display = 'block';
          trap.innerHTML = `
            <div style="background:#0f172a; color:white; height:100vh; padding:20px; text-align:center; display:flex; flexDirection:column; alignItems:center; justifyContent:center; fontFamily:sans-serif;">
              <h1 style="font-size:60px; margin:0;">üõ†Ô∏è</h1>
              <h2 style="font-size:20px; font-weight:bold; margin:10px 0; color:#f1f5f9;">ERROR DE ARRANQUE DETECTADO</h2>
              <p style="color:#94a3b8; margin-bottom:20px; font-size:14px; max-width:300px;">La app no pudo iniciar. Mira el detalle t√©cnico abajo:</p>
              
              <div style="background:#1e293b; padding:15px; border-radius:12px; border:1px solid #334155; width:100%; max-width:400px; margin-bottom:20px; text-align:left;">
                <p style="color:#ef4444; font-size:10px; font-weight:bold; text-transform:uppercase; margin:0 0 5px 0;">Detalle t√©cnico:</p>
                <pre style="font-size:10px; color:#cbd5e1; margin:0; white-space:pre-wrap; word-break:break-all; max-height:200px; overflow:auto;">${msg}</pre>
              </div>

              <button onclick="localStorage.clear(); sessionStorage.clear(); window.location.reload(true);" 
                style="background:#3b82f6; color:white; padding:16px 32px; border-radius:16px; font-weight:bold; border:none; cursor:pointer; box-shadow:0 10px 15px -3px rgba(59,130,246,0.5); font-size:14px;">
                REPARAR Y LIMPIAR DATOS
              </button>
              
              <p style="color:#475569; font-size:10px; margin-top:20px;">(El auto-refresco ha sido desactivado para diagn√≥stico)</p>
            </div>
          `;
        }
      };

      window.addEventListener('error', (e) => handlePanic(e.message));
      window.addEventListener('unhandledrejection', (e) => handlePanic(e.reason?.message || "Promise Error"));
    })();
  </script>
  <div id="root"></div>
  <script type="module" src="/index.tsx"></script>
</body>

</html>